<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Onboarding in DOME with digital Powers of Representation - the LEARCredential</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Opengraph Facebook Meta Tags -->
    <meta property="og:title" content="Onboarding in DOME with digital Powers of Representation - the LEARCredential">
    <meta property="og:type" content="website">
    <meta property="og:description" content="Onboarding in DOME with digital Powers of Representation - the LEARCredential">
    <meta property="og:site_name" content="Onboarding in DOME with digital Powers of Representation - the LEARCredential">
    <meta property="og:url" content="https://dome-marketplace.github.io/powers-of-representation/onboarding.html">

    <script src="https://www.w3.org/Tools/respec/respec-w3c" async="" class="remove"></script>
    <script class="remove">
        var respecConfig = {
            latestVersion: "https://dome-marketplace.github.io/powers-of-representation/onboarding.html",
            edDraftURI: "https://dome-marketplace.github.io/powers-of-representation/onboarding.html",
            github: "https://github.com/dome-marketplace/powers-of-representation",
            editors: [
                {
                    company: "JesusRuiz",
                    companyURL: "https://hesusruiz.github.io/",
                    email: "hesusruiz@gmail.com",
                    name: "Jesus Ruiz",
                },
            ],
            authors: [
                {
                    name: "The DOME project participants",
                },
            ],
            localBiblio: {
                "Actor-DataSpaces": {
                        date: "April 2023",
                        href: "https://dl.acm.org/doi/pdf/10.1145/3543873.3587645",
                        title: "Extending Actor Models in Data Spaces",
                },
                "Apodera": {
                        date: "2012",
                        href: "https://ec.europa.eu/digital-building-blocks/wikis/display/EIDCOMMUNITY/STORK+2.0+WP3+-+Legal+and+Trust+Analysis?preview=/84415420/84415378/STORK_2_0_D3_3_MandateAttribute_Management_Report_v_1_0.pdf",
                        title: "Electronic Register of Powers",
                },
                "Cryptographic Hyperlinks": {
                        date: "May 2021",
                        href: "https://w3c-ccg.github.io/hashlink/",
                        title: "Cryptographic Hyperlinks",
                },
                "DEP-DSS": {
                        date: "2019-10",
                        href: "https://ec.europa.eu/digital-building-blocks/wikis/display/DIGITAL/Qualified+electronic+signature+-+QES+validation+algorithm",
                        publisher: "European Commission",
                        title: "Algorithm for Validation of qualified and advanced signatures and seals",
                },
                "DID-DNS": {
                        href: "https://tools.ietf.org/html/draft-mayrhofer-did-dns-01",
                        publisher: "IETF",
                        status: "Internet Draft",
                        title: "The Decentralized Identifier (DID) in the DNS",
                },
                "DID-ELSI": {
                        date: "February 2024",
                        href: "https://dome-marketplace.github.io/did-method-elsi/",
                        title: "DID ETSI Legal person Semantic Identifier Method Specification (did:elsi)",
                },
                "DID-PRIMER": {
                        href: "https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust-fall2017/blob/master/topics-and-advance-readings/did-primer.md",
                        publisher: "Rebooting the Web of Trust 2017",
                        title: "DID Primer",
                },
                "DIF.PresentationExchange": {
                        href: "https://identity.foundation/presentation-exchange/spec/v2.0.0/",
                        title: "Presentation Exchange 2.0.0",
                },
                "EDIW.ARF": {
                        date: "20 April 2023",
                        href: "https://github.com/eu-digital-identity-wallet/eudi-doc-architecture-and-reference-framework/blob/main/docs/arf.md",
                        title: "EUDI Wallet Architecture and Reference Framework 1.1.0",
                },
                "ENISA-Qualified Electronic Seals": {
                        date: "June 2017",
                        href: "https://www.enisa.europa.eu/publications/security-guidelines-on-the-appropriate-use-of-qualified-electronic-seals",
                        title: "Security guidelines on the appropriate use of qualified electronic seals",
                },
                "ENISA-Qualified Electronic Signatures": {
                        date: "December 2016",
                        href: "https://www.enisa.europa.eu/publications/security-guidelines-on-the-appropriate-use-of-qualified-electronic-signatures",
                        title: "Security guidelines on the appropriate use of qualified electronic signatures",
                },
                "ETSI-CERTOVERVIEW": {
                        date: "2020-07",
                        href: "https://www.etsi.org/deliver/etsi_en/319400_319499/31941201/01.04.02_20/en_31941201v010402a.pdf",
                        publisher: "ETSI",
                        title: "ETSI EN 319 412-1 V1.4.2 (2020-07) - Electronic Signatures and Infrastructures (ESI); Certificate Profiles; Part 1: Overview and common data structures",
                },
                "ETSI-LEGALPERSON": {
                        date: "2020-07",
                        href: "https://www.etsi.org/deliver/etsi_en/319400_319499/31941203/01.02.01_60/en_31941203v010201p.pdf",
                        publisher: "ETSI",
                        title: "ETSI EN 319 412-3 V1.2.1 (2020-07) - Electronic Signatures and Infrastructures (ESI); Certificate Profiles; Part 3: Certificate profile for certificates issued to legal persons",
                },
                "EU_Trusted_Lists": {
                        href: "https://digital-strategy.ec.europa.eu/en/policies/eu-trusted-lists",
                        title: "EU Trusted Lists",
                },
                "JAdES": {
                        date: "2021-03",
                        href: "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
                        publisher: "ETSI",
                        title: "ETSI TS 119 182-1 V1.1.1 (2021-03) - Electronic Signatures and Infrastructures (ESI); JAdES digital signatures; Part 1: Building blocks and JAdES baseline signatures",
                },
                "NIST-AUTH": {
                        date: "October 2016",
                        href: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-178.pdf",
                        title: "NIST Special Publication 800-178: A Comparison of Attribute Based Access Control (ABAC) Standards for Data Service Applications",
                },
                "ODRL": {
                        date: "February 2018",
                        href: "https://www.w3.org/TR/odrl-model/",
                        title: "ODRL Information Model 2.2",
                },
                "OWASP-TRANSPORT": {
                        href: "https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet",
                        title: "Transport Layer Protection Cheatsheet",
                },
                "OpenID.Core": {
                        date: "8 November 2014",
                        href: "http://openid.net/specs/openid-connect-core-1_0.html",
                        title: "OpenID Connect Core 1.0 incorporating errata set 1",
                },
                "OpenID.SIOP2": {
                        date: "28 January 2022",
                        href: "https://openid.bitbucket.io/connect/openid-connect-self-issued-v2-1_0.html",
                        title: "Self-Issued OpenID Provider v2",
                },
                "OpenID.VCI": {
                        date: "8 February 2024",
                        href: "https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html",
                        title: "OpenID for Verifiable Credential Issuance - draft 13",
                },
                "OpenID.VP": {
                        date: "29 November 2023",
                        href: "https://openid.net/specs/openid-4-verifiable-presentations-1_0-20.html",
                        title: "OpenID for Verifiable Presentations - draft 20",
                },
                "RFC6749": {
                        href: "https://www.rfc-editor.org/rfc/rfc6749.html",
                        title: "The OAuth 2.0 Authorization Framework",
                },
                "RFC7515": {
                        href: "https://www.rfc-editor.org/rfc/rfc7515",
                        title: "JSON Web Signature (JWS)",
                },
                "RFC7519": {
                        href: "https://www.rfc-editor.org/rfc/rfc7519",
                        title: "JSON Web Token (JWT)",
                },
                "RFC8414": {
                        href: "https://www.rfc-editor.org/rfc/rfc8414",
                        title: "OAuth 2.0 Authorization Server Metadata",
                },
                "RFC8725": {
                        href: "https://www.rfc-editor.org/rfc/rfc8725",
                        title: "JSON Web Token Best Current Practices",
                },
                "RPaM-Ontology": {
                        date: "2020",
                        href: "https://github.com/everis-rpam/RPaM-Ontology/wiki/Ontology-Development-Report",
                        title: "Representation Powers and Mandates (RPaM) Ontology",
                },
                "STORK2.MandateReport": {
                        date: "2012",
                        href: "https://ec.europa.eu/digital-building-blocks/wikis/display/EIDCOMMUNITY/STORK+2.0+WP3+-+Legal+and+Trust+Analysis?preview=/84415420/84415378/STORK_2_0_D3_3_MandateAttribute_Management_Report_v_1_0.pdf",
                        title: "STORK 2.0: D.3.3 – Mandate/Attribute Management Report",
                },
                "eIDAS": {
                        href: "https://digital-strategy.ec.europa.eu/en/policies/discover-eidas",
                        title: "Discover eIDAS",
                },
                "eIDAS-SAML_V1.2": {
                        date: "August 2019",
                        href: "https://ec.europa.eu/digital-building-blocks/wikis/download/attachments/467109280/eIDAS%20SAML%20Attribute%20Profile%20v1.2%20Final.pdf",
                        title: "eIDAS SAML Attribute Profile. Version 1.2",
                },
                "eIDAS.Regulation": {
                        date: "23 July 2014",
                        href: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv%3AOJ.L_.2014.257.01.0073.01.ENG",
                        title: "Regulation (EU) No 910/2014 of the European Parliament and of the Council of 23 July 2014 on electronic identification and trust services for electronic transactions in the internal market and repealing Directive 1999/93/EC",
                },
                "eIDAS2.Regulation": {
                        date: "March 2023",
                        href: "https://www.europarl.europa.eu/doceo/document/A-9-2023-0038_EN.html",
                        title: "REPORT on the proposal for a regulation of the European Parliament and of the Council amending Regulation (EU) No 910/2014 as regards establishing a framework for a European Digital Identity",
                },
            },
        };
    </script>
    <link rel="stylesheet" href="./assets/templates/respec/additional.css">
</head>

<body>
    <p class="copyright">
        Copyright © 2024 the document editors/authors. Text is available under the
        <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode">
        Creative Commons Attribution 4.0 International Public License</a>
    </p>


<h1 id='title'>Onboarding in DOME with digital Powers of Representation - the LEARCredential
</h1>
<h2 id='subtitle'>Implementing efficient Powers of Representation with the <code>LEAR Credential</code> and <code>did:elsi</code>
</h2>
<section id='abstract'>
    <p>In a B2B ecosystem like <a href="https://dome-marketplace.eu/">DOME</a>, the agreements between a product or service provider and the consumer are typically formalised among <b>legal persons</b> (also known in this document as 'organisations', or 'companies').
    </p>
    <p>However, in most cases <b>natural persons act on behalf of legal persons</b> when interacting in the context of execution of an inter-company agreement. Depending on the sensitivity of the involved processes and the data exchange involved, the Relying Party may want to enforce a high level of legal compliance and reduce the associated legal risks.
    </p>
    <p>This is specially difficult in the <b>Onboarding process</b>, because there is not a previous relationship between the companies involved. The objective of this document is to describe the mechanisms used in DOME to perform the onboarding of participants, and their relationship to the legal and business aspects of the onboarding process.
    </p>
    <p>Onboarding of a new participant in the DOME ecosystem is a critical activity, and proper identification of the new participant at this stage affects very much to the level of trust of the whole onboarding process and also to the level of trust that all the other participants in the ecosystem can place on the identity of the new participant.
    </p>
    <p>We describe here two mechanisms for onboarding in DOME:
    </p>
    <ol>
        <li>A <b>digital and automated cross-border onboarding</b> process based on signatures under the current eIDAS legal framework and aligned at the same time with eIDAS2, which provides a reasonable balance between automation, convenience, and level of legal certainty and security.
        </li>
        <li>A <b>“classical” manual process</b>, which is more <b>cumbersome, lengthy, and inconvenient</b> than the digital one, but is available as an exceptional temporary measure to those companies not yet at the required level of digitalisation in the eIDAS framework and which are not capable of using eIDAS digital signatures.
        </li>
    </ol>
</section>
<section id='conformance'>
</section>
<section id='The definition of Onboarding'><h2>The definition of Onboarding</h2>

    <p>Onboarding refers to a process which precedes entering into a business relationship with a new participant, which in the case of DOME has to be a legal person. At this moment we do not address onboarding of natural persons, something which will be supported as soon as the new eIDAS2 is available.
    </p>
    <p>For the purposes of this chapter, this phase of the onboarding process consists of the following logical phases (which can be combined in a single step when performing them in a digital way):
    </p>
    <ul>
        <li><b>Application</b>. Pre-on-boarding phase, addressing the act of applying to become a participant. In this phase, the applicant provides the required identity and KYC (Know-Your-Customer) attributes for verification and collection.
        </li>
        <li><b>Verification</b>. The verification phase determines whether the expected requirements and mechanisms used to perform verification of attributes are met. It can be divided into 3 steps:
            <div>
            <ul>
                <li><b>Authenticity check</b> of documents, to determine that the document can be considered a trustworthy source of information such as for identity attributes.
                </li>
                <li><b>Identity check</b> of the applicant, by comparison of the bearer of the document against the owner of the document.
                </li>
                <li><b>Anti-fraud check</b>, to determine that the document is not used in fraud-related activities and it belongs to a living person or existing legal entity; and that the applicant is not involved in fraud activities, not under sanctions or considered a PEP (Politically Exposed Person).
                </li>
            </ul>
            </div>
        </li>
    </ul>
    <p>Depending on the sector of activity and its legal and regulatory requirements, a complete onboarding process requires the following common due diligence measures:
    </p>
    <ul>
        <li><b>Identification of legal person</b> on the basis of documents and data submitted; and verification of the submitted information on the basis of information obtained from a reliable and independent source;
        </li>
        <li><b>Identification and verification of the legal representative</b> and the right of representation;
        </li>
        <li><b>Identification of the beneficial owner</b>, based on information provided for onboarding or obtained from another reliable and independent source; and
        </li>
        <li>Obtaining information on the <b>purpose and nature</b> of the business relationship or transaction.
        </li>
    </ul>
    <p>In this chapter we focus only on the identification of the legal person and in the identification and verification of the legal representative, and assume that once this is done the remaining documentation can be provided and verified in a trusted, digital and automated way to complete all remaining required steps in the specific onboarding process for the ecosystem.
    </p>
    <p>In DOME the main mechanism to provide those documents is to submit them in the form of Verifiable Credentials since this makes the process much easier and reduces manual work and possible error: the DOME Operator can check if the corresponding credentials have been signed by trusted issuers.
    </p>
</section>
<section id='Overview of the onboarding processes'><h2>Overview of the onboarding processes</h2>

    <p>The main onboarding process in DOME is based on eIDAS digital certificates and advanced or qualified signatures (<a href="https://eur-lex.europa.eu/legal-content/en/TXT/?uri=CELEX%3A32014R0910">Regulation EU No 910/2014</a>), which
    </p>
    <blockquote>
        <p>“... seek to enhance trust in electronic transactions in the internal market by providing a common foundation for secure electronic interaction between citizens, businesses and public authorities, thereby increasing the effectiveness of public and private online services, electronic business and electronic commerce in the Union.”
        </p>
    </blockquote>
    <p>Using electronic signatures facilitates a fully digital and automated cross-border onboarding process, and at the same time provides a reasonable balance between automation, convenience, and level of legal certainty and security.
    </p>
    <p>However, there are still countries in the EU which are lagging in the widespread use of eIDAS signatures. This is expected to change soon, given the push provided by the introduction of eIDAS2 and thanks to a timely implementation of the European Digital Identity Wallet by the Member States (they will be obliged to issue Digital Identity Wallets within 12 months of the entry into force of the Regulation).
    </p>
    <p>In the mean time, we provide two mechanisms for onboarding in DOME:
    </p>
    <ol>
        <li>A <b>digital and automated cross-border onboarding</b> process based on signatures under the current eIDAS legal framework and aligned at the same time with eIDAS2, which provides a reasonable balance between automation, convenience, and level of legal certainty and security. This is the preferred mechanism.
        </li>
        <li>A <b>“classical” manual process</b>, which is more <b>cumbersome, lengthy, and inconvenient</b> than the digital one, but is available as an exceptional temporary measure to those companies not yet at the required level of digitalisation in the eIDAS framework and which are not capable of using eIDAS digital signatures.
        </li>
    </ol>
    <p>The diagram below describes an overview of both processes
    </p>
    <figure class='figureshadow'><img src='builtassets/plantuml_b50b13ff55985e0faf33e87f7924e21d.png' alt='Overview of onboarding processes'>
    <figcaption>Overview of onboarding processes</figcaption></figure>

    <section id='Digital onboarding process'><h2>Digital onboarding process</h2>

        <p>The objective of the onboarding process is to identify and register a legal entity as a new participant. However, the process is initiated and driven by a natural person, acting on behalf of the company.
        </p>
        <p>To provide high legal certainty and high security, the onboarding process requires that the natural person driving the process should be either a legal representative of the participant or a natural person that has been delegated by a legal representative at least the powers required to perform the onboarding process on behalf of the legal entity.
        </p>
        <p>With that in mind, the overall process is the following:
        </p>
        <table class='w3-table-all'>
            <tr>
                <th>Task
                </th>
                <th>Mechanism
                </th>
            </tr>
            <tr>
                <td>A Legal Representative of the company authorises an employee to perform the process of onboarding
                </td>
                <td>The legal representative digitally signs a document including the identification of the employee and describing the specific powers that the employee has: onboarding in DOME
                </td>
            </tr>
            <tr>
                <td>The authorised employee starts the onboarding process in the DOME portal
                </td>
                <td>The employee presents the document with the authorisation, to prove that she has the power to act on behalf of the company for the purpose of onboarding in DOME
                </td>
            </tr>
            <tr>
                <td>DOME verifies that the employee has the power to act on behalf of the company for the purpose of onboarding
                </td>
                <td>Verification is automatic for:
                    <ul>
                        <li>Identity of the legal entity (company)
                        </li>
                        <li>Identity of the legal representative
                        </li>
                        <li>The powers that the employee has, delegated by the legal representative
                        </li>
                    </ul>
                    <p>In addition, the document is authentic and can not be repudiated.
                    </p>
                </td>
            </tr>
            <tr>
                <td>The employee completes the onboarding process in the DOME portal
                </td>
                <td>Filling forms in the DOME portal and uploading required additional documents
                </td>
            </tr>
        </table>
        <p>When using digital signatures and the authorisation document is machine-readable, the above process does not require the intervention of any employee of DOME.
        </p>
    </section>
    <section id='Manual process'><h2>Manual process</h2>

        <p>As in the digital case, we also require that the natural person driving the onboarding process should be either a legal representative of the participant or a natural person that has been delegated by a legal representative at least the powers required to perform the onboarding process on behalf of the legal entity.
        </p>
        <p>Without digital signatures, the process is the following:
        </p>
        <table class='w3-table-all'>
            <tr>
                <th>Task
                </th>
                <th>Mechanism
                </th>
            </tr>
            <tr>
                <td>A Legal Representative of the company authorises an employee to perform the process of onboarding
                </td>
                <td>The legal representative puts a handwritten signature in a document including the identification of the employee and describing the specific powers that the employee has: onboarding in DOME.
                    <p>In addition, the legal representative provides to the employee an authentic document with the Powers of Attorney proving that the signer of the previous authorisation document is a legal representative of the company.
                    </p>
                </td>
            </tr>
            <tr>
                <td>The authorised employee starts the onboarding process in the DOME portal
                </td>
                <td>The employee presents the document with the authorisation, to prove that she has the power to act on behalf of the company for the purpose of onboarding in DOME
                </td>
            </tr>
            <tr>
                <td>DOME verifies that the employee has the power to act on behalf of the company for the purpose of onboarding
                </td>
                <td>Verifications are manual: some employee of DOME has to perform, in a trusted manner, the following:
                    <ol>
                        <li>Verify that the document with the Powers of Attorney is authentic (probably checking in the business registry of the country of incorporation of the company).
                        </li>
                        <li>Verify that the signature in the authorisation document corresponds to the legal representative (eg. is not a picture copied from another document). This is very difficult, unless the legal representative is contacted directly by the DOME employee.
                        </li>
                        <li>Verify that the authorisation document is authentic (has not been tampered with since it was signed by the legal representative). This is very difficult, because an unsigned PDF can be modified easily.
                        </li>
                        <li>Verify that the powers inside the document are the ones required to perform onboarding in DOME.
                        </li>
                        <li>Verify that the person trying to onboard is the same identified in the authorisation document. The DOME employee has to request the national identity document of the employee and check against the authorisation document.
                        </li>
                    </ol>
                    <p>Once verifications are done, the DOME employee has to enable access to the DOME onboarding portal to the company employee.
                    </p>
                </td>
            </tr>
            <tr>
                <td>The employee completes the onboarding process in the DOME portal
                </td>
                <td>Filling forms in the DOME portal and uploading required additional documents
                </td>
            </tr>
        </table>
    </section>
</section>
<section id='The LEAR Credential as Powers of Representation'><h2>The LEAR Credential as Powers of Representation</h2>

    <p>The LEARCredential is a machine-readable document representing a Mandate or Powers of Representation. The format used in DOME is a Verifiable Credential using an eIDAS signature to bind the mandate data with the real-world identity of the issuer of the credential.
    </p>
    <p>We base our design in the [[RPaM-Ontology]], which is a project started in 2018 by the Directorate-General for Informatics (DG-DIGIT) of the European Commission, funded by the ISA Programme, to organise and support the development of an ontology about the Representation of Powers and Mandates, from now on the <b>RPaM Ontology</b>.
    </p>
    <p>We adapt the results of that project, with simplifications and specialisations, to the concrete environment where we use the LEARCredential. To facilitate the job of the reader of this document, in some sections we copy literal sentences from the RPaM Ontology project, and adapt the texts to our requirements. However, the reader is encouraged to access the original documents for more details and understand the original approach, including the <a href="https://everis-rpam.github.io/Glossary.html">RPaM Ontology Glossary</a>.
    </p>
    <section id='The Mandate'><h2>The Mandate</h2>

        <p>According to the RPaM Glossary, a "<i>mandate is a record that describes the terms under which a mandator grants a representation power to a mandatee</i>".
        </p>
        <p>The conceptual model for a <code>mandate</code> in DOME is represented below:
        </p>
        <div class='xcard'>
            <header><b>mandate</b>
            </header>
            <p>The <code>mandate</code> is composed of three related objects described below: <code>mandator</code>, <code>mandatee</code> and <code>power</code>. The <code>mandate</code> object is signed with an advanced or qualified signature using an eIDAS certificate.
            </p>
            <div class='xcard'>
                <header><b>mandator</b>
                </header>
                <p>The object <code>mandator</code> identifies the employee of the company who is delegating a subset of her powers on the <code>mandatee</code>.
                </p>
                <p>The <code>mandator</code> is either:
                </p>
                <ul>
                    <li>a legal representative of the company, according to the official records associated to the incorporation of the organisation (e.g., the business registry of the country of incorporation); or
                    </li>
                    <li>an employee who is a <code>mandatee</code> in another <code>mandate</code> where the <code>mandator</code> is a legal representative of the company. We do not support more than two levels of delegation.
                    </li>
                </ul>
                <p>In DOME, the Onboarding process requires that the <code>mandator</code> is the legal representative of the company, to ensure an appropriate level of legal certainty.
Other processes (after onboarding is completed), like creating a ProductOffering, can use any of the above options for the <code>mandator</code>, subject to the limitation of a maximum of two levels of delegation.
                </p>
            </div>
            <div class='xcard'>
                <header><b>mandatee</b>
                </header>
                <p>The <code>mandatee</code> is the person granted with the power to represent (and act as) the company in some specific actions with third-parties. The powers granted to the <code>mandatee</code> must be a subset of the powers of the <code>mandator</code>. For example, an employee (the <code>mandatee</code>) can be empowered by the legal representative of the company (the <code>mandator</code>) to perform the onboarding process in DOME.
                </p>
                <p>The object <code>mandatee</code> identifies the employee on whom a subset of powers is delegated. The <code>mandatee</code> object contains:
                </p>
                <ul>
                    <li>A set of attributes of the employee which are required by the specific use case where the LEAR Credential will be used, for example to onboard in the DOME ecosystem and for creating a ProductOffering in the marketplace. Those attributes can be considered equivalent to the fields that would be filled in a form when a "classical" PDF document would be used to authorise an employee.
                    </li>
                    <li>A public key associated to the employee and where the employee is the sole controller of the associated private key. This is required to enable the use of the LEARCredential containing the <code>mandate</code> as an efficient, scalable and secure authentication and authorisation mechanism.
                    </li>
                </ul>
                <p>The private key controlled by the employee is used to prove to Relying parties receiving the LEARCredential that the holder and presenter of the credential is the same person identified in the <code>mandatee</code> object.
We support two mechanisms for the public key in the <code>mandatee</code> object:
                </p>
                <ul>
                    <li>Using a <code>did:key</code> where the employee controls the private key associated to the <code>did:key</code>.
                    </li>
                    <li>Using an eIDAS certificate owned by the employee.
                    </li>
                </ul>
                <p>The details of how the public key is bound to the identity of the <code>mandatee</code> can be found in section <a href="#binding-id-holder" class="xref">Binding the Issued Credential to the identifier of the End-User possessing that Credential</a>.
                </p>
            </div>
            <div class='xcard'>
                <header><b>power</b>
                </header>
                <p>This object is a list of each specific power that is delegated from the <code>mandator</code> to the <code>mandatee</code>. The powers must be concrete and as constrained as possible, and must follow a taxonomy with the semantics well specified.
                </p>
                <p>In DOME, we have specified a power taxonomy targeted at the interactions with the DOME Federated Marketplace, supporting not only the onboarding process but also any other interaction after onboarding. The system uses the taxonomy to perform authentication and access control based on the LEARCredential presented by users. This means that the actions are well defined, homogeneous and standardised for the ecosystem. We are basically replacing the current mechanisms for Mandates (e.g., paper or PDF) with a more efficient, machine-processable representation in the form of a Verifiable Credential.
                </p>
                <p>Our Power Taxonomy could be generalised to other actions involving private sector companies, but it is out of scope of this version of the document.
                </p>
            </div>
        </div>
    </section>
    <section id='Mapping to a Verifiable Credential'><h2>Mapping to a Verifiable Credential</h2>

        <p>We now describe the mapping of the conceptual model into the concrete representation of a Mandate in a LEAR Credential, and more specifically to the <code>jwt_vc_json</code> representation (VC Signed as a JWT, Not Using JSON-LD), which is the one currently used in DOME.
        </p>
        <p>The <code>mandate</code> is represented in the LEAR Credential as an object inside the <code>credentialSubject</code> object. An example of a complete LEARCredential is the following:
        </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;@context&#34;</span>: [
        <span style="color:#d14">&#34;https://www.w3.org/ns/credentials/v2&#34;</span>,
        <span style="color:#d14">&#34;https://dome-marketplace.eu/2022/credentials/learcredential/v1&#34;</span>
    ],
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;urn:did:elsi:25159389-8dd17b796ac0&#34;</span>,
    <span style="color:#000080">&#34;type&#34;</span>: [<span style="color:#d14">&#34;VerifiableCredential&#34;</span>, <span style="color:#d14">&#34;LEARCredentialEmployee&#34;</span>],
    <span style="color:#000080">&#34;issuer&#34;</span>: {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATES-12345678&#34;</span>
    },
    <span style="color:#000080">&#34;validFrom&#34;</span>: <span style="color:#d14">&#34;2024-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;validTo&#34;</span>: <span style="color:#d14">&#34;2025-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;credentialSubject&#34;</span>: {
        <span style="color:#000080">&#34;mandate&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;urn:did:elsi:25159389-8dd17b796ac0&#34;</span>,
            <span style="color:#000080">&#34;validFrom&#34;</span>: <span style="color:#d14">&#34;2024-03-22T14:00:00Z&#34;</span>,
            <span style="color:#000080">&#34;validTo&#34;</span>: <span style="color:#d14">&#34;2025-03-22T14:00:00Z&#34;</span>,
            <span style="color:#000080">&#34;mandator&#34;</span>: {
                <span style="color:#000080">&#34;cn&#34;</span>: <span style="color:#d14">&#34;56565656V Jesus Ruiz&#34;</span>,
                <span style="color:#000080">&#34;serialNumber&#34;</span>: <span style="color:#d14">&#34;56565656V&#34;</span>,
                <span style="color:#000080">&#34;organizationIdentifier&#34;</span>: <span style="color:#d14">&#34;VATES-12345678&#34;</span>,
                <span style="color:#000080">&#34;o&#34;</span>: <span style="color:#d14">&#34;GoodAir&#34;</span>,
                <span style="color:#000080">&#34;c&#34;</span>: <span style="color:#d14">&#34;ES&#34;</span>
            },
            <span style="color:#000080">&#34;mandatee&#34;</span>: {
                <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
                <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
                <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
                <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
                <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
                <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>
            },
            <span style="color:#000080">&#34;power&#34;</span>: [
                {
                    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;53493323798&#34;</span>,
                    <span style="color:#000080">&#34;powerSource&#34;</span>: <span style="color:#d14">&#34;https://eur-lex.europa.eu/eli/reg/2014/910/oj&#34;</span>,
                    <span style="color:#000080">&#34;tmf_type&#34;</span>: <span style="color:#d14">&#34;Domain&#34;</span>,
                    <span style="color:#000080">&#34;tmf_domain&#34;</span>: [<span style="color:#d14">&#34;DOME&#34;</span>],
                    <span style="color:#000080">&#34;tmf_function&#34;</span>: <span style="color:#d14">&#34;Onboarding&#34;</span>,
                    <span style="color:#000080">&#34;tmf_action&#34;</span>: [<span style="color:#d14">&#34;Execute&#34;</span>]
                }
            ]
        }
    }
}
</pre></td></tr></table>

        <section id='Mandate'><h2>Mandate</h2>

            <p>In the above example, we have specified that the <code>mandator</code> (the legal representative of the company) has delegated to the <code>mandatee</code> (the employee who will be the owner of the LEAR Credential) one single power to access services in the DOME ecosystem (specified with the fields <code>tmf_type</code> and <code>tmf_name</code>) with the specific capability to perform the onboarding of the company in the DOME ecosystem (specified with the fields <code>tmf_function</code> and <code>tmf_action</code>). The actual data model, which can be used to express mor complex delegations is described below in more detail.
            </p>
            <p>The <code>mandate</code> has an optional <code>id</code> field which can be used to identify the Mandate when the Verifiable Credential is used to represent a Mandate which exists in other systems like a <a href="https://sede.administracion.gob.es/PAG_Sede/ServiciosElectronicos/RegistroElectronicoDeApoderamientos.html">centralised eMandate registry</a>. When the Mandate is created with the Verifiable Credential, the <code>id</code> field of the <code>mandate</code> object can be ommitted and the <code>id</code> of the credential can be used to identify the Mandate, and revoke it if needed. To maintain privacy, the <code>id</code> field should not have any relationship with the rest of the data in the Mandate.
            </p>
            <p>Similarly, the <code>mandate</code> has the optional fields <code>validFrom</code> and <code>validTo</code> which can be used when the credential represents a Mandate that exists externally. The typical use case is when the Mandate in the external system has a big life span and the issuer of the LEARCredential wants the credential to have a smaller life span. In any case, a Relying party receiving the LEARCredential should use the more restrictive life span when performing the verification checks. That is, it must use the biggest of the <code>validFrom</code> claims, and the smallest of the <code>validTo</code> claims.
            </p>
        </section>
        <section id='Mandator'><h2>Mandator</h2>

            <p>There are two possible cases for the Mandator:
            </p>
            <ol>
                <li>The Mandator is the legal representative of the company. In this case, the claims in the <code>mandator</code> object are a subset of the fields in the <code>subject</code> object in the eIDAS certificate that the legal representative uses to sign the LEARCredential. The minimum set of fields are the ones in the example.
                </li>
                <li>The Mandator is an employee who is the Mandatee in another LEARCredential. In this case, the data in the <code>mandator</code> object must be the same data that appears in the <code>mandatee</code> object of the related LEARCredential.
                </li>
            </ol>
            <p>In this second case, the <code>powerSource</code> in the <code>power</code> object (see later) must be the LEARCredential which was used to delegate the powers to the <code>mandator</code> from the legal representative of the company.
            </p>
        </section>
        <section id='Mandatee'><h2>Mandatee</h2>

            <p>The <code>mandatee</code> object contains a set of attributes of the employee which are required by the specific use case where the LEAR Credential will be used, for example to onboard in the DOME ecosystem and for creating a ProductOffering in the marketplace.
            </p>
            <p>In DOME, the minimum attributes are <code>title</code>, <code>first_name</code>, <code>last_name</code>, <code>email</code> and <code>mobile_phone</code>.
            </p>
            <p>In addition, the <code>mandatee</code> object contains a public key where the employee is the sole controller of the associated private key. There are two possible cases:
            </p>
            <ol>
                <li>The employee wants to use her <code>did:key</code> where the employee controls the private key associated to the <code>did:key</code>. In this case, the <code>id</code> claim of the <code>mandatee</code> object is the <code>did:key</code>.
                </li>
                <li>The employee wants to use her personal or professional eIDAS certificate. In this case, the <code>mandatee</code> object must include two claims: the <code>id</code> claim with the <code>did:key</code> corresponding to the public key in the eIDAS certificate, and the claim <code>x5c</code> with the certificate itsef (which also incudes the public key, but we require the <code>id</code> field for completeness).
                </li>
            </ol>
        </section>
        <section id='Power'><h2>Power</h2>

            <p>This object is an array where each element is a power that is delegated from the Mandator to the Mandatee. The fields of each power object are:
            </p>
            <ul>
                <li><code>id</code>: The identifier of the power, which must be unique in the context of the Credential where it is included. It can be used as a reference when performing access control, for example in the audit records to identify the specific power that was used to grant access to some protected resource.
                </li>
                <li><code>powerSource</code> (conditional): The Mandator draws the power from one (or more) sources of power, e.g. 1) a concrete Legislation; 2) a piece of evidence (as another Mandate, in which case the mandator was a mandatee in that other mandate) and/or 3) a Natural Person with a specific profession that invest him/her with the authority to order to a mandator with a specific role the creation of a mandate, e.g. a judge authorising a civil servant (a <code>Mandator</code> that is a Natural Person with the appropriate role) to create a mandate for a relative to represent an incapacitated person).
                    <div>
                    <p>In DOME, there are three cases with specific sources of power:
                    </p>
                    </div>
                    <div>
                    <ol>
                        <li>When the Mandator is a legal representative of the company, and the LEARCredential is signed with the eIDAS certificate of representation of the legal representative. In this case, the <code>powerSource</code> claim can be ommitted as it is implicit in the eIDAS signature. Alternatively, the <code>powerSource</code> claim is an object with the following fields:
                            <div>
                            <ul>
                                <li><code>type</code>, with value "eulaw".
                                </li>
                                <li><code>evidence</code>, with value <code>"https://eur-lex.europa.eu/eli/reg/2014/910/oj"</code>.
                                </li>
                            </ul>
                            </div>
                        </li>
                        <li>When the Mandator is a natural person who is the Mandatee in another LEARCredential. The <code>powerSource</code> claim is an object with the following fields:
                            <div>
                            <ul>
                                <li><code>type</code>, with value "LEARCredential".
                                </li>
                                <li><code>format</code>, with the value "jwt_vc_json".
                                </li>
                                <li><code>evidence</code>, with the LEARCredential where the Mandator is a Mandatee, in <code>jwt_vc_json</code> format.
                                </li>
                            </ul>
                            </div>
                        </li>
                        <li>When the Mandator is a legal representative of the company, but does not have an eIDAS certificate of representation, the Mandator can not sign the LEARCredential. In this case, there must be a trusted third-party which attests that the Mandator is effectively a legal representative of the company. This trusted third-party must perform the required due diligence to confirm the relationship, and then sign the credential with its eIDAS certificate.
                            <div>
                            <p>In DOME, one of the trusted third-parties (trusted by DOME) is the DOME Operator itself, where the employees dedicated to the onboarding of participants perform the manual checks on the documentation provided by the Mandator/Mandatee, and then create and sign the LEARCredential.
                            </p>
                            </div>
                            <div>
                            <p>In this case, the <code>powerSource</code> claim is an object with the following fields:
                            </p>
                            </div>
                            <div>
                            <ul>
                                <li><code>type</code>, with value "attestation".
                                </li>
                                <li><code>evidence</code>, with value the eIDAS certificate of the attester.
                                </li>
                            </ul>
                            </div>
                            <div>
                            <p>In this case, the <code>mandate</code> object must contain an additional object called <code>attester</code>, identifying the entity that makes the attestation and with the same fields as the <code>mandator</code> object in the case where the Mandator signs the LEARCredential with an eIDAS certificate.
                            </p>
                            </div>
                        </li>
                    </ol>
                    </div>
                </li>
                <li><code>tmf_type</code>: The type of power, which can be:
                    <div>
                    <ul>
                        <li>"Domain": The mandatee has access to the services (subject to the restrictions defined by <code>action</code> and <code>function</code>) provided by one or more organisations where the services have been classified as belonging to that domain. The classification of services is arbitrary and defined by the service providers. A typical scenario is when some service providers agree on a classification of the services that they provide in the context of an ecosystem (like DOME), and the possible domains are made public, including the mapping to a given set of services in each provider.
                        </li>
                        <li>"Organization": The mandatee has access only to the services provided by one or more organizations, listed specifically in the power.
                        </li>
                    </ul>
                    </div>
                </li>
                <li><code>tmf_domain</code>: Required when the <code>tmf_claim</code> has the value "Domain" or "Organization". It is an array with the names of the Domains or Organisations where the Mandatee is authorised to interact with this Mandate.
                    <div>
                    <p>The names must be unique (e.g. via a namespace) to avoid potential clashes in different ecosystems.
                    </p>
                    </div>
                    <div>
                    <p>In DOME, for the powers of onboarding in DOME and for creating a <code>ProductOffering</code>, the <code>tmf_domain</code> claim must be an array with a single item "DOME".
                    </p>
                    </div>
                </li>
                <li><code>tmf_function</code>: A string specifying the name of the function that the Mandatee can perform. The definition of the possible functions is done by the Verifier (the entity with which the Mandatee will interact with the LEAR Credential).
                    <div>
                    <p>In DOME, the possible funcions are "Onboarding" and "ProductOffering", which enables the Mandatee to use the services provided by DOME to onboard organisations in the ecosystem and (if it is onboarded previously) to create a ProductOffering.
                    </p>
                    </div>
                </li>
                <li><code>tmf_action</code>: An array with the concrete actions belonging to the function that the Mandatee is allowed to execute.
                    <div>
                    <p>In DOME, the possible actions are
                    </p>
                    </div>
                    <div>
                    <ul>
                        <li>"Execute" when <code>tmf_function</code> is "Onboarding".
                        </li>
                        <li>Any combination of "Create", "Update" and "Delete" when <code>tmf_function</code> is "ProductOffering".
                        </li>
                    </ul>
                    </div>
                </li>
            </ul>
        </section>
    </section>
</section>
<section id='Issuing the LEAR Credential'><h2>Issuing the LEAR Credential</h2>

    <section id='issuing-lear-credential-signature'><h2>Issuing the LEARCredential using an eIDAS certificate for signatures</h2>

        <section id='Overview'><h2>Overview</h2>

            <p>Issuance in DOME uses the [[OpenID.VCI]] protocol. We define a <i>profile</i> of the [[OpenID.VCI]] protocol, restricting the different optional features available in the standard to ensure the proper level of security, interoperability and flexibility for our use case. The restrictions apply mainly to the Issuer, so any Wallet compatible with the [[OpenID.VCI]] protocol can be used.
            </p>
            <p>We describe the issuance process in detail, repeating in many cases text from the standard. This is done on purpose, to make the description as self-contained as possible and facilitate the job of the reader. This puts the burden on us to keep this description updated in synch with the standard, but we think the effort is worth the benefits obtained for the reader.
            </p>
            <p>The description of the issuance process is general enough to be used for many types of credentials, but the text includes notes describing the concrete application of the process to the case of the LEARCredential in DOME.
            </p>
            <p>We also assume in the description the use of the Wallet provided by DOME, but as mentioned above, any Wallet compatible with the [[OpenID.VCI]] protocol can be used.
            </p>
            <p>The participants in the ecosystem are:
            </p>
            <table class='deftable'>
                <tr><td style='padding-left: 0px;'><b>Employee</b></td></tr><tr><td style='padding-left: 20px;'>
                    <p>This is the employee (or contractor) of a company who will receive the LEAR Credential. The example assumes the existence of secure company communication channels, offline or online, between the employee and at least the Human Resources department of the company (or whatever department is in charge of issuing the LEAR Credential to the employee).
                    </p>
                </td></tr>
                <tr><td style='padding-left: 0px;'><b>Wallet</b></td></tr><tr><td style='padding-left: 20px;'>
                    <p>The Wallet is assumed to be a Web application with a wallet backend, implemented as a PWA so it has some offline capabilities and can be installed in the device, providing a user experience similar to a native application. Private key management and most sensitive operations are performed in a backend server, operated by an entity trusted by the end user. However, native applications and completely offline PWA mobile applications are also supported by this profile.
                    </p>
                    <p>This type of wallet supports natural persons, juridical persons and natural persons who are legal entity representatives of juridical persons. For juridical persons the wallet is usually called an <code>enterprise wallet</code> but we will use here just the term <code>Wallet</code> unless the distinction is required.
                    </p>
                    <p>In this profile we assume that the wallet is not previously registered with the Issuer and that the wallet does not expose public endpoints that are called by the Issuer, even if the wallet has a backend server that could implement those endpoints. These assumptions make the wallet implementations in this profile to be very similar in interactions to a full mobile implementation, making migration to a full mobile implementation easier.
                    </p>
                    <p>In other words, from the point of view of the Issuer, the wallet in this profile is almost indistinguishable from a full mobile wallet, and it does not assume a previous relationship with the Wallet.
                    </p>
                </td></tr>
                <tr><td style='padding-left: 0px;'><b>User Laptop</b></td></tr><tr><td style='padding-left: 20px;'>
                    <p>For clarity of exposition, we assume in this profile that the End User starts the interactions with the Issuer with an internet browser (user agent) in her laptop. However, there is nothing in the interactions which limits those interactions to a laptop form factor and the End User can interact with any internet browser in any device (mobile, tablet, kiosk).
                    </p>
                </td></tr>
                <tr><td style='padding-left: 0px;'><b>Issuer</b></td></tr><tr><td style='padding-left: 20px;'>
                    <p>In this profile we assume that the Issuer is composed of two components:
                    </p>
                    <ul>
                        <li><b>Issuer backend</b>: the main server implementing the business logic of the Issuer as a web application and additional backend APIs required for issuance of credentials.
                        </li>
                        <li><b>Authorization server</b>: the backend component implementing the existing authentication/authorization functionalities for the Issuer entity.
                        </li>
                    </ul>
                    <p>The Issuer backend and the Authorization server could be implemented as a single component in an actual deployment, but we assume here that they are separated to make the profile more general, especially for big entities and also when using Trust Service Providers for cloud signature and credential issuance, for example.
                    </p>
                    <p>To simplify the explanation and the examples, we assume that there is only one instance of the Authorization Server for a given instance of the Issuer backend, which is also a common deployment scenario in many companies. We also assume that for external entities, like the Wallet, the two components are under the same domain so they look like one single server entity to the Wallet.
                    </p>
                </td></tr>
            </table>
            <figure class='figureshadow'><img src='builtassets/plantuml_614e2f068e1fef535fb3123c83e7f1d3.png' alt='Overall LEAR Credential issuance flow'>
            <figcaption>Overall LEAR Credential issuance flow</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_552'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Credential_Offer_561'><b>2. Credential Offer</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
                    <p>The Appointed employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email).
                    </p>
                    <p>The portal does not require the Appointed employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to access its Credential Offer.
                    </p>
                    <p>Once the employee enters the <code>transaction code</code> in the portal, a QR code is displayed with the content of Credential Offer (compliant with the OpenID4VCI protocol).
                    </p>
                    <p>The employee scans the QR code with her Wallet. She can use the Wallet provided by DOME, or any other which is compatible. This includes the possibility that the company provides employees with its own Wallet, which could even be a branded version of the DOME Wallet.
                    </p>
</div>
                </li>
                <li id='3._Wallet_obtains_Issuer's_Credential_Issuer_metadata_575'><b>3. Wallet obtains Issuer's Credential Issuer metadata</b>
<div>
                    <p>The Wallet uses the Credential Issuer's URL to fetch its metadata, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-11.2">Section 11.2</a> of [[OpenID.VCI]]. The Wallet needs the metadata to learn the Credential types and formats that the Credential Issuer supports, and to determine the Token Endpoint (at the OAuth 2.0 Authorization Server) as well as the Credential Endpoint required to start the request.)
                    </p>
</div>
                </li>
                <li id='4._Token_Request_583'><b>4. Token Request</b>
<div>
                    <p>The Wallet sends the Pre-Authorized Code obtained in Step (2) in the Token Request to the Token Endpoint. The Wallet will additionally send a Transaction Code provided by the End-User, if it was required by the Credential Issuer. This step is defined in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-6">Section 6</a> of [[OpenID.VCI]].
                    </p>
</div>
                </li>
                <li id='5._Credential_Request_591'><b>5. Credential Request</b>
<div>
                    <p>The Wallet sends a Credential Request to the Credential Issuer's Credential Endpoint with the Access Token and the proof of possession of the private key of a key pair to which the Credential Issuer should bind the issued Credential to. Upon successfully validating Access Token and proof, the Credential Issuer returns a Credential in the Credential Response.
                    </p>
</div>
                </li>
                <li id='6._The_legal_representative_signs_the_Credential_597'><b>6. The legal representative signs the Credential</b>
<div>
                    <p>The legal representative reviews the credential and signs it using her eIDAS certificate.
                    </p>
</div>
                </li>
            </ul>
            <p><b>Authentication of End User and previous Issuer-End User relationship</b>
            </p>
            <p>We assume that the Issuer and End User have a previous relationship and that the Issuer has performed the KYC required by regulation and needed to be able to issue Verifiable Credentials attesting some attributes about the End User. We assume that there is an existing trusted authentication mechanism (not necessarily related to Verifiable Credentials) that the End User employs to access protected resources from the Issuer. For example, the user is an employee or a customer of the Issuer, or the Issuer is a Local Administration and the End User is a citizen living in that city.
            </p>
        </section>
        <section id='The Human Resources employee introduces employee data into Issuer'><h2>The Human Resources employee introduces employee data into Issuer</h2>

            <figure class='figureshadow'><img src='builtassets/plantuml_c5f1c541e7d71bc2a633454d26b16c12.png' alt='Creating a Credential Offer'>
            <figcaption>Creating a Credential Offer</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_638'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Notify_End-User_648'><b>2. Notify End-User</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
</div>
                </li>
            </ul>
        </section>
        <section id='Employee accesses Issuer portal'><h2>Employee accesses Issuer portal</h2>

            <figure class='figureshadow'><img src='builtassets/plantuml_0e4a69fcedeff2e1617b08e46c31944b.png' alt='Employee scans the Credential Offer'>
            <figcaption>Employee scans the Credential Offer</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_678'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Notify_End-User_688'><b>2. Notify End-User</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
</div>
                </li>
                <li id='3._Access_Issuer_portal_693'><b>3. Access Issuer portal</b>
<div>
                    <p>The employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email)
                    </p>
</div>
                </li>
                <li id='4._Login_with_transaction_code_699'><b>4. Login with transaction code</b>
<div>
                    <p>The portal redirects the user to the login page of the Verifier component of DOME Onboarding.
                    </p>
                    <p>The portal does not require the employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to login and access its Credential Offer.
                    </p>
</div>
                </li>
                <li id='5._Generate_QR_code_705'><b>5. Generate QR code</b>
<div>
                    <p>The Verifier generates a QR code, containing inside the URL of the <code>/authentication-requests</code> endpoint of the Verifier component which will be used to start the [[OpenID.VP]] process.
                    </p>
                    <p>A QR code is used because a Self-Issued OP may be running locally as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://verifier.dome-marketplace.eu/authorization-requests?state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj</span>
</pre></td></tr></table>

</div>
                </li>
                <li id='6_714'><b>6</b> The QR code is displayed in the user browser with instructions to scan it and go to the URL inside it.
<div>
                    <figure>
                        <p><img src="images/qrcode-authreq.png" alt="" />
                        </p>
                        <figcaption>QR code with URL to Credential Offer
                        </figcaption>
                    </figure>
</div>
                </li>
            </ul>
            <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: Authentication</p>
                <p>Companies may want to add additional authentication mechanisms if they want to increase security. For example, the End User may authenticate with an existing intra-company authentication (only if the LEAR Credential Issuer is deployed by the company, and not accessed as SaaS). This profile does not require that it is based on OIDC, Verifiable Credentials or any other specific mechanism.
                </p>
                <p>The level of assurance (LoA) of this authentication mechanism is one of the factors that will determine the confidence that the Verifiers can have on the credentials received by them from a given Issuer.
                </p>
            </aside></td></tr></table>
        </section>
        <section id='Credential Offer'><h2>Credential Offer</h2>

            <figure class='figureshadow'><img src='builtassets/plantuml_c0320b5e172875d73fd29ffde3b13f67.png' alt='Credential Offer'>
            <figcaption>Credential Offer</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_756'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Notify_End-User_766'><b>2. Notify End-User</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
</div>
                </li>
                <li id='3._Access_Issuer_portal_771'><b>3. Access Issuer portal</b>
<div>
                    <p>The employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email)
                    </p>
</div>
                </li>
                <li id='4._Login_with_transaction_code_777'><b>4. Login with transaction code</b>
<div>
                    <p>The portal redirects the user to the login page of the Verifier component of DOME Onboarding.
                    </p>
                    <p>The portal does not require the employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to login and access its Credential Offer.
                    </p>
</div>
                </li>
                <li id='5._Generate_QR_code_783'><b>5. Generate QR code</b>
<div>
                    <p>The Verifier generates a QR code, containing inside the URL of the <code>/authentication-requests</code> endpoint of the Verifier component which will be used to start the [[OpenID.VP]] process.
                    </p>
                    <p>A QR code is used because a Self-Issued OP may be running locally as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://verifier.dome-marketplace.eu/authorization-requests?state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj</span>
</pre></td></tr></table>

</div>
                </li>
                <li id='6._Display_QR_code_792'><b>6. Display QR code</b>
<div>
                    <p>The QR code is displayed in the user browser with instructions to scan it and go to the URL inside it.
                    </p>
                    <figure>
                        <p><img src="images/qrcode-authreq.png" alt="" />
                        </p>
                        <figcaption>QR code with URL to Credential Offer
                        </figcaption>
                    </figure>
</div>
                </li>
                <li id='7._Scan_QR_code_802'><b>7. Scan QR code</b>
<div>
                    <p>The user scans the QR with her wallet and tells the wallet to go to the URL in the QR.
                    </p>
                    <p>In this profile the wallet does not have to implement the Credential Offer Endpoint described in section 4 of [[OpenID.VCI]].
                    </p>
                    <p>Instead, the Credential Issuer renders a QR code containing a reference to the Credential Offer that can be scanned by the End-User using a Wallet, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-4.1">section 4.1</a> of [[OpenID.VCI]].
                    </p>
                    <p>According to the spec, the Credential Offer object is a JSON object containing the Credential Offer parameters and can be sent by value or by reference. To avoid problems with the size of the QR travelling in the URL, this profile requires that the QR contains the <code>credential_offer_uri</code>, which is a URL using the <code>https</code> scheme referencing a resource containing a JSON object with the Credential Offer parameters. The <code>credential_offer_uri</code> endpoint should be implemented by the Issuer backend.
                    </p>
</div>
                </li>
                <li id='8._Get_Credential_Offer_813'><b>8. Get Credential Offer</b>
<div>
</div>
                </li>
            </ul>
            <section id='Credential Offer Parameters for the LEAR Credential issuance flow'><h2>Credential Offer Parameters for the LEAR Credential issuance flow</h2>

                <p>The LEAR Credential profile restricts the options available in <a href="https://openid.github.io/OpenID4VCI/openid-4-verifiable-credential-issuance-wg-draft.html#section-4.1.1">section 4.1.1</a> of [[OpenID.VCI]]. The profile defines a Credential Offer object containing the following parameters:
                </p>
                <ul>
                    <li><code>credential_issuer</code>: REQUIRED. The URL of the Credential Issuer, as defined in <a href="https://openid.github.io/OpenID4VCI/openid-4-verifiable-credential-issuance-wg-draft.html#section-11.2.1">Section 11.2.1</a> of [[OpenID.VCI]], from which the Wallet is requested to obtain one or more Credentials. The Wallet uses it to obtain the Credential Issuer's Metadata following the steps defined in <a href="https://openid.github.io/OpenID4VCI/openid-4-verifiable-credential-issuance-wg-draft.html#section-11.2.2">Section 11.2.2</a>.
                    </li>
                    <li><code>credential_configuration_ids</code>: REQUIRED. Array of unique strings that each identify one of the keys in the name/value pairs stored in the <code>credential_configurations_supported</code> Credential Issuer metadata. The Wallet uses these string values to obtain the respective object that contains information about the Credential being offered as defined in <a href="https://openid.github.io/OpenID4VCI/openid-4-verifiable-credential-issuance-wg-draft.html#section-11.2.3">Section 11.2.3</a> of [[OpenID.VCI]].
                        <div>
                        <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: LEARCredential</p>
                            <p>For the LEAR Credential Issuer, the <code>credential_configuration_ids</code> array MUST contain at least the identifier of the LEAR Credential for employees, which is <code>"LEARCredentialEmployee"</code>. The LEARCredential is a credential known globally to the DOME ecosystem, so its schema should be published and be available in the Trusted Credential Schemas List of DOME.
                            </p>
                        </aside></td></tr></table>
                        </div>
                    </li>
                    <li><code>grants</code>: REQUIRED in the LEAR Credential profile. Object indicating to the Wallet the Grant Types the Credential Issuer's Authorization Server is prepared to process for this Credential Offer. Every grant is represented by a name/value pair. The name is the Grant Type identifier; the value is an object that contains parameters either determining the way the Wallet MUST use the particular grant and/or parameters the Wallet MUST send with the respective request(s). If grants is not present or is empty, the Wallet MUST determine the Grant Types the Credential Issuer's Authorization Server supports using the respective metadata. When multiple grants are present, it is at the Wallet's discretion which one to use.
                    </li>
                </ul>
                <p>The LEAR Credential profile requires <code>grants</code> to have the Grant Type <code>urn:ietf:params:oauth:grant-type:pre-authorized_code</code>:
                </p>
                <ul>
                    <li><code>pre-authorized_code</code>: REQUIRED. The code representing the Credential Issuer's authorization for the Wallet to obtain Credentials of a certain type. This code MUST be short lived and single use. The LEAR Credential issuance uses the Pre-Authorized Code Flow, so this parameter value MUST be included in the subsequent Token Request.
                    </li>
                    <li><code>tx_code</code>: REQUIRED in the LEAR Credential profile. Object specifying whether the Authorization Server expects presentation of a Transaction Code by the End-User along with the Token Request in a Pre-Authorized Code Flow. The Transaction Code is intended to bind the Pre-Authorized Code to a certain transaction to prevent replay of this code by an attacker that, for example, scanned the QR code while standing behind the legitimate End-User. The Transaction Code MUST be sent via a separate channel (eg. using the employee email if it is considered sufficiently secure, or communicating it via whatever secure mechanisms the company has for employee communications). The Transaction Code value MUST be sent in the <code>tx_code</code> parameter with the respective Token Request as defined in <a href="https://openid.github.io/OpenID4VCI/openid-4-verifiable-credential-issuance-wg-draft.html#section-6.1">Section 6.1</a> of [[OpenID.VCI]].
                    </li>
                    <ul>
                        <li><code>input_mode</code> : REQUIRED in the LEAR Credential profile. String specifying the input character set. Possible values are numeric (only digits) and text (any characters). The default is numeric.
                        </li>
                        <li><code>length</code>: REQUIRED in the LEAR Credential profile. Integer specifying the length of the Transaction Code. This helps the Wallet to render the input screen and improve the user experience.
                        </li>
                        <li><code>description</code>: REQUIRED in the LEAR Credential profile. String containing guidance for the Holder of the Wallet on how to obtain the Transaction Code, e.g., describing over which communication channel it is delivered. The Wallet MUST display this description next to the Transaction Code input screen to improve the user experience. The length of the string MUST NOT exceed 300 characters. The description does not support internationalization, however the Issuer MAY detect the Holder's language by previous communication or an HTTP Accept-Language header within an HTTP GET request for a Credential Offer URI.
                        </li>
                        <li><code>interval</code>: OPTIONAL. The minimum amount of time in seconds that the Wallet SHOULD wait between polling requests to the token endpoint (in case the Authorization Server responds with error code authorization_pending - see Section 6.3). If no value is provided, Wallets MUST use 5 as the default.
                        </li>
                        <li><code>authorization_server</code>: OPTIONAL string that the Wallet can use to identify the Authorization Server to use with this grant type when authorization_servers parameter in the Credential Issuer metadata has multiple entries. It MUST NOT be used otherwise. The value of this parameter MUST match with one of the values in the authorization_servers array obtained from the Credential Issuer metadata.
                        </li>
                    </ul>
                </ul>
                <p>The following non-normative example shows a Credential Offer object where the Credential Issuer offers the issuance of one Credential ("LEARCredentialEmployee") by the imaginary company GoodAir:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;credential_issuer&#34;</span>: <span style="color:#d14">&#34;https://credential-issuer.goodair.com&#34;</span>,
    <span style="color:#000080">&#34;credential_configuration_ids&#34;</span>: [
        <span style="color:#d14">&#34;LEARCredentialEmployee&#34;</span>
    ],
    <span style="color:#000080">&#34;grants&#34;</span>: {
        <span style="color:#000080">&#34;urn:ietf:params:oauth:grant-type:pre-authorized_code&#34;</span>: {
            <span style="color:#000080">&#34;pre-authorized_code&#34;</span>: <span style="color:#d14">&#34;oaKazRN8I0IbtZ0C7JuMn5&#34;</span>,
            <span style="color:#000080">&#34;tx_code&#34;</span>: {
                <span style="color:#000080">&#34;length&#34;</span>: <span style="color:#099">6</span>,
                <span style="color:#000080">&#34;input_mode&#34;</span>: <span style="color:#d14">&#34;numeric&#34;</span>,
                <span style="color:#000080">&#34;description&#34;</span>: <span style="color:#d14">&#34;Please provide the one-time code that was sent via corporate e-mail&#34;</span>
            }
        }
    }
}
</pre></td></tr></table>

            </section>
            <section id='Contents of the QR code'><h2>Contents of the QR code</h2>

                <p>Below is a non-normative example of the Credential Offer displayed by the Credential Issuer as a QR code when the Credential Offer is passed by reference, as required in this profile:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://credential-issuer.goodair.com/credential-offer?</span>
<span style="color:#008080">credential_offer_uri</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">https%3A%2F%2Fcredential-issuer%2Egoodair%2Ecom%2Fcredential-offer%2F5j349k3e3n23j</span>
</pre></td></tr></table>

                <p>Which in plain text would be:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://credential-issuer.goodair.com/credential-offer?</span>
<span style="color:#008080">credential_offer_uri</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">https://credential-issuer.goodair.com/credential-offer/5j349k3e3n23j</span>
</pre></td></tr></table>

                <p>To increase security, the Issuer MUST make sure that every Credential Offer URI is unique for all credential offers created. This is the purpose of the nonce (<code>5j349k3e3n23j</code>) at the end of the url in the example. Issuers can implement whatever mechanism they wish, as far as it is transparent to the wallet.
                </p>
            </section>
        </section>
        <section id='Credential Issuer Metadata'><h2>Credential Issuer Metadata</h2>

            <figure class='figureshadow'><img src='builtassets/plantuml_1017987f98f80534afa4276aeeee7e1d.png' alt='Credential Offer'>
            <figcaption>Credential Offer</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_914'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Notify_End-User_924'><b>2. Notify End-User</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
</div>
                </li>
                <li id='3._Access_Issuer_portal_929'><b>3. Access Issuer portal</b>
<div>
                    <p>The employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email)
                    </p>
</div>
                </li>
                <li id='4._Login_with_transaction_code_935'><b>4. Login with transaction code</b>
<div>
                    <p>The portal redirects the user to the login page of the Verifier component of DOME Onboarding.
                    </p>
                    <p>The portal does not require the employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to login and access its Credential Offer.
                    </p>
</div>
                </li>
                <li id='5._Generate_QR_code_941'><b>5. Generate QR code</b>
<div>
                    <p>The Verifier generates a QR code, containing inside the URL of the <code>/authentication-requests</code> endpoint of the Verifier component which will be used to start the [[OpenID.VP]] process.
                    </p>
                    <p>A QR code is used because a Self-Issued OP may be running locally as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://verifier.dome-marketplace.eu/authorization-requests?state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj</span>
</pre></td></tr></table>

</div>
                </li>
                <li id='6._Display_QR_code_950'><b>6. Display QR code</b>
<div>
                    <p>The QR code is displayed in the user browser with instructions to scan it and go to the URL inside it.
                    </p>
                    <figure>
                        <p><img src="images/qrcode-authreq.png" alt="" />
                        </p>
                        <figcaption>QR code with URL to Credential Offer
                        </figcaption>
                    </figure>
</div>
                </li>
                <li id='7._Scan_QR_code_960'><b>7. Scan QR code</b>
<div>
                    <p>The user scans the QR with her wallet and tells the wallet to go to the URL in the QR.
                    </p>
                    <p>In this profile the wallet does not have to implement the Credential Offer Endpoint described in section 4 of [[OpenID.VCI]].
                    </p>
                    <p>Instead, the Credential Issuer renders a QR code containing a reference to the Credential Offer that can be scanned by the End-User using a Wallet, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-4.1">section 4.1</a> of [[OpenID.VCI]].
                    </p>
                    <p>According to the spec, the Credential Offer object is a JSON object containing the Credential Offer parameters and can be sent by value or by reference. To avoid problems with the size of the QR travelling in the URL, this profile requires that the QR contains the <code>credential_offer_uri</code>, which is a URL using the <code>https</code> scheme referencing a resource containing a JSON object with the Credential Offer parameters. The <code>credential_offer_uri</code> endpoint should be implemented by the Issuer backend.
                    </p>
</div>
                </li>
                <li id='8._Get_Credential_Offer_971'><b>8. Get Credential Offer</b>
<div>
</div>
                </li>
                <li id='9._Wallet_obtains_Issuer's_Credential_Issuer_metadata_974'><b>9. Wallet obtains Issuer's Credential Issuer metadata</b>
<div>
                    <p>The Wallet retrieves the Credential Issuer's configuration using the Credential Issuer Identifier, the <code>credential_issuer</code> field in the Credential Offer received before, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-11.2">Section 11.2</a> of [[OpenID.VCI]]. The Wallet needs the metadata to learn the Credential types and formats that the Credential Issuer supports, and to determine the Token Endpoint (at the OAuth 2.0 Authorization Server, which in this case it is the same LEAR Credential Issuer) as well as the Credential Endpoint required to start the request.)
                    </p>
</div>
                </li>
            </ul>
            <section id='Credential Issuer Metadata Parameters'><h2>Credential Issuer Metadata Parameters</h2>

                <p>The LEAR Credential profile defines the following Credential Issuer Metadata parameters:
                </p>
                <ul>
                    <li><code>credential_issuer</code>: REQUIRED. The Credential Issuer's identifier.
                    </li>
                    <li><code>authorization_servers</code>: NOT USED in the LEAR Credential Issuer.
                    </li>
                    <li><code>credential_endpoint</code>: REQUIRED. URL of the Credential Issuer's Credential Endpoint.
                    </li>
                    <li><code>batch_credential_endpoint</code>: NOT USED in the LEAR Credential Issuer.
                    </li>
                    <li><code>deferred_credential_endpoint</code>: NOT USED in the LEAR Credential Issuer. Even when the Credential is not immediately available, the Wallet will send all requests to the <code>credential_endpoint</code>.
                    </li>
                    <li><code>notification_endpoint</code>: NOT USED in the LEAR Credential Issuer.
                    </li>
                    <li><code>credential_response_encryption</code>: NOT USED in the LEAR Credential Issuer.
                    </li>
                    <li><code>credential_identifiers_supported</code>: REQUIRED in the LEAR Credential profile. Boolean value specifying whether the Credential Issuer supports returning <code>credential_identifiers</code> parameter in the <code>authorization_details</code> Token Response parameter. In the LEAR Credential profile it must be <code>true</code> indicating support.
                    </li>
                    <li><code>signed_metadata</code>: NOT USED in the LEAR Credential Issuer.
                    </li>
                    <li><code>display</code>: REQUIRED in the LEAR Credential profile. Array of objects, where each object contains display properties of a Credential Issuer for a certain language. Below is a list with the minimum set of parameters that MUST be included:
                        <div>
                        <ul>
                            <li><code>name</code>: REQUIRED in the LEAR Credential profile. String value of a display name for the Credential Issuer.
                            </li>
                            <li><code>locale</code>: REQUIRED in the LEAR Credential profile. String value that identifies the language of this object represented as a language tag taken from values defined in BCP47 [@!RFC5646]. There MUST be only one object for each language identifier.
                            </li>
                            <li><code>logo</code>: REQUIRED in the LEAR Credential profile. Object with information about the logo of the Credential Issuer. Below is a non-exhaustive list of parameters that MAY be included:
                                <div>
                                <ul>
                                    <li><code>uri</code>: REQUIRED in the LEAR Credential profile. String value that contains a URI where the Wallet can obtain the logo of the Credential Issuer. The Wallet needs to determine the scheme, since the URI value could use the <code>https:</code> scheme, the <code>data:</code> scheme, etc.
                                    </li>
                                    <li><code>alt_text</code>: REQUIRED in the LEAR Credential profile. String value of the alternative text for the logo image.
                                    </li>
                                </ul>
                                </div>
                            </li>
                        </ul>
                        </div>
                    </li>
                    <li><code>credential_configurations_supported</code>: REQUIRED. Object that describes specifics of the Credential that the Credential Issuer supports issuance of. This object contains a list of name/value pairs, where each name is a unique identifier of the supported Credential being described. This identifier is used in the Credential Offer to communicate to the Wallet which Credential is being offered. The LEAR Credential Issuer MUST support at least the LEAR Credential, that is, one of the names in <code>credential_configurations_supported</code> MUST be <code>LEARCredentialEmployee</code> and the value is an object that contains metadata about the that LEAR Credential and contains the following parameters defined by the LEAR Credential profile:
                        <div>
                        <ul>
                            <li><code>format</code>: REQUIRED. A JSON string identifying the format of the LEAR Credential, which MUST be <code>jwt_vc_json</code>. The object contains further elements defining this type and additional particular claims and information about how to display the Credential. See the Credential Format Profile for more details.
                            </li>
                            <li><code>scope</code>: The LEAR Credential profile does not use this field.
                            </li>
                            <li><code>cryptographic_binding_methods_supported</code>: REQUIRED by the LEAR Credential profile. Array of case sensitive strings that identify the representation of the cryptographic key material that the issued Credential is bound to. The LEAR Credential profile uses the <code>did:key</code> for the Cryptographic Binding Method, so the value for <code>cryptographic_binding_methods_supported</code> is an array with a single value, which MUST be <code>did:key</code>.
                            </li>
                            <li><code>credential_signing_alg_values_supported</code>: REQUIRED by the LEAR Credential profile. The value MUST be an array with at least the value <code>ES256</code>. Other additional values may be supported.
                            </li>
                            <li><code>proof_types_supported</code>: REQUIRED by the LEAR Credential profile. Object that describes specifics of the key proof(s) that the Credential Issuer supports. This object contains a list of name/value pairs, where each name is a unique identifier of the supported proof type(s). One of the names in the list of name/value pairs MUST be <code>jwt</code>, and its value is the object <code>proof_signing_alg_values_supported</code> specified below:
                                <div>
                                <ul>
                                    <li><code>proof_signing_alg_values_supported</code>: REQUIRED. Array of case sensitive strings that identify the algorithms that the Issuer supports for this proof type. For the LEAR Credential profile the array MUST contain at least the <code>ES256</code> value.
                                    </li>
                                </ul>
                                </div>
                            </li>
                            <li><code>display</code>: REQUIRED by the LEAR Credential profile. Array of objects, where each object contains the display properties of the LEAR Credential for a certain language. Below is a non-exhaustive list of parameters that MAY be included.
                                <div>
                                <ul>
                                    <li><code>name</code>: REQUIRED. String value of a display name for the Credential. For the LEAR Credential profile it MUST be <code>LEAR Credential for Employee</code>.
                                    </li>
                                    <li><code>locale</code>: OPTIONAL. String value that identifies the language of this object represented as a language tag taken from values defined in BCP47 [@!RFC5646]. Multiple <code>display</code> objects MAY be included for separate languages. There MUST be only one object for each language identifier.
                                    </li>
                                    <li><code>logo</code>: REQUIRED by the LEAR Credential profile. Object with information about the logo of the Credential. The following non-exhaustive set of parameters MAY be included:
                                        <div>
                                        <ul>
                                            <li><code>uri</code>: REQUIRED. String value that contains a URI where the Wallet can obtain the logo of the LEAR Credential from the Credential Issuer. The Wallet needs to determine the scheme, since the URI value could use the <code>https:</code> scheme, the <code>data:</code> scheme, etc.
                                            </li>
                                            <li><code>alt_text</code>: OPTIONAL. String value of the alternative text for the logo image.
                                            </li>
                                        </ul>
                                        </div>
                                    </li>
                                    <li><code>description</code>: OPTIONAL. String value of a description of the Credential.
                                    </li>
                                    <li><code>background_color</code>: OPTIONAL. String value of a background color of the Credential represented as numerical color values defined in CSS Color Module Level 37 [@!CSS-Color].
                                    </li>
                                    <li><code>background_image</code>: OPTIONAL. Object with information about the background image of the Credential. At least the following parameter MUST be included:
                                        <div>
                                        <ul>
                                            <li><code>uri</code>: REQUIRED. String value that contains a URI where the Wallet can obtain the background image of the Credential from the Credential Issuer. The Wallet needs to determine the scheme, since the URI value could use the <code>https:</code> scheme, the <code>data:</code> scheme, etc.
                                            </li>
                                        </ul>
                                        </div>
                                    </li>
                                    <li><code>text_color</code>: OPTIONAL. String value of a text color of the Credential represented as numerical color values defined in CSS Color Module Level 37 [@!CSS-Color].
                                    </li>
                                </ul>
                                </div>
                            </li>
                            <li><code>credential_definition</code>: REQUIRED by the LEAR Credential profile. Object containing the detailed description of the Credential type. It consists of at least the following two parameters:
                                <div>
                                <ul>
                                    <li><code>type</code>: REQUIRED. For the LEAR Credential profile it is an array with the following value: <code>["VerifiableCredential", "LEARCredentialEmployee"]</code>.
                                    </li>
                                    <li><code>credentialSubject</code>: MUST NOT be used for the LEAR Credential profile. The LEAR Credential is a well-know type of Credential in the DOME ecosystem and its properties are common across all participants, and possible inconsistencies between the "official" definition and the one used by a LEAR Credential Issuer have to be avoided.
                                    </li>
                                    <li><code>order</code>: MUST NOT be used for the LEAR Credential profile. To make the use of the LEAR Credential safer for End-Users, all Wallets MUST use the "official" definition of the LEAR Credential, which includes the <code>order</code> field.
                                    </li>
                                </ul>
                                </div>
                            </li>
                        </ul>
                        </div>
                    </li>
                </ul>
                <p>As allowed by <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-11.2.3">Section 11.2.3</a> of [[OpenID.VCI]], for the LEAR Credential profile the <code>response_types_supported</code> parameter MUST NOT appear in the metadata of the LEAR Credential Issuer despite [RFC8414] mandating it, because the LEAR Credential Issuer only supports the Pre-Authorized Code grant type.
                </p>
            </section>
        </section>
        <section id='OAuth 2.0 Authorization Server Metadata'><h2>OAuth 2.0 Authorization Server Metadata</h2>

            <p>This specification also defines a new OAuth 2.0 Authorization Server metadata [[RFC8414]] parameter to publish whether the AS that the Credential Issuer relies on for authorization, supports anonymous Token Requests with the Pre-authorized Grant Type. It is defined as follows:
            </p>
            <ul>
                <li><code>pre-authorized_grant_anonymous_access_supported</code>: REQUIRED by the LEAR Credential profile. A JSON Boolean indicating whether the issuer accepts a Token Request with a Pre-Authorized Code but without a client id. It must be <code>true</code>.
                </li>
            </ul>
        </section>
        <section id='Request an Access Token'><h2>Request an Access Token</h2>

            <figure class='figureshadow'><img src='builtassets/plantuml_483555d70fa11b7bf69cd3d4f399f3bd.png' alt='Request Access Token'>
            <figcaption>Request Access Token</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1._Enter_information_about_the_Employee_1104'><b>1. Enter information about the Employee</b>
<div>
                    <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                    </p>
                    <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                    </p>
                    <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                    </p>
</div>
                </li>
                <li id='2._Notify_End-User_1114'><b>2. Notify End-User</b>
<div>
                    <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                    </p>
</div>
                </li>
                <li id='3._Access_Issuer_portal_1119'><b>3. Access Issuer portal</b>
<div>
                    <p>The employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email)
                    </p>
</div>
                </li>
                <li id='4._Login_with_transaction_code_1125'><b>4. Login with transaction code</b>
<div>
                    <p>The portal redirects the user to the login page of the Verifier component of DOME Onboarding.
                    </p>
                    <p>The portal does not require the employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to login and access its Credential Offer.
                    </p>
</div>
                </li>
                <li id='5._Generate_QR_code_1131'><b>5. Generate QR code</b>
<div>
                    <p>The Verifier generates a QR code, containing inside the URL of the <code>/authentication-requests</code> endpoint of the Verifier component which will be used to start the [[OpenID.VP]] process.
                    </p>
                    <p>A QR code is used because a Self-Issued OP may be running locally as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://verifier.dome-marketplace.eu/authorization-requests?state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj</span>
</pre></td></tr></table>

</div>
                </li>
                <li id='6._Display_QR_code_1140'><b>6. Display QR code</b>
<div>
                    <p>The QR code is displayed in the user browser with instructions to scan it and go to the URL inside it.
                    </p>
                    <figure>
                        <p><img src="images/qrcode-authreq.png" alt="" />
                        </p>
                        <figcaption>QR code with URL to Credential Offer
                        </figcaption>
                    </figure>
</div>
                </li>
                <li id='7._Scan_QR_code_1150'><b>7. Scan QR code</b>
<div>
                    <p>The user scans the QR with her wallet and tells the wallet to go to the URL in the QR.
                    </p>
                    <p>In this profile the wallet does not have to implement the Credential Offer Endpoint described in section 4 of [[OpenID.VCI]].
                    </p>
                    <p>Instead, the Credential Issuer renders a QR code containing a reference to the Credential Offer that can be scanned by the End-User using a Wallet, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-4.1">section 4.1</a> of [[OpenID.VCI]].
                    </p>
                    <p>According to the spec, the Credential Offer object is a JSON object containing the Credential Offer parameters and can be sent by value or by reference. To avoid problems with the size of the QR travelling in the URL, this profile requires that the QR contains the <code>credential_offer_uri</code>, which is a URL using the <code>https</code> scheme referencing a resource containing a JSON object with the Credential Offer parameters. The <code>credential_offer_uri</code> endpoint should be implemented by the Issuer backend.
                    </p>
</div>
                </li>
                <li id='8._Get_Credential_Offer_1161'><b>8. Get Credential Offer</b>
<div>
</div>
                </li>
                <li id='9._Wallet_obtains_Issuer's_Credential_Issuer_metadata_1164'><b>9. Wallet obtains Issuer's Credential Issuer metadata</b>
<div>
                    <p>The Wallet retrieves the Credential Issuer's configuration using the Credential Issuer Identifier, the `credential_issuer' field in the Credential Offer received before, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-11.2">Section 11.2</a> of [[OpenID.VCI]]. The Wallet needs the metadata to learn the Credential types and formats that the Credential Issuer supports, and to determine the Token Endpoint (at the OAuth 2.0 Authorization Server, which in this case it is the same LEAR Credential Issuer) as well as the Credential Endpoint required to start the request.)
                    </p>
</div>
                </li>
                <li id='10._Token_Request_1170'><b>10. Token Request</b>
<div>
                    <p>The Wallet invokes the Token Endpoint implemented by the Authorization Server, which issues an Access Token and, optionally, a Refresh Token in exchange for the Pre-authorized Code that the wallet obtained in the Credential Offer.
                    </p>
</div>
                </li>
            </ul>
            <section id='Token Request'><h2>Token Request</h2>

                <p>The Token Request is made as defined in Section 4.1.3 of [[RFC6749]].
                </p>
                <p>The following are the extension parameters to the Token Request used by the LEAR Credential profile in the Pre-Authorized Code Flow:
                </p>
                <ul>
                    <li><code>pre-authorized_code</code>: REQUIRED in the LEAR Credential profile. The code representing the authorization to obtain the LEAR Credential.
                    </li>
                    <li><code>tx_code</code>: REQUIRED in the LEAR Credential profile. String value containing a Transaction Code. This value MUST have the same value as the <code>tx_code</code> object present in the Credential Offer.
                    </li>
                </ul>
                <p>For the LEAR Credential profile, authentication of the Client (which corresponds to the Wallet) is NOT USED, and, consequently, the <code>client_id</code> parameter is NOT USED.
                </p>
                <p>The request parameter <code>authorization_details</code> MUST be used to convey the fact that the Wallet wants to obtain the LEAR Credential, by supplying the value of its <code>credential_configuration_id</code> specified in the Credential Offer. The authorization details type MUST be <code>openid_credential</code> and includes the following parameters to be used with this authorization details type:
                </p>
                <ul>
                    <li><code>type</code>: REQUIRED. String that determines the authorization details type. It MUST be set to <code>openid_credential</code> for the purpose of this specification.
                    </li>
                    <li><code>credential_configuration_id</code>: REQUIRED for the LEAR CRedential profile. String specifying a unique identifier of the LEAR Credential being described in the <code>credential_configurations_supported</code> map in the Credential Issuer Metadata. It MUST be <code>LEARCredentialEmployee</code>.
                    </li>
                    <li><code>format</code>: MUST NOT be used for the LEAR Credential profile.
                    </li>
                </ul>
                <p>The following is a non-normative example of an <code>authorization_details</code> object with a <code>credential_configuration_id</code>:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
[
    {
        <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;openid_credential&#34;</span>,
        <span style="color:#000080">&#34;credential_configuration_id&#34;</span>: <span style="color:#d14">&#34;LEARCredentialEmployee&#34;</span>
    }
]
</pre></td></tr></table>

                <p>The Token Request MUST NOT contain a scope value related to Credential issuance.
                </p>
                <p>Below is a non-normative example of a Token Request in a Pre-Authorized Code Flow for the LEAR Credential profile:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#900;font-weight:bold">POST</span> <span style="color:#555">/token</span> <span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span>
Host<span style="color:#000;font-weight:bold">:</span> credential-issuer.goodair.com
Content-Type<span style="color:#000;font-weight:bold">:</span> application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:pre-authorized_code
&amp;pre-authorized_code=SplxlOBeZQQYbYS6WxSbIA
&amp;authorization_details=%5B%7B%22type%22%3A%20%22openid_credential%22%2C%20%22
    credential_configuration_id%22%3A%20%22LEARCredentialEmployee%22%7D%5D
&amp;tx_code=493536
</pre></td></tr></table>

            </section>
            <section id='Successful Token Response'><h2>Successful Token Response</h2>

                <p>Token Responses are made as defined in [[RFC6749]].
                </p>
                <p>For the LEAR Credential profile, the LEAR Credential Issuer MUST NOT authorize issuance of multiple instances of the LEAR CRedential with the same Access Token.
                </p>
                <p>In addition to the response parameters defined in [[RFC6749]], the LEAR Credential Issuer MUST return the following parameters:
                </p>
                <ul>
                    <li><code>c_nonce</code>: REQUIRED for the LEAR Credential profile. String containing a nonce to be used when creating a proof of possession of the key proof in the Credential Request endpoint. The Wallet MUST use this nonce value for its subsequent requests until the Credential Issuer provides a fresh nonce.
                    </li>
                    <li><code>c_nonce_expires_in</code>: REQUIRED. Number denoting the lifetime in seconds of the <code>c_nonce</code>.
                    </li>
                    <li><code>authorization_details</code>: REQUIRED for the LEAR Credential profile. It is an array of objects, as defined in Section 7 of [[RFC9396]]. In addition to the parameters defined for the <code>authorization_details</code> in the Token Request, this specification defines the following parameter to be used with the authorization details type <code>openid_credential</code> in the Token Response:
                    </li>
                    <ul>
                        <li><code>credential_configuration_id</code>: REQUIRED for the LEAR Credential profile. It is an array containing only one string, uniquely identifying the LEAR Credential and MUST be <code>LEARCredentialEmployee</code>.
                        </li>
                    </ul>
                </ul>
                <p>Below is a non-normative example of a Token Response:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span> <span style="color:#099">200</span> <span style="color:#900;font-weight:bold">OK</span>
Content-Type<span style="color:#000;font-weight:bold">:</span> application/json
Cache-Control<span style="color:#000;font-weight:bold">:</span> no-store

{
    <span style="color:#000080">&#34;access_token&#34;</span>: <span style="color:#d14">&#34;eyJhbGciOiJSUzI1NiIsInR5cCI6Ikp..sHQ&#34;</span>,
    <span style="color:#000080">&#34;token_type&#34;</span>: <span style="color:#d14">&#34;bearer&#34;</span>,
    <span style="color:#000080">&#34;expires_in&#34;</span>: <span style="color:#099">86400</span>,
    <span style="color:#000080">&#34;c_nonce&#34;</span>: <span style="color:#d14">&#34;tZignsnFbp&#34;</span>,
    <span style="color:#000080">&#34;c_nonce_expires_in&#34;</span>: <span style="color:#099">86400</span>,
    <span style="color:#000080">&#34;authorization_details&#34;</span>: [
        {
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;openid_credential&#34;</span>,
            <span style="color:#000080">&#34;credential_configuration_id&#34;</span>: <span style="color:#d14">&#34;UniversityDegreeCredential&#34;</span>
        }
    ]
}
</pre></td></tr></table>

            </section>
            <section id='Token Error Response'><h2>Token Error Response</h2>

                <p>If the Token Request is invalid or unauthorised, the Authorization Server constructs the error response as defined in section 6.3 of [[OpenID.VCI]].
                </p>
            </section>
        </section>
        <section id='Request and receive Credential'><h2>Request and receive Credential</h2>

            <figure id='issuance_requestcredential_1'>
                <p><img src="images/issuance/issuance_requestcredential.svg" alt="" />
                </p>
                <figcaption>Request and receive Credential.
                </figcaption>
            </figure>
            <p>The Wallet backend invokes the Credential Endpoint, which issues a Credential as approved by the End-User upon presentation of a valid Access Token representing this approval.
            </p>
            <p>Communication with the Credential Endpoint MUST utilise TLS.
            </p>
            <p>The client can request issuance of a Credential of a certain type multiple times, e.g., to associate the Credential with different public keys/Decentralised Identifiers (DIDs) or to refresh a certain Credential.
            </p>
            <p>If the Access Token is valid for requesting issuance of multiple Credentials, it is at the client's discretion to decide the order in which to request issuance of multiple Credentials requested in the Authorization Request.
            </p>
            <section id='binding-id-holder'><h2>Binding the Issued Credential to the identifier of the End-User possessing that Credential</h2>

                <p>The Issued Credential MUST be cryptographically bound to the identifier of the End-User who possesses the Credential. Cryptographic binding allows the Verifier to verify during the presentation of a Credential that the End-User presenting a Credential is the same End-User to whom that Credential was issued.
                </p>
                <p>The Wallet has to provide proof of control alongside key material using the mechanism described below.
                </p>
            </section>
            <section id='Credential Request'><h2>Credential Request</h2>

                <p>The Wallet backend makes a Credential Request to the Credential Endpoint by sending the following parameters in the entity-body of an HTTP POST request using the <code>application/json</code> media type.
                </p>
                <ul>
                    <li><code>format</code>: REQUIRED. This profile uses the Credential format identifier <code>jwt_vc_json</code>.
                    </li>
                    <li><code>proof</code>: OPTIONAL. JSON object containing proof of possession of the key material the issued Credential shall be bound to. The specification envisions use of different types of proofs for different cryptographic schemes. The proof object MUST contain a <code>proof_type</code> claim of type JSON string denoting the concrete proof type. This type determines the further claims in the proof object and its respective processing rules. Proof types are defined in Section [[[#proof_type]]].
                    </li>
                </ul>
                <p>The proof element MUST incorporate a <code>c_nonce</code> value generated by the Credential Issuer and the Credential Issuer Identifier (audience) to allow the Credential Issuer to detect replay. The way that data is incorporated depends on the proof type. In a JWT, for example, the <code>c_nonce</code> is conveyed in the <code>nonce</code> claim whereas the audience is conveyed in the <code>aud</code> claim. In a Linked Data proof, for example, the <code>c_nonce</code> is included as the challenge element in the proof object and the Credential Issuer (the intended audience) is included as the domain element.
                </p>
                <section id='proof_type'><h2>Proof Type</h2>

                    <p>This specification defines only one value for <code>proof_type</code>:
                    </p>
                    <p><code>jwt</code>: objects of this type contain a single jwt element with a JWS [[RFC7515]] as proof of possession. The JWT MUST contain the following elements:
                        <ul>
                            <li>in the JOSE Header,
                                <div>
                                <ul>
                                    <li><code>typ</code>: REQUIRED. MUST be <code>openid4vci-proof+jwt</code>, which explicitly types the proof JWT as recommended in Section 3.11 of [[RFC8725]].
                                    </li>
                                    <li><code>alg</code>: REQUIRED. A digital signature algorithm identifier such as per IANA "JSON Web Signature and Encryption Algorithms" registry. MUST NOT be none or an identifier for a symmetric algorithm (MAC).
                                    </li>
                                    <li><code>kid</code>: REQUIRED. JOSE Header containing the key ID. The Credential will be bound to a DID, so the kid refers to a DID URL which identifies a particular key in the DID Document that the Credential will be bound to.
                                    </li>
                                </ul>
                                </div>
                            </li>
                            <li>in the JWT body,
                                <div>
                                <ul>
                                    <li><code>aud</code>: REQUIRED (string). The value of this claim MUST be the Credential Issuer URL of the Credential Issuer.
                                    </li>
                                    <li><code>iat</code>: REQUIRED (number). The value of this claim MUST be the time at which the proof was issued using the syntax defined in [[RFC7519]].
                                    </li>
                                    <li><code>nonce</code>: REQUIRED (string). The value type of this claim MUST be a string, where the value is the <code>c_nonce</code> provided by the Credential Issuer.
                                    </li>
                                </ul>
                                </div>
                            </li>
                        </ul>
                    </p>
                    <p>The Credential Issuer MUST validate that the proof is actually signed by a key identified in the JOSE Header.
                    </p>
                    <p>Below is a non-normative example of a proof parameter (dots in the middle of jwt for display purposes only), for the example of issuing a LEARCredential:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;proof_type&#34;</span>: <span style="color:#d14">&#34;jwt&#34;</span>,
    <span style="color:#000080">&#34;jwt&#34;</span>: <span style="color:#d14">&#34;eyJraWQiOiJkaWQ6ZXhhb....aZKPxgihac0aW9EkL1nOzM&#34;</span>
}
</pre></td></tr></table>

                    <p>where the JWT looks like this:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;typ&#34;</span>: <span style="color:#d14">&#34;openid4vci-proof+jwt&#34;</span>,
    <span style="color:#000080">&#34;alg&#34;</span>: <span style="color:#d14">&#34;ES256&#34;</span>,
    <span style="color:#000080">&#34;kid&#34;</span>:<span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>
}

{
    <span style="color:#000080">&#34;iss&#34;</span>: <span style="color:#d14">&#34;s6BhdRkqt3&#34;</span>,
    <span style="color:#000080">&#34;aud&#34;</span>: <span style="color:#d14">&#34;https://www.goodair.com&#34;</span>,
    <span style="color:#000080">&#34;iat&#34;</span>: <span style="color:#099">1659145924</span>,
    <span style="color:#000080">&#34;nonce&#34;</span>: <span style="color:#d14">&#34;tZignsnFbp&#34;</span>
}
</pre></td></tr></table>

                    <p>In the example of a LEARCredential, the wallet generates a pair of public/private keys and a <code>did:key</code> identifier which is univocally related to the public key. This is the reason why the <code>kid</code> field above is exactly the DID identifier under this DID method. The <code>did:key</code> method is very simple and achieves a very high degree of privacy, allowing the creation of many different identifiers which can be one-use only if so desired.
                    </p>
                    <p>The <code>did:key</code> method is perfect for the requirements of our usage of the LEARCredential. Any other suitable DID method can be used if it is required, but this is out of scope for this profile.
                    </p>
                </section>
            </section>
            <section id='Credential Response'><h2>Credential Response</h2>

                <p>This profile restricts Credential Response to be Synchronous and Deferred response is not used. The Credential Issuer MUST be able to immediately issue a requested Credential and send it to the Client.
                </p>
                <p>The following claims are used in the Credential Response:
                </p>
                <ul>
                    <li><code>format</code>: REQUIRED. JSON string denoting the format of the issued Credential. This profile uses the format identifier <code>jwt_vc_json</code>.
                    </li>
                    <li><code>credential</code>: REQUIRED. Contains issued Credential. MUST be a JSON string.
                    </li>
                    <li><code>c_nonce</code>: OPTIONAL. JSON string containing a nonce to be used to create a proof of possession of key material when requesting a Credential. When received, the Wallet MUST use this nonce value for its subsequent credential requests until the Credential Issuer provides a fresh nonce.
                    </li>
                    <li><code>c_nonce_expires_in</code>: OPTIONAL. JSON integer denoting the lifetime in seconds of the c_nonce.
                    </li>
                </ul>
                <p>Below is a non-normative example of a Credential Response:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span> <span style="color:#099">200</span> <span style="color:#900;font-weight:bold">OK</span>
Content-Type<span style="color:#000;font-weight:bold">:</span> application/json
Cache-Control<span style="color:#000;font-weight:bold">:</span> no-store

{
    <span style="color:#000080">&#34;format&#34;</span>: <span style="color:#d14">&#34;jwt_vc_json&#34;</span>,
    <span style="color:#000080">&#34;credential&#34;</span> : <span style="color:#d14">&#34;LUpixVCWJk0eOt4CXQe1NXK....WZwmhmn9OQp6YxX0a2L&#34;</span>,
    <span style="color:#000080">&#34;c_nonce&#34;</span>: <span style="color:#d14">&#34;fGFF7UkhLa&#34;</span>,
    <span style="color:#000080">&#34;c_nonce_expires_in&#34;</span>: <span style="color:#099">86400</span>
}
</pre></td></tr></table>

            </section>
            <section id='Credential Error Response'><h2>Credential Error Response</h2>

                <p>When the Credential Request is invalid or unauthorised, the Credential Issuer constructs the error response as defined in section 7.3.1 of OIDCVCI.
                </p>
            </section>
            <section id='Credential Issuer Provided Nonce'><h2>Credential Issuer Provided Nonce</h2>

                <p>Upon receiving a Credential Request, the Credential Issuer MUST require the Wallet to send a proof of possession of the key material it wants a Credential to be bound to. This proof MUST incorporate a nonce generated by the Credential Issuer. The Credential Issuer will provide the client with a nonce in an error response to any Credential Request not including such a proof or including an invalid proof.
                </p>
                <p>Below is a non-normative example of a Credential Response with the Credential Issuer requesting a Wallet to provide in a subsequent Credential Request a proof that is bound to a <code>c_nonce</code>:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span> <span style="color:#099">400</span> <span style="color:#900;font-weight:bold">Bad Request</span>
Content-Type<span style="color:#000;font-weight:bold">:</span> application/json
Cache-Control<span style="color:#000;font-weight:bold">:</span> no-store

{
    <span style="color:#000080">&#34;error&#34;</span>: <span style="color:#d14">&#34;invalid_or_missing_proof&#34;</span>,
    <span style="color:#000080">&#34;error_description&#34;</span>:
        <span style="color:#d14">&#34;Credential Issuer requires proof to be bound to a Credential Issuer provided nonce.&#34;</span>,
    <span style="color:#000080">&#34;c_nonce&#34;</span>: <span style="color:#d14">&#34;8YE9hCnyV2&#34;</span>,
    <span style="color:#000080">&#34;c_nonce_expires_in&#34;</span>: <span style="color:#099">86400</span>
}
</pre></td></tr></table>

            </section>
        </section>
    </section>
    <section id='issuing-lear-credential-seal'><h2>Issuing the LEARCredential using a certificate for seals</h2>

        <p>Issuing a LEAR Credential with a certificate for seals is essentially the same as issuing it with a certificate for signatures, with the exception that the actual signing step can be fully automated and there is no need for the legal representative to explicitly authorise the signature. This is represented in the following diagram:
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_37a56f8ad96e0304d1f9b8a873979078.png' alt='Issuance with a seal'>
        <figcaption>Issuance with a seal</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

        <ul class='plain'>
            <li id='1._Enter_information_about_the_Employee_1441'><b>1. Enter information about the Employee</b>
<div>
                <p>The HR employee uses an HTML form provided by the LEAR Credential Issuer application to input the required data about the employee. The application enables also to provide such data with a YAML file, to facilitate automation of the process.
                </p>
                <p>The required data includes name, surname, contact data (phone and company email), and the roles that the employee is authorised to perform. For simplicity we assume here the role <code>onboarder</code>, but the HR employee can specify a list of roles relevant for DOME.
                </p>
                <p>Once the data is completed, the HR employee confirms the operation and the LEAR Credential Issuer notifies the Appointed Employee using the company email provided.
                </p>
</div>
            </li>
            <li id='2._Credential_Offer_1450'><b>2. Credential Offer</b>
<div>
                <p>The employee receives an email from the LEAR Credential Issuer with the proper instructions, including a unique <code>transaction code</code> that the employee requires to start the process for receiving the LEAR Credential.
                </p>
                <p>The Appointed employee enters into the HTML portal provided by the LEAR Credential Issuer (the URL of the portal is well-known, but it is also described in the email).
                </p>
                <p>The portal does not require the Appointed employee to be pre-registered in the application, because the unique <code>transaction code</code> received via email is used to access its Credential Offer.
                </p>
                <p>Once the employee enters the <code>transaction code</code> in the portal, a QR code is displayed with the content of Credential Offer (compliant with the OpenID4VCI protocol).
                </p>
                <p>The employee scans the QR code with her Wallet. She can use the Wallet provided by DOME, or any other which is compatible. This includes the possibility that the company provides employees with its own Wallet, which could even be a branded version of the DOME Wallet.
                </p>
</div>
            </li>
            <li id='3._Wallet_obtains_Issuer's_Credential_Issuer_metadata_1464'><b>3. Wallet obtains Issuer's Credential Issuer metadata</b>
<div>
                <p>The Wallet uses the Credential Issuer's URL to fetch its metadata, as described in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-11.2">Section 11.2</a> of [[OpenID.VCI]]. The Wallet needs the metadata to learn the Credential types and formats that the Credential Issuer supports, and to determine the Token Endpoint (at the OAuth 2.0 Authorization Server) as well as the Credential Endpoint required to start the request.)
                </p>
</div>
            </li>
            <li id='4._Token_Request_1472'><b>4. Token Request</b>
<div>
                <p>The Wallet sends the Pre-Authorized Code obtained in Step (2) in the Token Request to the Token Endpoint. The Wallet will additionally send a Transaction Code provided by the End-User, if it was required by the Credential Issuer. This step is defined in <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#section-6">Section 6</a> of [[OpenID.VCI]].
                </p>
</div>
            </li>
            <li id='5._Credential_Request_1480'><b>5. Credential Request</b>
<div>
                <p>The Wallet sends a Credential Request to the Credential Issuer's Credential Endpoint with the Access Token and the proof of possession of the private key of a key pair to which the Credential Issuer should bind the issued Credential to. Upon successfully validating Access Token and proof, the Credential Issuer returns a Credential in the Credential Response.
                </p>
</div>
            </li>
            <li id='6._The_Credential_is_sealed_with_the_certificate_1486'><b>6. The Credential is sealed with the certificate</b>
<div>
                <p>The secure server seals the credential with the eIDAS certificate.
                </p>
</div>
            </li>
        </ul>
    </section>
</section>
<section id='Problem Statement' class='appendix'><h2>Problem Statement</h2>

    <p>Representation powers and mandates are an essential element for businesses establishing relationships with other businesses, governments and customers, because in many cases <b>natural persons act on behalf of legal persons</b> and depending on the sensitivity of the involved data/processes the Relying Party may want to enforce a high level of legal compliance and reduce associated legal risks.
    </p>
    <p>Electronic powers of representation and mandates are an <b>explicit objective of the European Digital Identity Wallet</b> (EDIW) and the proposed amendment to eIDAS to support it:
    </p>
    <blockquote>
        <p>To achieve <b>simplification and cost reduction benefits to persons and businesses across the Union, including by enabling powers of representation and e-mandates</b>, Member States should issue EDIWs relying on common standards and technical specifications to ensure seamless interoperability and to adequately increase the IT security, strengthen robustness against cyber-attacks and thus significantly reduce the potential risks of ongoing digitalisation for citizens and businesses.
        </p>
        <figcaption>—[[[eIDAS2.Regulation]]]
        </figcaption>
    </blockquote>
    <p>The traditional way to solve the problem of powers of representation is by using cumbersome processes associated to onboarding and Know-Your-Customer (KYC) procedures, in many cases manual processes and paper/PDF documents that the Relying Party verifies until it is satisfied with the level of legal risk assumed when allowing a Principal to access some services on behalf of the Participant. Those setup processes are normally cumbersome, slow and people-intensive, creating a lot of friction in the initial stages of using a service, especially when strong identification is required by the nature of the service.
    </p>
    <p>Standard eIDAS certificates of representation can help (see an example <a href="https://eadtrust.eu/en/electronic-certificates/legal-entity-representative/">Certificate of Legal Entity Representative</a> issued by a qualified trust service provider), but they tend to be for natural persons with full powers of representation, or for very standard use cases.
    </p>
    <p>For a more granular specification of the powers of a natural person when acting on behalf of a legal person, other solutions have been implemented in different Member States, but they are typically centralised, non-interoperable among countries and limited to the services provided by the Public Administration. In the private sector there is not any standardised solution and basically every company does it their own way.
    </p>
    <p><b>Verifiable Credentials</b> can be a good instrument to implement a machine-readable and legally-binding e-mandate with much more descriptive power and flexibility than trying to use just certificates of representation, while maintaining the same level of compliance and legal risk than with traditional processes, and this is the reason why it is included in the objectives of the upcoming eIDAS2 regulation.
    </p>
    <p>However, currently there are important barriers that hinder the adoption of an EU-wide solution for cross-border transfer of representation information, one of the most relevant being the <b>lack of a common semantic framework</b>.
    </p>
    <p>Representation is complex, and electronic mandates schemes and policies are basically national and usually do not contemplate the possibility to use those mandates in cross-border scenarios. The problem of mandates when accessing services from a Public Administration is extremely complex, so <b>we focus here on the private sector</b>: when the Relying Party is a legal person from the private sector.
    </p>
    <p>In order to have a simple, flexible and powerful mechanism using Verifiable Credentials, the main requirements are the following:
    </p>
    <ul>
        <li id='REQ-01_1524'><b>REQ-01</b>: <b>The credential is an e-mandate</b>, by embedding authorisation information in the credential and binding it to the identities of the issuer and subject. We call such a credential a "Verifiable Authorisation".
            <div>
            <p>There must be a <b>controlled vocabulary</b> that can be used to express in a formal language (e.g. ODRL) the semantics of the powers delegated to a Principal by the Participant.
            </p>
            </div>
        </li>
        <li id='REQ-02_1528'><b>REQ-02</b>: <b>The Relying Party does not have to know in advance the Principal</b> accessing its services on behalf of a Participant.
            <div>
            <p>However, the Relying Party should have an easy authentication mechanism based on Verifiable Credentials to ensure that the entity accessing the services is the same entity identified in the e-mandate, and so that it has the required powers to access the service.
            </p>
            </div>
            <div>
            <p>Ideally, to simplify the authentication and authorisation process for the Relying Party, the same credential that is a mandate (we call it a Verifiable Authorisation) can be used for authentication (we call it a VerifiableID). Of course, we could use different credentials and even a "traditional" authentication mechanism, but having a single credential that can be used both for authentication and authorisation (using the powers specified in the mandate) is what we describe here.
            </p>
            </div>
        </li>
        <li id='REQ-03_1534'><b>REQ-03</b>: There may be several Principals accessing the services of a Relying Party on behalf of the same Participant, and each Principal may have different powers assigned by the Participant that enable them to access different (possibly overlapping) sets of services with different privileges.
            <div>
            <p>The Relying Party specifies the powers that need to be validated for each service (the scope the access is requested on, and the type of representation that the Service provider allows). Each individual service may require different sets of powers, at the sole discretion of the Relying Partly (of course always in synch with the agreement formalised with the Participant).
            </p>
            </div>
            <div>
            <p>The Participant grants the authorisations to the Principals at its own discretion. Only the Principals that have the powers required by an individual service can access that service. The Participant may have more powers than strictly required (for example, full representation of the legal entity).
            </p>
            </div>
        </li>
        <li id='REQ-04_1540'><b>REQ-04</b>: The Relying Party can <b>reduce the legal risks and associated costs of litigation</b> in court by leveraging the <b>presumption of non-repudiation</b> associated to the use of an eIDAS advanced/qualified seal/signature for the Verifiable Credential.
            <div>
            <p>Of course, the Relying Party is free to request from Participants other types of signatures, if it is willing to assume the higher level of legal risk. We define here a mechanism which can have the same level as a document with a handwritten signature (when using qualified electronic signatures/seals).
            </p>
            </div>
            <div>
            <p>In this way the credential is a <b>legally binding machine-readable document where the issuer (Participant) attests that it delegates the set of powers specified in the credential to the user identified as the subject of the credential (Principal)</b>.
            </p>
            </div>
        </li>
        <li id='REQ-05_1546'><b>REQ-05</b>: The Relying Party can verify that the issuer of the credential corresponds to a <b>real-world identity which is fully accountable</b> for the contents of the credential, without needing any additional third-party, trust framework or participant list associated to a given Data Space or Federation.
            <div>
            <p>Using an eIDAS signature/seal for the credential, the current EU legal and trust framework in place since 2016 is enough for the Relying Party to verify that the Participant has issued a legally-binding mandate to the Principal.
            </p>
            </div>
        </li>
    </ul>
    <p>With all these properties, the credential is a <b>legally binding machine-readable document where the issuer attests that it delegates the set of powers specified in the credential to the user identified as the subject of the credential</b>. The subject can then <b>use the credential to authenticate to a Relying Party</b> because the identities of holder and subject are bound.
    </p>
    <p>This mechanism leverages the eIDAS trust framework using advanced or qualified signatures and seals to provide a <b>high level of legal certainty and enjoying the presumption of non-repudiation in the courts</b>, something that does not happen when using other types of basic signatures.
    </p>
</section>
<section id='Introduction to Authentication and Authorization with Verifiable Credentials'><h2>Introduction to Authentication and Authorization with Verifiable Credentials</h2>

    <p>In a typical B2B ecosystem, the agreements between a product/service provider and the consumer are formalised among legal persons (also known in this document as 'organisations').
    </p>
    <p>However, when interacting in the context of execution of the agreement, typically other entities are acting on behalf of the legal persons both for the consumer organisation and for the service provider organisation.
    </p>
    <p>For example, an employee of the consumer organisation may start, on behalf of his employer, an interaction with the provider organisation to perform a process needed for the procurement and provision of a service. In this case, the provider organisation should authenticate the natural person and apply appropriate access control policies to ensure that the natural person is really entitled by the consumer organisation to perform the intended process.
    </p>
    <p>Another example is when a device, server machine or a service controlled by the consumer organisation interacts with a service provider in an automated way (“controlled” means in this context that the device, machine or service is operating under the responsibility of the legal person). Before allowing the entity to access protected resources, the provider organisation should authenticate the entity and apply appropriate access control policies to ensure that the entity is really entitled by the consumer organisation to perform the intended process.
    </p>
    <p>In the context of authentication and access management, the legal person acting as consumer organisation will be named <code>Participant</code>. The digital representation of an entity acting on behalf of a Participant is referred to as a <code>Principal</code>. In Human-to-Machine (H2M) scenarios, the <code>Principal</code> is a natural person (typically an employee or contractor), while in Machine-to-Machine (M2M) scenarios the <code>Principal</code> can be a device, an application or any other automated entity without legal personality under eIDAS. However, when the context is clear and we need to refer to eIDAS legal terms, we will use the term <code>user</code> (defined in the Glossary) to denote a natural or legal person, or a natural person representing a legal person using a wallet to authenticate.
    </p>
    <p>The legal entity acting as service provider and performing authentication and access management will be called <code>Relying Party</code>.
    </p>
    <p>The approach is similar to the on-behalf-of actor model described in [[Actor-DataSpaces]] but our focus is on the compliance with the eIDAS legal framework to enable not only Data Spaces but any type of ecosystem to leverage the eIDAS trust framework and achieve a high level of legal certainty with the presumption of non-repudiation in the courts.
    </p>
    <p>The mechanism described here allows a Relying Party receiving a Verifiable Credential from a principal engaging in an authentication process to perform the following verifications:
    </p>
    <table class='deftable'>
        <tr><td style='padding-left: 0px;'><b>Authentication</b></td></tr><tr><td style='padding-left: 20px;'>
            <ul>
                <li><b>Non-tampering</b>. The Relying Party can verify that the credential was not tampered with since it was generated, thanks to the digital signature of the credential.
                </li>
                <li><b>Binding the Principal with the subject inside the credential</b>. The Relying Party can verify that the principal presenting the credential is the same principal identified as the subject inside the credential by using the cryptographic material inside the credential that was embedded in a secure and private way during the credential issuance process. See section <a href="#verifiable_id" class="xref">Authentication requires a VerifiableID</a> for more details.
                    <div>
                    <p>The degree of trust in this verification depends on the degree of trust that the Relying Party puts on the processes that the Participant uses to issue the credentials.
                    </p>
                    </div>
                    <div>
                    <p>However, as described below, the usage of eIDAS signatures to sign the credential makes the Participant legally liable for any problems in the binding of the identities of the holder and subject of the credential. Specifically, compliance to the eIDAS specifications and regulation for electronic seals and signatures provides <b>presumption of non-repudiation and the burden of disputing it in the courts rests on the Participant, not on the Relying Party</b>.
                    </p>
                    </div>
                    <div>
                    <p>This is important because it provides the incentives in the proper places: the Participant is incentivised to create the credential in the proper way, and the Relying Party is incentivised to perform its due diligence in verifying the credential. By using the eIDAS signatures, no party has to assume the burden if the technical validity of the signature is disputed in court. Only the contents of the credential can be under discussion. See section <a href="#signature_benefits" class="xref">Signature of the Verifiable Credentials</a> for more details.
                    </p>
                    </div>
                    <div>
                    <p>In the mechanism described here, the verification is enabled by embedding inside the credential a public key corresponding to a private key that was generated by the principal during the issuance process. See below for the details, including an optional mechanism by embedding an existing eIDAS certificate issued by a QTSP when the principal is a natural person or a legal person (different from the Participant).
                    </p>
                    </div>
                </li>
                <li><b>Binding of issuer with a real-world identity</b>. The Relying Party can verify that the credential was issued by somebody controlling a private key associated to a given real-world identity.
                    <div>
                    <p>The verification is enabled because the Verifiable Credential is sealed with an eIDAS <a href="#qualified certificate for electronic seal" class="xref">qualified certificate for electronic seal</a> issued to the Participant by a <a href="#qualified trust service provider" class="xref">qualified trust service provider</a> (QTSP) in the [[[EU_Trusted_Lists]]], and the signature of the credential is an advanced or qualified electronic signature using the [[JAdES]] format (JSON Advanced Electronic Signature) as defined in the eIDAS regulation.
                    </p>
                    </div>
                    <div>
                    <p>Of course, we also support electronic signatures with qualified certificates for electronic signatures issued by QTSPs to <b>natural persons acting as representatives of legal persons</b>.
                    </p>
                    </div>
                    <div>
                    <p>This verification ensures that an organisation with a real-world legal identity under the eIDAS Trust Framework has signed the credential being presented by a natural person identified as the subject of the credential.
                    </p>
                    </div>
                    <div>
                    <p>This verification <b>does not say anything about whether the organisation is a participant</b> in a given Data Space or not. See next point for such verification.
                    </p>
                    </div>
                </li>
                <li><b>Verify that the real-world identity is a Participant</b>. The Relying Party, using the unique identifier in the eIDAS certificate used to sign the credential, can check if the issuer of the credential is a participant in a given ecosystem by looking for that unique identifier in the Trusted Participant List managed by that ecosystem.
                    <div>
                    <p>This unique identifier is the unique <code>organizationIdentifier</code> defined in [[[ETSI-LEGALPERSON]]], which is inside the certificates for legal persons and certificates for natural persons acting as representatives of legal persons.
                    </p>
                    </div>
                    <div>
                    <p>Any legal person that can already engage in electronic transactions in the internal market can have an eIDAS certificate including such a unique identifier, which is used in all types of legally-binding signatures like invoices, contracts, etc.
                    </p>
                    </div>
                    <div>
                    <p>We assume here that the onboarding process of each ecosystem does not invent a new "local-only" identifier but uses the one that is already valid for electronic transactions in the internal market. Or at least, that the global eIDAS unique identifier is associated with whatever private identifier is invented by the ecosystem.
                    </p>
                    </div>
                    <div>
                    <p>We assume that the eIDAS unique identifier is used during onboarding to update a given Trusted Participant List with the identity of the new participant. That identity is composed of the unique identifier in the eIDAS framework and any additional attributes that may be relevant for the ecosystem. See below for the structure of the unique eIDAS identifier.
                    </p>
                    </div>
                </li>
            </ul>
        </td></tr>
        <tr><td style='padding-left: 0px;'><b>Access Control</b></td></tr><tr><td style='padding-left: 20px;'>
            <ul>
                <li><b>Binding the Participant to the delegated powers to the Principal</b>. The Relying Party can verify that the legal person (the Participant) or a representative of the legal person (in eIDAS terms) has delegated a specific set of powers to the subject identified inside the credential (who is the same person holding and presenting the credential, as described above in 'authentication').
                    <div>
                    <p>This is enabled because the credential includes a <b>set of claims that state in a formal language the delegated powers</b>, and the credential has been sealed/signed using an eIDAS certificate using the eIDAS advanced/qualified electronic signature format, described in more detail later in this document.
                    </p>
                    </div>
                    <div>
                    <p>Alternatively, the credential can include a pointer to an external document (which could be another credential) describing in detail the delegated powers. In this case, the linking mechanism should provide a tamper-evident mechanism to avoid undetected modifications to the original external document, for example using [[Cryptographic Hyperlinks]].
                    </p>
                    </div>
                    <div>
                    <p>Thanks to the usage of eIDAS signatures, the credential is effectively a legal document with the same legal validity as any other document in any format supported by the eIDAS signature scheme. The Relying Party can verify (and prove in court if needed) with a high level of legal certainty that the legal person issuing the credential (the Participant) has declared that the holder/subject of the credential has the powers stated inside the credential (or linked by the credential).
                    </p>
                    </div>
                    <div>
                    <p>Actually, the entity identified as a subject in the credential, and that is receiving the delegated powers, is not restricted to be a natural person and can be of different types. Anything that can be expressed in paper or PDF format can be also expressed in the Verifiable Credential format. For example, it can be an employee, a customer or a machine or device under the responsibility of the legal person signing the credential.
                    </p>
                    </div>
                </li>
                <li>The Relying Party can use the claims mentioned above, expressed as a formal language (e.g. [[ODRL]]), to perform access control. The specific mechanism is not in the scope of this document.
                    <div>
                    <p>For example, the credential can just specify the role(s) of the entity identified in the credential (e.g. 'finance administrator' for an employee, 'gold customer' for a customer, 'humidity sensor' for a machine) and the Relying Party can evaluate a set of arbitrarily complex policy rules associated to the role(s) for access control.
                    </p>
                    </div>
                    <div>
                    <p>Alternatively, the credential could specify more complex rules which the Relying Party can combine if needed with additional policy rules to make the final decision.
                    </p>
                    </div>
                </li>
            </ul>
        </td></tr>
    </table>
    <p>To achieve all of the above, we define specific types of Verifiable Credentials with a format and a mechanism which specify:
    </p>
    <ol>
        <li>a way to sign the credentials;
        </li>
        <li>a way to bind the identity of the holder of a credential to the identity of the subject inside the credential;
        </li>
        <li>and a way to embed authorisation information in the credential describing the powers that the legal entity has delegated to the subject inside the credential.
        </li>
    </ol>
    <p>The mechanisms described here can be used to generate credentials to employees, contractors, customers and even to machines and devices acting on behalf of an organisation. The schema is identical, except the issuance process is probably a little bit different and the roles and duties embedded in the credentials have different legal implications (but always in line with the legal framework, for example with the <a href="https://commission.europa.eu/law/law-topic/consumer-protection-law/consumer-contract-law/consumer-rights-directive_en#:~:text=About%20the%20directive,-The%20Consumer%20Rights&text=It%20aligns%20and%20harmonises%20national,they%20shop%20in%20the%20EU.">Consumer rights directive</a>).
    </p>
    <section id='signature_benefits'><h2>Signature of the Verifiable Credentials</h2>

        <p>We use a <a href="#qualified certificate for electronic seal" class="xref">qualified certificate for electronic seal</a> provided by an eIDAS <a href="#qualified trust service provider" class="xref">qualified trust service provider</a> (QTSP) to seal credentials with an <a href="#advanced electronic seal" class="xref">advanced electronic seal</a> (AdESeal) or <a href="#qualified electronic seal" class="xref">qualified electronic seal</a> (QESeal) with the JSON Advanced Electronic Signature format ([[JAdES]]).
        </p>
        <p>We also use a <a href="#qualified certificate for electronic signature" class="xref">qualified certificate for electronic signature</a> issued by a QTSP to authorised representatives of the legal person, to sign credentials with an <a href="#advanced electronic signature" class="xref">advanced electronic signature</a> (AdES) or with a <a href="#qualified electronic signature" class="xref">qualified electronic signature</a> (QES) with the JSON Advanced Electronic Signature format (JAdES).
        </p>
        <p>This is described in the following figure:
        </p>
        <figure id='Trust Framework-Signatures2' class='figureshadow'><img src='images/eIDAS Trust Framework-Signatures2.drawio.png' alt='Signatures of JSON documents'>
        <figcaption>Signatures of JSON documents</figcaption></figure>

        <p>This mechanism for sealing/signing the Verifiable Credentials has the following properties:
        </p>
        <table class='deftable'>
            <tr><td style='padding-left: 0px;'><b>Provides high assurance of the identity of the creator of the credential.</b></td></tr><tr><td style='padding-left: 20px;'>
                <p>The seals/signatures provide <b>high assurance of the identity of the creator of the credential</b>. For example, it will be difficult for a malicious user to obtain a qualified seal certificate in the name of a company, because the QTSP will be responsible to check that such a seal is issued to the persons representing the company and not to unauthorised persons.
                </p>
            </td></tr>
            <tr><td style='padding-left: 0px;'><b>Enables authorised representatives of the legal person to act on behalf of the legal person.</b></td></tr><tr><td style='padding-left: 20px;'>
                <p>The mechanism provides <b>high legal predictability</b>, including for the qualified electronic signature the benefits of its <b>legal equivalence to handwritten signatures</b>.
                </p>
                <p>As stated by the eIDAS Regulation, when a transaction requires a qualified electronic seal from a legal person, a qualified electronic signature from the authorised representative of the legal person should be equally acceptable.
                </p>
                <p>It is possible to certify elements that are bound to the signatory such as a title (e.g. Director), a link with its employer, etc. Because the QTSP is trusted for verifying the information it certifies, the Relying Party can get a high level of confidence in such information conveyed with the signature through the signatory's certificate.
                </p>
                <p>In this way, the Relying Party receiving Verifiable Credentials can have the same legal certainty than with any other document in other formats (e.g. PDF) signed with AdES or QES signatures or with handwritten signatures (in the case of QES).
                </p>
            </td></tr>
            <tr><td style='padding-left: 0px;'><b>Provides a high level of legal certainty and interoperability.</b></td></tr><tr><td style='padding-left: 20px;'>
                <p>Any basic signature benefits from the non-discrimination rule, which means that a Court in an EU Member State cannot reject it automatically as being invalid simply because they are in electronic form.
                </p>
                <p>However, their dependability is lower than that of an AdES/AdESeal or QES/QESeal because the signatory may be required to prove the security of the technology being used if the validity of the signature is disputed before a court. This requires significant costs and efforts that could be avoided with relative ease by opting for the more established and standardised advanced and qualified signature solutions. It may also be the case that the relying parties have no applications or tools to validate such signature, when not based on standards; in such a scenario, the signature may be legally valid and technologically robust, but of limited use (see [[ENISA-Qualified Electronic Signatures]] and [[ENISA-Qualified Electronic Seals]]).
                </p>
                <p>For these interoperability reasons, QES/QESeal that are based on recognised EU standards are preferable unless the parties operate purely in a local context where the acceptance and usability of the chosen signature solution is sufficiently certain.
                </p>
                <p>Beyond the technical interoperability, the eIDAS Regulation also ensures the international recognition of electronic signatures, and not limited to the EU.
                </p>
            </td></tr>
        </table>
    </section>
    <section id='A taxonomy of Verifiable Credentials'><h2>A taxonomy of Verifiable Credentials</h2>

        <p>The objectives defined in the introduction can be achieved in different ways. We define here an approach that standardises the detailed mechanisms so it can be adopted easily by anyone who wants to obtain the associated benefits. If the approach is adopted in an ecosystem, it provides a high level of interoperability among the participants in the ecosystem, reducing also the risks associated with mistakes in the implementation.
        </p>
        <p>To describe precisely the approach, we define a taxonomy of the relevant classes of Verifiable Credentials that we need.
        </p>
        <p>For the purpose of this discussion we use a diagram derived from the taxonomy <a href="https://ec.europa.eu/digital-building-blocks/wikis/display/EBSIDOC/Data+Models+and+Schemas">defined in EBSI</a>:
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_9f01927a70a78cd7d7d7cf2e5f5880d8.png' alt='Classes of credentials'>
        <figcaption>Classes of credentials</figcaption></figure>

        <p>And this is the chain of trust from the "Authentic sources" to the credential that the employee (for example) holds.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_server_dbd5762468f231440ee031c579da5bb8.png' alt='Chain of trust'>
        <figcaption>Chain of trust</figcaption></figure>

        <p>The sections below refer to this diagram for each type of credential discussed.
        </p>
    </section>
    <section id='verifiable_id'><h2>Authentication requires a VerifiableID</h2>

        <p>Not all types of Verifiable Credentials can be used as a mechanism for online authentication, because the Relying Party (the entity receiving the Verifiable Credential in an authentication process) needs to bind the identity of the user sending the credential to the claims attested about the subject inside the credential.
        </p>
        <p>For example, in the case of a Diploma as a Verifiable Credential (a Verifiable Diploma), the credential is a Verifiable Attestation which indicates that the subject has certain skills or has achieved certain learning outcomes through formal or non-formal learning context. However, as in the case with normal Diplomas in paper of PDF format, this credential can be presented by anyone that holds the credential. In other words, the credential binds the identity of the subject with the claims inside the credential, but does not bind the identity of the holder of the credential with the identity of the subject of the credential, which requires a special mechanism in the issuance process.
        </p>
        <p>Most Verifiable Credentials will be issued as Verifiable Attestations, acting as efficient machine-processable and verifiable equivalent to their analog counterparts. Their purpose is to attest some attributes about the subject of the credential and not act as a mechanism for online authentication.
        </p>
        <p>Instead, <b>a <code>VerifiableID</code> is a special form of a Verifiable Credential that a natural or legal person can use in an electronic identification process as evidence of whom he/she/it is</b> (comparable with a passport, physical IDcard, driving licence, social security card, member-card…).
        </p>
        <p>VerifiableIDs can be of different types and be issued by different entities with different levels of assurance (in eIDAS terminology). They are issued with the purpose of serving as authentication mechanisms in online processes. In the near future, VerifiableIDs of the highest level of assurance (LoA High) will be issued to citizens and businesses by their governments under eIDAS2.
        </p>
        <p>We describe in this document a way to issue VerifiableID credentials and how a Relying Party can perform authentication by accepting that credential.
        </p>
    </section>
    <section id='Access Control requires a Verifiable Authorisation'><h2>Access Control requires a Verifiable Authorisation</h2>

        <p>Once the user is authenticated, the system should make a decision to grant or reject an access request to a protected resource from an already authenticated subject, based on what the subject is authorised to access.
        </p>
        <p>Let's take the example of when a Service Provider signs an agreement with a Service Consumer organisation (a legal person), and the Service Provider wants to allow access to some services to employees of the Consumer organisation under the conditions of the agreement.
        </p>
        <p>In most cases, granting access is not an all-or-nothing decision. In general, the agreement between the Service Provider and Service Consumer specifies that only a subset of the employees of the Consumer organisation can access the services, and even in that subset not all employees have the same powers when accessing the services. For example, some employees have access to the administration of the service, some can perform some create/update/delete operations in a subset of the services, and some employees can only have read access to a subset of the services.
        </p>
        <p>To allow for this granularity in an authentication and access control process, in general the entity willing to perform an action on a protected resource has to present (in a Verifiable Presentation) a VerifiableID and possibly one or more additional Verifiable Attestations.
        </p>
        <p>At least one of the credentials should include claims identifying the employee (or any other subject) and a formal description of the concrete powers that have been delegated by the legal representative of the organisation, enabling the determination by the Service Provider whether the user is entitled to access a service and the operations that the user can perform on that service.
        </p>
        <p>We define later a standard mechanism and format for a Verifiable Credential that enables this functionality in a simple, secure and with high degree of legal certainty compatible with eIDAS.
        </p>
        <p>Such a credential is called a Verifiable Authorization, represented in the figure above.
        </p>
    </section>
    <section id='Combining VerifiableID and Verifiable Authorisation in the LEARCredential'><h2>Combining VerifiableID and Verifiable Authorisation in the LEARCredential</h2>

        <p>In many use cases, it is possible to simplify the authentication and access control by combining in a single credential both a VerifiableID (for authentication) and a Verifiable Authorisation (for access control).
        </p>
        <p>We call the resulting credential a LEARCredential and it is very useful when the holder/subject wants to use a decentralised IAM mechanisms implemented by Relying Parties which are federated in a decentralised way using a common Trust Anchor Framework.
        </p>
        <p>We repeat here the taxonomy diagram to facilitate the description of the LEARCredential.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_9f01927a70a78cd7d7d7cf2e5f5880d8.png' alt='The LEARCredential'>
        <figcaption>The LEARCredential</figcaption></figure>

        <p>The subject identified in the credential can authenticate to perform a protected process by using a special type of Verifiable Credential called <code>LEARCredential</code> (from <b>L</b>egal <b>E</b>ntity <b>A</b>uthorised <b>R</b>epresentation).
        </p>
        <p>To achieve a high level of legal certainty under eIDAS, the LEARCredential is:
        </p>
        <ul>
            <li>signed or sealed with an eIDAS certificate which is either:
                <div>
                <ul>
                    <li>a <b>certificate for electronic seals</b> issued to a legal person by a <a href="#qualified trust service provider" class="xref">qualified trust service provider</a>, or
                    </li>
                    <li>a <b>certificate for electronic signatures</b>, issued to a <b>legal representative of the legal person</b> by a qualified trust service provider.
                    </li>
                </ul>
                </div>
            </li>
            <li>signed using the <b>JSON Advanced Electronic Signature</b> format described in [[[JAdES]]]
            </li>
        </ul>
        <p>The LEARCredential includes claims identifying the subject of the credential and a description of the concrete powers that have been delegated by the legal representative of the organisation.
        </p>
        <p>By signing/sealing the credential with an eIDAS certificate, the legal representative attests that the powers described in the credential have been delegated to the subject (maybe under some conditions, also described in the credential).
        </p>
        <p>In this way, the LEARCredential has the same legal status as any other document in other formats (e.g., PDF) signed in an eIDAS-compliant way, but with all the advantages provided by the Verifiable Credential format.
        </p>
        <p>In addition, the LEARCredential includes cryptographic material that allows the subject of the credential to <b>use the credential as an online authentication mechanism</b> in a portal or API, by proving that the holder of the credential is the same entity identified in the credential.
        </p>
        <p>Any Verifier that trusts the eIDAS Trust Framework will be able to verify that:
        </p>
        <ul>
            <li><b>The entity presenting the LEARCredential (the holder) is the same as the one identified in the subject of the credential</b>
            </li>
            <li><b>A legal representative of the organisation has attested that the subject has the powers described in the credential</b>
            </li>
        </ul>
        <p>This enables the entity presenting the LEARCredential to start the process and to provide any additional required documentation as additional Verifiable Credentials to enable automatic verification of compliance with the process requirements (including Gaia-X credentials issued by the Compliance Service of Gaia-X).
        </p>
        <p>Both types of eIDAS certificates mentioned above are an electronic attestation <b>that links electronic seal/signature validation data to a legal person and confirms the name of that person</b>. This way, the certificate, usually linked to the sealed/signed document, can be used to verify the identity of the creator of the seal/signature and whether the document has been sealed/signed using the corresponding private key.
        </p>
        <p>Before issuing a certificate like the above, the qualified trust service provider (QTSP) performs validations against <code>Authentic Sources</code> to authenticate the identity of the organisation under the eIDAS framework:
        </p>
        <ul>
            <li>The data concerning the business name or corporate name of the organisation.
            </li>
            <li>The data relating to the constitution and legal status of the subscriber.
            </li>
            <li>The data concerning the extent and validity of the powers of representation of the applicant.
            </li>
            <li>The data concerning the tax identification code of the organisation or equivalent code used in the country to whose legislation the subscriber is subject.
            </li>
        </ul>
        <p>The person controlling the above certificates can authorise a subject to perform some operations on behalf of the organisation (LEAR) by generating and signing a Verifiable Credential which:
        </p>
        <ul>
            <li>Includes identification data of a subject
            </li>
            <li>Includes claims stating the delegation of specific powers to perform a set of specific processes on behalf of the organisation
            </li>
            <li>Includes a public key where the corresponding private key is controlled by the subject, enabling the subject to prove that she/he/it is the holder of the credential when it is being used in an authentication process like the ones used as examples in this document.
            </li>
        </ul>
        <p>The LEARCredential uses the <code>did:elsi</code> method for the identifiers of legal persons involved in the process, to facilitate the DID resolution and linkage with the eIDAS certificates. The <code>did:elsi</code> method is specified in [[[DID-ELSI]]]. But any other suitable DID method can be used if desired.
        </p>
        <p>The high-level view of the process is described in the following diagram, where the legal entity representative of a company appoints an employee to perform some processes with a third party (the Relying Party):
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_1c84d3666027477e2d28e680104280b3.png' alt='High level view of issuance of LEARCredential to an employee'>
        <figcaption>High level view of issuance of LEARCredential to an employee</figcaption></figure>

    </section>
    <section id='Introduction to the LEARCredential through an example'><h2>Introduction to the LEARCredential through an example</h2>

        <p>In this section we describe in detail the LEARCredential and for illustrative purpose we use example attributes from a fictitious ecosystem whose participants are described in Appendix <a href="#participants" class="xref">Example scenario: Participants in the ecosystem</a>.
        </p>
        <p>In this example the LEARCredential will be generated using the eIDAS certificate of representation of the COO (Chief Operation Officer) of the organisation that will be issuing the credential (GoodAir).
        </p>
        <p>The credential will be generated with an application that the COO will use as Issuer of the LEARCredential and that allows the employee to receive the credential using his credential wallet, using [[OpenID.VCI]] to achieve compliance with the EDIW Wallet ARF.
        </p>
        <p>This application enables the COO to attest the information required to create the LEARCredential, specifying the employee information and the specific type of LEARCredential. In general, there may be different instances of LEARCredentials for different purposes. One employee can have more than one LEARCredential, each having a different delegation of powers for different environments.
        </p>
        <p>The specific detailed use case here is the issuance of a LEARCredential to an employee to enable that employee to perform the onboarding process in an ecosystem. But exactly the same process with different attested attributes can be used by any organisation to issue credentials that can be accepted by other organisations for authentication and access control to any protected resources that they manage.
        </p>
        <p>The essential components of a LEARCredential are the following:
        </p>
        <ul>
            <li><b>Claims identifying the employee who is appointed to be a LEAR</b>
            </li>
            <li><b>DID of the employee to enable authentication</b>
            </li>
            <li><b>Claims identifying the legal representative</b>
            </li>
            <li><b>The specific powers delegated by the legal representative to the employee</b>
            </li>
            <li><b>Advanced/Qualified signature of the credential</b>
            </li>
        </ul>
        <p>These concepts are elaborated in the following sections. To facilitate understanding of the concepts and how the LEAR Credential maps with the equivalent mechanism used today with PDFs, we use the textual documents that are used for enrolling an organisation in the <a href="https://ec.europa.eu/info/funding-tenders/opportunities/portal/screen/home">European Commission Funding & tenders</a> system. The forms we use as example are the ones required by the Commission to enable an organisation to appoint a Legal Entity Appointed Representative (LEAR). This is precisely the origin of the name we use for the LEAR Credential.
        </p>
        <p>However, one difference is that in the example we will generate a LEAR Credential which can be used to interact with the DOME Marketplace described in Appendix <a href="#participants" class="xref">Example scenario: Participants in the ecosystem</a>, instead of with the Funding & tenders portal.
        </p>
        <section id='Claims identifying the employee (the mandatee)'><h2>Claims identifying the employee (the mandatee)</h2>

            <p>These are claims identifying the subject of the credential, the person who will act as LEAR. Each ecosystem can define their own depending on their specific requirements.
            </p>
            <p>In addition, each organisation can specify their own for enabling access to its products/services. However, it is recommended to use a set of claims that are agreed upon by all participants in the ecosystem unless there are specific requirements for not doing so. This includes not only the amount of claims but also their syntax and semantics.
            </p>
            <p>The relevant section of the document for the EU Commission Funding & tenders portal is shown here:
            </p>
            <figure id='lear-appointment-letter-1' class='figureshadow'><img src='images/lear-appointment-letter-1.png' alt='LEAR subject identification data.'>
            <figcaption>LEAR subject identification data.</figcaption></figure>

            <p>From the above form we can derive the following claims using the example data:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#d14">&#34;mandatee&#34;</span><span style="color:#a61717;background-color:#e3d2d2">:</span> {
    <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
    <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#d14">&#34;M&#34;</span>,
    <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
    <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>
}
</pre></td></tr></table>

        </section>
        <section id='DID of the employee'><h2>DID of the employee</h2>

            <p>In this example we use the <code>did:key</code> method for the DID of the employee, which provides a very high level of privacy and given the way the LEARCredential is generated it supports the verification of the chain of responsibility with a proper level of guarantee.
            </p>
            <p>If the highest levels of assurance and legal compliance are desired and the employee has an eIDAS certificate for signatures (in this case a personal one would be enough, not one like the COO), we could use the <code>elsi:did</code> method for identification of the employee. However, the organisation (GoodAir in our example) should make sure that the employee is aware of and agree to the possible privacy implications of doing so, given the personal details leaked from the eIDAS certificate. In any case, if the business interactions the the employee will perform already require some personal details to be in the LEAR Credential (as in the example with the EU Commission used here), using an eIDAS personal certificate of the employee should not be a problem. However, we keep using the <code>did:key</code> identifier for the employee, to show how the system can work with it and ensure complete privacy if required.
            </p>
            <p>Those personal details are exactly the same as if the employee signs any document with a digital certificate, but care should be taken by the organisation because in this case the signature would be done "on behalf of" his employer and not as an individual personal action.
            </p>
            <p>Even though this is not unique to the <code>did:elsi</code> method, this also implies that the onboarding service has to handle those personal details in the same way as if it would be accepting any other document signed with a certificate for signatures, and ensure compliance with GDPR. This is "business as usual" when using digital signatures, but we want to make sure that this is taken care of when implementing the authentication and access control mechanisms described in this document.
            </p>
            <p>This DID for the employee is an additional claim to the ones presented above, using the <code>id</code> field in the <code>credentialSubject</code> object.
            </p>
            <p>Using this DID method has an additional advantage: the DID identifier corresponds to a keypair that is generated during the LEARCredential issuance process, where the private key is generated by the wallet of the employee and it is always under his control.
            </p>
            <p>This private key controlled by the employee can be used to sign challenges from Relying Parties that receive the credential to prove that the person sending the credential is the same person that is identified in the <code>credentialSubject</code> object of the LEARCredential.
            </p>
            <p>It is this property that makes this credential a VerifiableID that can be used for online authentication.
            </p>
            <p>An example DID for the employee could be:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>
}
</pre></td></tr></table>

            <p>In this example, the signatures performed with the private key can not be JAdES-compliant ([[JAdES]]), but if the LEARCredential is attached to any other credential that is signed with this private key, then they can be traced up to the eIDAS certificate of the COO and so the chain of responsibility can be determined, up to the root of trust which is the identity of the trust service used by the QTSP that issued the eIDAS certificate of the COO of the company.
            </p>
            <p>With the DID for the employee, the set of claims identifying him would be then:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#d14">&#34;mandatee&#34;</span><span style="color:#a61717;background-color:#e3d2d2">:</span> {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
    <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
    <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#d14">&#34;M&#34;</span>,
    <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
    <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>
}
</pre></td></tr></table>

        </section>
        <section id='legalRepresentative (the mandator)'><h2>legalRepresentative (the mandator)</h2>

            <p>This section identifies the natural person (the COO of GoodAir in our example) who is a legal representative of the legal person (GoodAir) and that is nominating the employee identified in the credential.
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#d14">&#34;mandator&#34;</span><span style="color:#a61717;background-color:#e3d2d2">:</span> {
    <span style="color:#000080">&#34;cn&#34;</span>: <span style="color:#d14">&#34;56565656V Jesus Ruiz&#34;</span>,
    <span style="color:#000080">&#34;serialNumber&#34;</span>: <span style="color:#d14">&#34;56565656V&#34;</span>,
    <span style="color:#000080">&#34;organizationIdentifier&#34;</span>: <span style="color:#d14">&#34;VATES-12345678&#34;</span>,
    <span style="color:#000080">&#34;o&#34;</span>: <span style="color:#d14">&#34;GoodAir&#34;</span>,
    <span style="color:#000080">&#34;c&#34;</span>: <span style="color:#d14">&#34;ES&#34;</span>
}
</pre></td></tr></table>

            <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: Attributes for natural and legal persons</p>
                <p>The attributes for natural persons and legal persons are derived from the <a href="https://ec.europa.eu/digital-building-blocks/wikis/download/attachments/467109280/eidas_saml_attribute_profile_v1.0_2.pdf?version=1&modificationDate=1639417533738&api=v2">eIDAS SAML Attribute Profile (eIDAS Technical Sub-group, 22 June 2015)</a>.
                </p>
                <p>All attributes for the eIDAS minimum data sets can be derived from the <a href="https://ec.europa.eu/isa2/solutions/core-vocabularies_en/">ISA Core Vocabulary</a> and <a href="https://joinup.ec.europa.eu/collection/semic-support-centre/specifications">https://joinup.ec.europa.eu/collection/semic-support-centre/specifications</a>.
                </p>
                <p>In the case of natural persons refer to the <a href="https://joinup.ec.europa.eu/asset/core_person/asset_release/core-person-vocabulary">Core Person Vocabulary</a> and in the case of legal persons refer to definitions for <a href="https://joinup.ec.europa.eu/asset/core_business/asset_release/core-business-vocabulary">Core Business Vocabulary</a>.
                </p>
            </aside></td></tr></table>
        </section>
        <section id='Roles and Duties of the LEAR: the powers of representation'><h2>Roles and Duties of the LEAR: the powers of representation</h2>

            <p>The LEARCredential should include a formal description with specific powers that are delegated by the legal representative (mandator) to the employee (mandatee). In the example with the LEAR for the EU Funding & tenders portal, it corresponds to the roles and duties of the LEAR. The analog description in our example, which uses natural language is:
            </p>
            <figure id='lear-appointment-letter-2'>
                <p><img src="images/lear-appointment-letter-2.png" alt="" />
                </p>
                <figcaption>LEAR roles and duties.
                </figcaption>
            </figure>
            <p>When we translate this section to a formal language to represent powers of representation, the object inside the credential could be:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#d14">&#34;mandate&#34;</span><span style="color:#a61717;background-color:#e3d2d2">:</span> {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;bb1482e1-0513-4c90-9c80-98a2e4d14984&#34;</span>,
    <span style="color:#000080">&#34;mandator&#34;</span>: {
        <span style="color:#000080">&#34;cn&#34;</span>: <span style="color:#d14">&#34;56565656V Jesus Ruiz&#34;</span>,
        <span style="color:#000080">&#34;serialNumber&#34;</span>: <span style="color:#d14">&#34;56565656V&#34;</span>,
        <span style="color:#000080">&#34;organizationIdentifier&#34;</span>: <span style="color:#d14">&#34;VATES-12345678&#34;</span>,
        <span style="color:#000080">&#34;o&#34;</span>: <span style="color:#d14">&#34;GoodAir&#34;</span>,
        <span style="color:#000080">&#34;c&#34;</span>: <span style="color:#d14">&#34;ES&#34;</span>
    },
    <span style="color:#000080">&#34;mandatee&#34;</span>: {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
        <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
        <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
        <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#d14">&#34;M&#34;</span>,
        <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
        <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>
    },
    <span style="color:#000080">&#34;power&#34;</span>: [
        {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;53493323798&#34;</span>,
            <span style="color:#000080">&#34;tmf_type&#34;</span>: <span style="color:#d14">&#34;Domain&#34;</span>,
            <span style="color:#000080">&#34;tmf_name&#34;</span>: [<span style="color:#d14">&#34;DOME&#34;</span>],
            <span style="color:#000080">&#34;tmf_function&#34;</span>: <span style="color:#d14">&#34;Onboarding&#34;</span>,
            <span style="color:#000080">&#34;tmf_action&#34;</span>: [<span style="color:#d14">&#34;Process&#34;</span>]
        }
    ],
    <span style="color:#000080">&#34;lifeSpan&#34;</span>: {
        <span style="color:#000080">&#34;startDateTime&#34;</span>: <span style="color:#d14">&#34;2023-10-01&#34;</span>,
        <span style="color:#000080">&#34;endDateTime&#34;</span>: <span style="color:#d14">&#34;2025-10-01&#34;</span>
    }
}
</pre></td></tr></table>

            <p>In the above example, we have specified that the <code>mandator</code> (the legal representative) has delegated to the <code>mandatee</code> (the employee) one single power to access services in the DOME ecosystem (specified with the fields <code>type</code> and <code>name</code>) with the specific capability to perform the onboarding of the company in the DOME ecosystem (specified with the fields <code>function</code>and <code>action</code>). The actual data model, which can be used to express mor complex delegations is described in more detail in another section of the document.
            </p>
        </section>
        <section id='Assembling the pieces together'><h2>Assembling the pieces together</h2>

            <p>With the above values for the example, the complete LEARCredential would become something like this:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;@context&#34;</span>: [
        <span style="color:#d14">&#34;https://www.w3.org/ns/credentials/v2&#34;</span>,
        <span style="color:#d14">&#34;https://dome-marketplace.eu/2022/credentials/learcredential/v1&#34;</span>
    ],
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;urn:did:elsi:25159389-8dd17b796ac0&#34;</span>,
    <span style="color:#000080">&#34;type&#34;</span>: [<span style="color:#d14">&#34;VerifiableCredential&#34;</span>, <span style="color:#d14">&#34;LEARCredentialEmployee&#34;</span>],
    <span style="color:#000080">&#34;issuer&#34;</span>: {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATES-12345678&#34;</span>
    },
    <span style="color:#000080">&#34;issuanceDate&#34;</span>: <span style="color:#d14">&#34;2024-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;validFrom&#34;</span>: <span style="color:#d14">&#34;2024-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;expirationDate&#34;</span>: <span style="color:#d14">&#34;2025-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;credentialSubject&#34;</span>: {
        <span style="color:#000080">&#34;mandate&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;bb1482e1-0513-4c90-9c80-98a2e4d14984&#34;</span>,
            <span style="color:#000080">&#34;mandator&#34;</span>: {
                <span style="color:#000080">&#34;cn&#34;</span>: <span style="color:#d14">&#34;56565656V Jesus Ruiz&#34;</span>,
                <span style="color:#000080">&#34;serialNumber&#34;</span>: <span style="color:#d14">&#34;56565656V&#34;</span>,
                <span style="color:#000080">&#34;organizationIdentifier&#34;</span>: <span style="color:#d14">&#34;VATES-12345678&#34;</span>,
                <span style="color:#000080">&#34;o&#34;</span>: <span style="color:#d14">&#34;GoodAir&#34;</span>,
                <span style="color:#000080">&#34;c&#34;</span>: <span style="color:#d14">&#34;ES&#34;</span>
            },
            <span style="color:#000080">&#34;mandatee&#34;</span>: {
                <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
                <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
                <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
                <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
                <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#d14">&#34;M&#34;</span>,
                <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
                <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>
            },
            <span style="color:#000080">&#34;power&#34;</span>: [
                {
                    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;53493323798&#34;</span>,
                    <span style="color:#000080">&#34;tmf_type&#34;</span>: <span style="color:#d14">&#34;Domain&#34;</span>,
                    <span style="color:#000080">&#34;tmf_domain&#34;</span>: [<span style="color:#d14">&#34;DOME&#34;</span>],
                    <span style="color:#000080">&#34;tmf_function&#34;</span>: <span style="color:#d14">&#34;Onboarding&#34;</span>,
                    <span style="color:#000080">&#34;tmf_action&#34;</span>: [<span style="color:#d14">&#34;Process&#34;</span>]
                }
            ],
            <span style="color:#000080">&#34;lifeSpan&#34;</span>: {
                <span style="color:#000080">&#34;startDateTime&#34;</span>: <span style="color:#d14">&#34;2024-03-22T14:00:00Z&#34;</span>,
                <span style="color:#000080">&#34;endDateTime&#34;</span>: <span style="color:#d14">&#34;2025-03-22T14:00:00Z&#34;</span>
            }
        }
    }
}
</pre></td></tr></table>

        </section>
    </section>
</section>
<section id='Reference architecture for authentication and access control'><h2>Reference architecture for authentication and access control</h2>

    <p>According to the [[[EDIW.ARF]]], there are four types of flows when using the wallet with Verifiable Credentials:
    </p>
    <ol>
        <li>Proximity supervised flow.
        </li>
        <li>Proximity unsupervised flow.
        </li>
        <li>Remote cross-device flow.
        </li>
        <li>Remote same-device flow.
        </li>
    </ol>
    <p>Flows 1 and 2 are used when the Wallet User is physically close to a Relying Party and the credential exchange should happen using proximity protocols (NFC, Bluetooth, QR-Code, etc.), not using the Internet.
    </p>
    <p>Flows 3 and 4 are used when credential exchange should happen over the Internet. These are the flows that are used for online interactions between the user and the Relying Party.
    </p>
    <p>We focus here on the remote/online flows, which have the following characteristics:
<ul>
        <li>The remote cross-device flow is typically used when the user consumes information from the Relying Party on a web browser in a laptop/PC and uses the Wallet in a mobile to authenticate the session. We describe here a mechanism using a QR code displayed in the laptop/PC screen which is scanned by the Wallet running in a mobile.
        </li>
        <li>In the remote same-device flow, the Wallet and the consumption device are the same, typically a mobile device.
        </li>
</ul>
    </p>
    <p>The User journeys described here focus on the cross-device flow, which is the most complex, involving two different devices.
    </p>
    <p>To describe the system we will use the following figure which is based on [[[NIST-AUTH]]] and describes a reference architecture with the required functional components to achieve authentication and enforcement of the authorization policies.
    </p>
    <p>The diagram uses the logical concepts also used in the XACML reference architecture, but our description is agnostic to the actual policy language used in a concrete implementation.
    </p>
    <p>At this moment, we are interested in the overall flows and the details will be explained later in the corresponding sections.
    </p>
    <figure id='fig-general-architecture'>
        <p><img src="images/login_in_DOME/authn_architecture-GeneralArchitecture.drawio.png" alt="" />
        </p>
        <figcaption>General architecture, remote cross-device flow
        </figcaption>
    </figure>
    <p>The system supports both Human-To-Machine (H2M) and Machine-To-Machine (M2M) flows. They share a lot of things, but the H2M flows may be more interactive.
    </p>
    <ul class='plain'>
        <li id='1._Request_protected_resource._2154'><b>1. Request protected resource.</b> In any of the scenarios (H2M or M2M), a request to access a protected resource managed by the Relying Party has to come with authentication information. Without authentication information, it is impossible to perform any type of access control to protect a resource from external entities (any entity acting on behalf of the Participant).
            <div>
            <p>In addition to authentication information, the request may carry also information intended specifically for access control, like the type of entity (natural person, device, application, ...), the relationship with the Participant (employee, contractor, sensor operated by Participant, ...), and specific powers assigned to the entity by the legal representative. More on this in the section <a href="#accesscontrol" class="xref">Access control with Verifiable Credentials</a>.
            </p>
            </div>
            <div>
            <p>The component in charge of <b>enforcing</b> that all requests come authenticated and that they comply with the access control policies of the Relying Party is the <code>PEP</code> (Policy Enforcement Point).
            </p>
            </div>
        </li>
        <li id='2_&_3._Check_if_authenticated._2160'><b>2 & 3. Check if authenticated.</b> Every request to a protected resource is intercepted by the <code>PEP</code>. The PEP is normally implemented as a reverse proxy or API gateway, so all calls to protected resources entering the organisation are intercepted and forwarded to the resource server only if they are accepted.
            <div>
            <p>If the request does not come with authentication information, there are two main scenarios which are possible:
<ul>
                <li id='M2M_2164'><b>M2M</b>. If the user is a machine using an API, the request is rejected with an error. The caller is responsible for authenticating before retrying, which can be done using the metadata about the Relying Party available at the standard OpenID endpoints.
                </li>
                <li id='H2M_2166'><b>H2M</b>. If the user is a natural person using a browser for navigating the portal of the Relying Party, the typical approach is to redirect the browser to the authentication component (<strong>step 3</strong> in the figure) using an HTTP Status of <code>302 Found</code>. The redirection may include enough information so the authentication component can send back the user to the original request if the user completes authentication successfully.
                </li>
</ul>
            </p>
            </div>
            <div>
            <p>If the request includes authentication information which has been obtained before via an authentication process, the PEP goes directly into the authorisation phase, described later in section <a href="#accesscontrol" class="xref">Access control with Verifiable Credentials</a>.
            </p>
            </div>
        </li>
        <li id='4._Authentication._2170'><b>4. Authentication.</b> The result of the authentication phase is to exchange a long-term VerifiableID (and possibly additional Verifiable Attestations) for a shorter-term Access Token issued by the Relying Party, which can be used later to invoke protected services. In order to do so, the Relying Party should make sure that the holder of the VerifiableID (the entity presenting the credential to the Relying Party) is the same entity as the one identified in the VerifiableID (the subject of the claims in the <code>credentialSubject</code> object). In addition, the authentication component enforces the compliance with the <b>authentication policies</b> defined in the Relying Party.
            <div>
            <p>These authentication policies should not be confused with the authorisation policies that will be used in the access control phase (though they may be related). One example of authentication policy could be: "we do not allow anyone to authenticate from 22:00 to 6:00". Authentication policies can also provide useful information to the user (especially a natural person) during the authentication phase about which credentials are required for a given service, before the user tries to access the service.
            </p>
            </div>
        </li>
        <li id='5._Authorization._2174'><b>5. Authorization.</b> When the PEP intercepts an authenticated request, it enforces access control policies by requesting a decision from the PDP (Policy Decision Point). The PDP uses information from the request to retrieve the applicable policies, evaluates those policies and returns its decision, either <code>Accept</code> or <code>Reject</code>. More detail on this process later in the document.
            <div>
            <p>The PEP (Policy <b>Enforcement</b> Point) enforces the decision taken by the PDP (Policy <b>Decision</b> Point):
<ul>
                <li>If the decision is <code>Reject</code> the PDP returns an error to the caller (it may be <code>401 Unauthorized</code> or any other depending on security considerations).
                </li>
                <li>If the decision is <code>Accept</code> the PEP forwards the request to the Resource Server for execution, and returns to the caller whatever result the Resource Server send back to the PEP.
                </li>
</ul>
            </p>
            </div>
        </li>
        <li id='6._Trust_Framework._2182'><b>6. Trust Framework.</b> During authentication and access control the system queries the Trust Framework to retrieve information required for execution of those phases. For example, authentication fails if any of the credentials presented by the user is revoked. Also, the policies for authentication and for access control may specify a set of Trusted Lists to query, and the process fails if the issuer of a credential is not in that list (for example, if the issuer is not in the Trusted Participants List because it does not belong to a given ecosystem, like a Data Space). More details later.
        </li>
    </ul>
</section>
<section id='Authenticating with Verifiable Credentials'><h2>Authenticating with Verifiable Credentials</h2>

    <p>We focus here on how to perform authentication using Verifiable Credentials. Access control is the subject of another section.
    </p>
    <p>Authentication requires a special type of Verifiable Credential called a <code>VerifiableID</code>. For the examples illustrating the mechanism we will use a LEARCredential, which is at the same time a <code>VerifiableID</code> and a <code>Verifiable Authorization</code>. The LEARCredential is a powerful mechanism that can be used both for authentication and sophisticated access control. In this section we will focus only on authentication using the LEARCredential.
    </p>
    <p>The authentication mechanism supports both Human-To-Machine (H2M) and Machine-To-Machine (M2M) flows. They share a lot of things, but we describe each one separately.
    </p>
    <section id='Authentication in Human-To-Machine scenarios'><h2>Authentication in Human-To-Machine scenarios</h2>

        <section id='Overview2195'><h2>Overview</h2>

            <p>For the explanation we will use an expanded version of [[[#fig-general-architecture]]], which can be seen in [[[#fig-authentication]]].
            </p>
            <figure id='fig-authentication' class='figureshadow'><img src='images/login_in_DOME/authn_architecture_authentication.drawio.png' alt='Authentication, H2M flow'>
            <figcaption>Authentication, H2M flow</figcaption></figure>

            <p>The high level flow is the following:
            </p>
            <ul class='plain'>
                <li id='1_2207'><b>1</b> The user sends a request to access a protected resource managed by the Relying Party.
                </li>
                <li id='2_2209'><b>2</b> The request is intercepted by the PEP which checks if the request is authenticated.
                </li>
                <li id='3_2211'><b>3</b> If the request is not authenticated, the user is redirected to the authentication component (VC Verifier) by returning an HTTP Status of <code>302 Found</code>.
                    <div>
                    <p>Alternatively, the authorization component can be accessed directly by the user before trying to access the protected resource. This would be the expected behaviour of a user who knows that authentication is required. The mechanism described here supports both scenarios.
                    </p>
                    </div>
                    <div>
                    <p>An example flow would be: The user navigates first to a general Login page in the portal of the Relying Party and authenticates. After authentication the portal presents a collection of services that the user can access. The user selects one of the services/operations and the Relying Party executes the operation if the user is authorised to do so.
                    </p>
                    </div>
                </li>
                <li id='4_2217'><b>4</b> The Verifiable Credentials verifier (VC Verifier) component of the Relying Party retrieves the credentials that are required for authentication. If the user has been redirected when trying to access a protected resource, the redirection provides information about the operation and protected resource that was trying to access, so there may be more credentials required than just a VerifiableID.
                    <div>
                    <p>If the user accessed the Login page directly, the VC Verifier component does not have information about the resource that the user intends to access, so it can request just a VerifiableID.
                    </p>
                    </div>
                    <div>
                    <p>The VC Verifier component retrieves the applicable policies from the Policy Retrieval Point (PRP) storing the authentication policies (do not confuse with the PRP for authorization, they could be the same in a given deployment but for more generality we have depicted separate logical components). The PRP is just the repository of policies. The Policy Administration Point is the component responsible for the management of the authentication policies in the PRP.
                    </p>
                    </div>
                    <div>
                    <p>The authentication policies specify, among other things:
<ul>
                        <li>The type of VerifiableID that the user should present in order to be authenticated
                        </li>
                        <li>If the user was redirected to the VC Verifier when trying to access a specific protected resource, the VC Component has received with the redirection the information about the service that the user intended to access. The VC Component passes this information to the PRP, and the PRP replies with the Verifiable Credentials (additional to the VerifiableID) that the user must present in order to have access to the service.
                        </li>
</ul>
                    </p>
                    </div>
                    <div>
                    <p>This information will be used by the VC Verifier to request from the Wallet those credentials. Please note that this is not performing authorization, only requesting the credentials that are know to be required for the service that the user intends to call. There may be additional authorization policies that implement more granular authorization checks when actually accessing the service.
                    </p>
                    </div>
                    <div>
                    <p>However, in most common cases it may be enough with just one credential of type LEARCredential if it includes enough authorization information to determine if access to the service can be allowed or not.
                    </p>
                    </div>
                </li>
                <li id='5_2232'><b>5</b> The VC Verifier component of the Relying Party and the Wallet of the user engage in a Verifiable Presentation Exchange flow, where the result is that the VC Verifier receives a VerifiableID and possibly additional Verifiable Credentials as determined in step 4.
                </li>
                <li id='6_2234'><b>6</b> The authorization mechanism uses the Trust Framework to query different Trusted Lists that are needed to evaluate the policy rules applicable to the request and compute a decision.
                    <div>
                    <p>The Trust Framework is composed of one or more Trusted Lists where each list is specialised in some specific domain of trust.
                    </p>
                    </div>
                    <div>
                    <p>For example, the Trust Framework contains Trusted Lists with the schema definitions used for the well-known types of Verifiable Credentials in the ecosystem. In this way, if the Verifiable Registry used for the Trust Framework is based on a Blockchain network (or several federated networks), the schemas can be published in a trusted and resilient manner reducing the risk of malicious tampering and keeping a record of the history of modifications.
                    </p>
                    </div>
                    <div>
                    <p>But the most interesting Trusted Lists in the Trust Framework are the Trusted Issuers Lists, which provide the mechanism to efficiently and securely verify that the issuer of a given credential is a Trusted Issuer of that type of credentials.
                    </p>
                    </div>
                    <div>
                    <p>It has to be noticed that even though most Trusted Issuer Lists are global (used by all participants in the ecosystem) and have essentially public information, there may be some specialised lists that are private to one or more organisations and specialised in some specific requirement.
                    </p>
                    </div>
                    <div>
                    <p>In this way, there may be some lists that are specific to the products that one organisation provides to other participants in the ecosystem. For example, there may be a Trusted Issuer List private to one organisation which is updated with the identity of a participant when that participant acquires access to some product provided by that organisation.
                    </p>
                    </div>
                    <div>
                    <p>For example, this "product-specific" Trusted Issuer List is queried when performing authorization if the related policy rules specify that the issuer of the Verifiable Credential received in the request should have acquired the product that the request is trying to access.
                    </p>
                    </div>
                    <div>
                    <p>However, as mentioned before, the set of "internal" and "external" Trusted Lists to query is not hardcoded but it depends on the specific policy rules that should be applied to the request when computing the decision to grant access or not.
                    </p>
                    </div>
                    <div>
                    <p>In this way, the system provides a great deal of flexibility on how access control is performed.
                    </p>
                    </div>
                    <div>
                    <p>For simplicity, the diagram below shows the query of the Trusted Issuer Lists as a single interaction to a single box, but the actual interactions can be very complex if required. In addition, the diagram does not specify whether the list is "private" or "global".
                    </p>
                    </div>
                </li>
            </ul>
            <p>The following sections elaborate in more detail in each of the interactions.
            </p>
        </section>
        <section id='Starting the OpenID for Verifiable Presentations flow'><h2>Starting the OpenID for Verifiable Presentations flow</h2>

            <p>In this section we assume that the user starts the authentication process interacting with the VC Verifier component of the Relying Party. The user can direct its browser directly to the VC Component or may have been redirected after trying to access a service without being authenticated previously.
            </p>
            <p>The authentication process starts an OpenID for Verifiable Presentations flow [[OpenID.VP]] combined with the Self-Issued OP v2 specification [[OpenID.SIOP2]], where the VC Verifier component of the portal plays the role of a Relying Party (RP in Open ID Connect terminology) and the wallet of the user is a Self-Issued IdP.
            </p>
            <p>In this step, the VC Verifier has to send an Authorization Request to the wallet. But as a Self-Issued OP may be running as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
            </p>
            <p>We use a QR code to start the process and allow the wallet to receive the Authorization Request from the Verifier, and respond with an Authorization Response, sent to the Verifier in the body of an HTTP <code>POST</code> request.
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_51a6d72099c0f633c0a0905d9fcd4b0b.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='1_2279'><b>1</b> The User navigates with his Laptop browser to access the portal Of the  to perform the onboarding process.
<div>
                    <p>We assume in this scenario a cross-device interaction, that is, the user accesses the portal services with a PC browser, but authentication is performed with a mobile using Verifiable Credentials, as in typical 2-factor authentication.
                    </p>
</div>
                </li>
                <li id='2_2284'><b>2</b> The browser sends a request to the Packet Delivery portal server.
<div>
</div>
                </li>
                <li id='3_2288'><b>3</b> The portal redirects the user to the login page of the Verifier component of DOME Onboarding. The page shows a button labelled “Login with Verifiable Credentials” or something similar.
<div>
</div>
                </li>
                <li id='4_2291'><b>4</b> The Verifier generates a QR code, containing inside the URL of the `/authentication-requests` endpoint of the Verifier component which will be used to start the [[OpenID.VP]] process.
<div>
                    <p>A QR code is used because a Self-Issued OP may be running locally as a native application or progressive web application (PWA), the RP may not have a network-addressable endpoint to communicate directly with the OP. We have to leverage the implicit flow of OpenID Connect to communicate with such locally-running Ops, as described in [[OpenID.SIOP2]].
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">https://verifier.dome-marketplace.eu/authorization-requests?state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj</span>
</pre></td></tr></table>

</div>
                </li>
                <li id='5_2298'><b>5</b> The QR code is displayed in the user browser with instructions to scan it and go to the URL inside it.
<div>
                    <figure id='qr_code_authreq'>
                        <p><img src="images/qrcode-authreq.png" alt="" />
                        </p>
                        <figcaption>QR code with the example Authorization Request endpoint inside
                        </figcaption>
                    </figure>
</div>
                </li>
                <li id='6_2307'><b>6</b> The user scans the QR with his wallet and tells the wallet to go to the URL in the QR.
<div>
</div>
                </li>
                <li id='7_2312'><b>7</b> After confirmation by the user, the wallet performs a `GET /authentication-requests` to the endpoint that was inside the QR code. The reply to the GET request is an Authorization Request
<div>
</div>
                </li>
                <li id='8_2316'><b>8</b> The VC Verifier creates a SIOP Authentication Request. The parameters comprising a request for verifiable presentations are described in detail in the next section
<div>
</div>
                </li>
                <li id='9_2319'><b>9</b> The Verifier replies to the wallet with the Authorization Request
<div>
</div>
                </li>
            </ul>
        </section>
        <section id='Generating the Authorization Request'><h2>Generating the Authorization Request</h2>

            <p>The Authorization Request travels in the response body of the HTTP GET request performed in the previous point, as a JWT signed by the DOME onboarding service, using the eIDAS certificate for seals that corresponds to the legal person operating the service and with the JAdES signature format.
            </p>
            <p>The parameters comprising a request for verifiable presentations are given in section 5 of [[OpenID.VP]] and in section 10.1 of [[OpenID.SIOP2]] and are reproduced here with the particularities of this use case, in particular taking into account that this is a cross-device interaction:
            </p>
            <ul>
                <li id='response_type_2330'><b>response_type</b> (REQUIRED). Must be <code>vp_token</code>. This parameter is defined in [[RFC6749]]. The possible values are determined by the response type registry established by [[RFC6749]]. The [[OpenID.VP]] specification introduces the response type <code>vp_token</code>. This response type asks the Wallet to return only a VP Token in the Authorization Response, which is what we want in our case.
                </li>
                <li id='scope_2332'><b>scope</b> (REQUIRED). This parameter is defined in [[RFC6749]] which allows it to be used by verifiers to request presentation of credentials by utilizing a pre-defined scope value designating the type of credential. See section <a href="#request_scope" class="xref">Request Scope</a> for more details. We use in this instance the value <code>dome.credentials.presentation.LEARCredential</code> which means that the RP (DOME onboarding service) is asking the SIOP (user wallet) to send a credential of type <code>LEARCredential</code>.
                </li>
                <li id='response_mode_2334'><b>response_mode</b> REQUIRED. MUST be <code>direct_post</code>. As this is a cross-device scenario, this response mode is used to instruct the Self-Issued OP to deliver the result of the authentication process to a certain endpoint using the HTTP POST method. This endpoint to which the SIOP shall deliver the authentication result is conveyed in the parameter <code>redirect_uri</code> described below.
                </li>
                <li id='redirect_uri_2336'><b>redirect_uri</b> (REQUIRED). MUST be a valid RP endpoint. The Authentication Response is sent to this endpoint using <code>POST</code> and encoding <code>application/json</code>).
                </li>
                <li id='client_id_2338'><b>client_id</b> REQUIRED. MUST be the DID of the RP (DOM onboarding entity) so it can be resolved by the SIOP and checked against a Trusted List, or rejected if it does not pass validation. This provides a high level of assurance to the SIOP that the RP is really who it claims.
                </li>
                <li id='client_id_scheme_2340'><b>client_id_scheme</b> REQUIRED. MUST have the value <code>did</code>. This value indicates that the Client Identifier is a DID defined in [[DID-Core]]. The request MUST be signed with a private key associated with the DID. To obtain the corresponding private key, the Wallet MUST use DID Resolution defined by the DID method used by the Verifier. For most DID methods and since the associated DID Document may include multiple public keys, a particular public key used to sign the request in question MUST be identified by the kid in the JOSE Header. However, in our case the Verifier uses <code>did:elsi</code> and so the request MUST be signed with the eIDAS certificate according to the [[JAdES]] format, which defines the mechanism to identify the public key.
                    <div>
                    <p>All Verifier metadata other than the public key MUST be obtained from the client_metadata or the <code>client_metadata_uri parameter</code> as defined in Section 5 of [[OpenID.VP]].
                    </p>
                    </div>
                </li>
                <li id='nonce_2344'><b>nonce</b> REQUIRED. This parameter follows the definition given in [[OpenID.Core]]. It is used to securely bind the verifiable presentation(s) provided by the wallet (SIOP) to the particular transaction managed by the RP.
                </li>
                <li id='state_2346'><b>state</b> REQUIRED. Used by the portal component of DOM onboarding to associate the start of an authentication session with the end of that session when the RP Verifier component notifies to the portal.
                </li>
                <li id='presentation_definition_2348'><b>presentation_definition</b> CONDITIONAL. A string containing a <code>presentation_definition</code> JSON object as defined in Section 4 of [[DIF.PresentationExchange]]. We do not use this parameter because <code>scope</code> already specifies the credential type.
                </li>
                <li id='presentation_definition_uri_2350'><b>presentation_definition_uri</b> CONDITIONAL. A string containing a URL pointing to a resource where a <code>presentation_definition</code> JSON object as defined in Section 4 of [[DIF.PresentationExchange]] can be retrieved. We do not use this parameter because <code>scope</code> already specifies the credential type.
                </li>
            </ul>
            <p>Note: A request MUST contain either a <code>presentation_definition</code> or a <code>presentation_definition_uri</code> or a single <code>scope</code> value representing a presentation definition, those three ways to request credential presentation are mutually exclusive. We use here the <code>scope</code> mechanism, which is simpler and fits our use case.
            </p>
            <p>This is an example request object using the definitions above:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">openid://?</span>
<span style="color:#008080">scope</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">dome.credentials.presentation.LEARCredential&amp;</span>
<span style="color:#008080">response_type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">vp_token&amp;</span>
<span style="color:#008080">response_mode</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">direct_post&amp;</span>
<span style="color:#008080">client_id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">did:elsi:VATFR-99999999&amp;</span>
<span style="color:#008080">redirect_uri</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">https://verifier.dome-marketplace.eu/api/authentication_response&amp;</span>
<span style="color:#008080">state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">af0ifjsldkj&amp;</span>
<span style="color:#008080">nonce</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">n-0S6_WzA2Mj</span>
</pre></td></tr></table>

            <p>(URL encoding removed, line breaks and leading spaces added for readability).
            </p>
            <p>As mentioned above, the Authentication Request is returned to the wallet in the reply body of the GET request, as a JWT in JWS form [[RFC7515]]), signed with eIDAS certificate of the DOM onboarding legal person.
            </p>
            <p>This is an example of the unencoded contents of the payload of the JWT:
            </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;iss&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,   <span style="color:#998;font-style:italic">// Should correspond with the client_id in the AR
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000080">&#34;sub&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,   <span style="color:#998;font-style:italic">// Should correspond with the client_id in the AR
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000080">&#34;aud&#34;</span>: <span style="color:#d14">&#34;https://self-issued.me/v2&#34;</span>, <span style="color:#998;font-style:italic">// As specified in section 5.5 of OIDC4VP
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000080">&#34;iat&#34;</span>: <span style="color:#099">1667194901</span>,
    <span style="color:#000080">&#34;exp&#34;</span>: <span style="color:#099">1667194961</span>,                  <span style="color:#998;font-style:italic">// To avoid replays, here it expires in 60 secs
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000080">&#34;auth_request&#34;</span>: <span style="color:#d14">&#34;openid://?scope=...&amp;amp;response_type=vp_token&amp;amp;...&#34;</span>,
}
</pre></td></tr></table>

            <p>Where the claims <code>iss</code> and <code>sub</code> MUST be the DID of the RP (in this case DOME onboarding) and MUST correspond exactly with the <code>client_id</code> parameter in the Authorization Request. The claim <code>auth_request</code> contains the Authentication Request as a string. The expiration time in claim <code>exp</code> avoids replays and can be very short because it is used by the Wallet just on reception of the Authentication Request. The expiration time should be enough for the user to review the Authorization Request, decide the credential(s) to send to the RP and instruct the Wallet to send the Authorization Reply to the RP.
            </p>
        </section>
        <section id='Verification of the Authorization Request'><h2>Verification of the Authorization Request</h2>

            <p>Before sending the Authentication Response, the wallet should verify that the Authorization Request is correct. The most important verifications are described here:
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_7d3dc5e7b6f4ba49b913e048dd96c2be.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='10_2406'><b>10</b> Verification of the signature. As mentioned in the previous section, the Authorization Request is received as a JWT signed by the DOME onboarding service, using the eIDAS certificate for seals that corresponds to the legal person operating the service. This allows the wallet to verify that the signature corresponds to a real-world entity.
<div>
</div>
                </li>
                <li id='11_2409'><b>11</b> Verification that the DID in the `client_id` field of the Authorization Request corresponds to the entity that signed the Authorization Request. This is easy in our case because we use the `did:elsi` method.
<div>
</div>
                </li>
                <li id='12_2412'><b>12</b> Verification that the entity identified in the `client_id` field of the Authorization Request is a trusted entity belonging to the ecosystem, by resolving the DID in the `client_id` field.
<div>
                    <p>The actual mechanism may vary depending on the DID method used and the ecosystem where the client wants to onboard.
                    </p>
                    <p>If the Relying Party is a well known entity (like the DOME onboarding service in the case of DOME), it is easy to verify that the DID corresponds to the Relying Party.
                    </p>
                    <p>In most other cases, for example when the Relying Party is a participant in the ecosystem, we assume that the ecosystem provides a Trusted Participants Registry with an API compatible with the EBSI Trusted Issuers Registry, and that the participants registry is managed in a trusted way by the onboarding service (meaning that the Wallet user trusts on the onboarding service, in the same way as all other participants).
                    </p>
                    <p>In this case, to check if the DID is a participant on the ecosystem, the wallet sends a <code>GET /api/did/v1/identifiers/{did-to-verify}</code> request to the endpoint of one of several trusted servers implementing the functionality to query the Trusted Participant Registry, where <code>{did-to-verify}</code> is the actual DID the Wallet wants to check (in our example it would be <code>did:elsi:VATFR-99999999</code>, corresponding to the RP) . The API returns a JSON document as a DID Document. The DID Document (as per W3C) contains relevant information about the entity owner of the DID. It contains its Public Key, used to verify the digital signature of the entity. It also contains the status of the entity in the ecosystem. It is extensible and can contain any public information which may be relevant for the use case. The API must be operated by a trusted entity for the Wallet user. There may be as many servers implementing the API as needed and operated by different entities. At least one of those trusted entities has to be configured in the Wallet of the user, to facilitate the use of the wallet.
                    </p>
</div>
                </li>
            </ul>
        </section>
        <section id='Creating and sending the Authorization Response'><h2>Creating and sending the Authorization Response</h2>

            <p>Once the Authorization Request has been validated, the Wallet creates an Authorization Response to be posted in the <code>redirect_uri</code> specified by the RP in the Authorization Request. For completeness, we describe in the following figure the complete process from reception of Authorization Request until sending the Authorization Response.
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_089aed180d78fe7872d1120fafc45855.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='13_2446'><b>13</b> The wallet creates an Authorization Response to be posted in the `redirect_uri` specified by GoodAir in the Authorization Request that was sent to the wallet. The contents of the Authorization Response are described below.
<div>
                    <p>The response is constructed as defined in section 6.1 of [[OpenID.VP]]. In particular, because the Authorization Request included only <code>vp_token</code> as the <code>response_type</code>, the VP Token is provided directly in the Authorization Response and a separate <code>id_token</code> is not needed.
                    </p>
                    <p>The contents of the Authorization Response in our specific use case are:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">presentation_submission</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">[see definition below]</span>
<span style="color:#008080">&amp;vp_token</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">[see definition below]</span>
</pre></td></tr></table>

                    <p>The content of the <code>presentation_submission</code> parameter in the above Authorization Response is:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;definition_id&#34;</span>: <span style="color:#d14">&#34;OnboardingPresentationDefinition&#34;</span>,
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;OnboardingPresentationSubmission&#34;</span>,
    <span style="color:#000080">&#34;descriptor_map&#34;</span>: [
    {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;id_credential&#34;</span>,
        <span style="color:#000080">&#34;path&#34;</span>: <span style="color:#d14">&#34;$&#34;</span>,
        <span style="color:#000080">&#34;format&#34;</span>: <span style="color:#d14">&#34;ldp_vp&#34;</span>,
        <span style="color:#000080">&#34;path_nested&#34;</span>: {
            <span style="color:#000080">&#34;format&#34;</span>: <span style="color:#d14">&#34;ldp_vc&#34;</span>,
            <span style="color:#000080">&#34;path&#34;</span>: <span style="color:#d14">&#34;$.verifiableCredential[0]&#34;</span>
        }
    }
    ]
}
</pre></td></tr></table>

                    <p>Which complies with [[DIF.PresentationExchange]] and refers to the Verifiable Presentation in the <code>vp_token</code> parameter provided in the same response. In our example, the Verifiable Presentation includes the LEARCredential that was described in the previous sections.
                    </p>
</div>
                </li>
                <li id='14_2478'><b>14</b> The wallet sends the Authorization Response to the endpoint received in the `redirect_uri` parameter of the Authorization Request, sending an HTTP `POST` request using the encoding `application/x-www-form-urlencoded`.
<div>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#900;font-weight:bold">POST</span> <span style="color:#555">/api/siop/authorization_response</span> <span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span>
Host<span style="color:#000;font-weight:bold">:</span> verifier.dome-onboarding.org
Content-Type<span style="color:#000;font-weight:bold">:</span> application/x-www-form-urlencoded

presentation_submission=[see definition below]
&amp;vp_token=[see definition below]
</pre></td></tr></table>

</div>
                </li>
            </ul>
        </section>
        <section id='Authenticating the user with the LEARCredential'><h2>Authenticating the user with the LEARCredential</h2>

            <p>We should remember that inside the LEARCredential the <code>credentialSubject</code> object has an <code>id</code> field with value <code>did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK</code> which is the DID of the user. It was generated during the creation of the LEARCredential, and the Relying Party should trust that the credential was generated in the proper way binding cryptographically the DID with the LEARCredential, as described in a previous section. It is the same trust that should be put in the generation of any other signed document, like a contract or invoice.
            </p>
            <p>The process of verifying the Authorization Response and authenticating the user with the LEARCredential is the following:
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_5e65e6b64889e67cad7ed8a938eee406.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='15_and_16_2509'><b>15 and 16</b> The Verifier receives the Authorization Request and has to perform verifications, the standard ones being defined in [[DIF.PresentationExchange]]. In order to verify that the Verifiable Credential has been issued by a trusted entity, the Relying Party has to verify:
<div>
                    <ol>
                        <li>That the DID of the entity which is the issuer of the VC is a trusted entity.
                        </li>
                        <li>That the VC was signed by that participant.
                        </li>
                    </ol>
                    <p>Both verifications can be done by performing DID resolution, checking that the resulting DID Document contains the public key corresponding to the one specified in the Verifiable Credential, and by verifying the digital signature of the credential against that public key.
                    </p>
                    <p>In our case the LEARCredential was issued using the <code>did:elsi</code> method, so resolution is very simple and is specified in [[DID-ELSI]].
                    </p>
</div>
                </li>
                <li id='17_2520'><b>17</b> After verifying the credential, the Relying Party can also verify that the Verifiable Presentation including the Verifiable Credential is sent by the user and not by a malicious agent. To do so, it uses the public key associated to the `did:key` identifier `id` field inside the `credentialSubject` structure. That public key is cryptographically bound to the customer DID during the onboarding process that GoodAir performed with its employee.
<div>
</div>
                </li>
                <li id='18_2523'><b>18</b> The Verifier creates an Access Token for the user so it can be used later for access services provided by the Relying Party (in the case of onboarding, those services would be the ones related to the onboarding process implemented by the Onboarding portal). The Access Token is generated in JWT format and signed by the VC Verifier. The access token is intended for use as bearer token over HTTP [[RFC2616]] using Transport Layer Security (TLS) [[RFC5246]] to access protected resources, and it should use the JWT Profile profile described in [[RFC9068]].
<div>
                    <p>For our use case, the payload of the JWT access token looks like:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;iss&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,
    <span style="color:#000080">&#34;sub&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
    <span style="color:#000080">&#34;aud&#34;</span>:   <span style="color:#d14">&#34;https://dome-marketplace.eu/onboarding&#34;</span>,
    <span style="color:#000080">&#34;exp&#34;</span>: <span style="color:#099">1639528912</span>,
    <span style="color:#000080">&#34;iat&#34;</span>: <span style="color:#099">1618354090</span>,
    <span style="color:#000080">&#34;jti&#34;</span> : <span style="color:#d14">&#34;dbe39bf3a3ba4238a513f51d6e1691c4&#34;</span>,
    <span style="color:#000080">&#34;client_id&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,
    <span style="color:#000080">&#34;scope&#34;</span>: <span style="color:#d14">&#34;vp_token&#34;</span>,
    <span style="color:#000080">&#34;verifiableCredential&#34;</span>: [<span style="color:#d14">&#34;the VC that was received inside the Verifiable Presentation&#34;</span>]
}
</pre></td></tr></table>

                    <p>Where, according to [[RFC9068]]:
                    </p>
                    <ul>
                        <li><code>iss</code> and <code>client_id</code> have the same value because the access token has been generated by the Verifier component of the DOME onboarding service, acting as the DOME legal person.
                        </li>
                        <li><code>sub</code> identifies the user (employee of GoodAir acting as LEAR of the company) using the DID inside the Verifiable Credential received
                        </li>
                        <li><code>aud</code> identifies the RS (Resource Server) component in Packet Delivery. In this case we assume that it is internal and does not have a DID assigned, so we use the URI of the component.
                        </li>
                        <li><code>kid</code> in the header identifies the key that is used to sign the JWT and which must be configured up-front and known by the RS (Resource Server.
                        </li>
                        <li><code>scope</code> has the same value as the equivalent <code>scope</code> parameter in the initial Authorization Request.
                        </li>
                        <li><code>verifiableCredential</code> contains the Verifiable Credential that was received, specifically the value of the first element of the field <code>verifiableCredential</code> of the Verifiable Presentation.
                        </li>
                    </ul>
</div>
                </li>
                <li id='19_2556'><b>19</b> The Verifier sends a successful response to the POST request from the wallet. The wallet receives the response to the POST indicating the success or failure of the process. The Verifier continues processing because the web portal of Packet Delivery has to be refreshed with the services that this specific user can access, based on the information received in the Verifiable Credential and the access control policies implemented by the DOME portal.
<div>
</div>
                </li>
                <li id='20_2559'><b>20</b> The Verifier notifies the DOME portal to refresh the login page so it can present the services to the user. The notification includes the following:
<div>
                    <ul>
                        <li>The <code>state</code> nonce that was generated by the portal when it generated the QR code. The portal uses the <code>state</code> nonce to know what login session is being notified.
                        </li>
                        <li>The access token generated before.
                        </li>
                    </ul>
                    <p>The notification is a simple POST request with both parameters in the body:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#900;font-weight:bold">POST</span> <span style="color:#555">/api/notify</span> <span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span>
Host<span style="color:#000;font-weight:bold">:</span> dome-marketplace.eu
Content-Type<span style="color:#000;font-weight:bold">:</span> application/x-www-form-urlencoded

access_token=[the access token]
&amp;state=af0ifjsldkj
</pre></td></tr></table>

                    <p>The portal component replies immediately and continues processing.
                    </p>
</div>
                </li>
                <li id='21_2579'><b>21</b> The portal of the Relying Party refreshes the screen and displays the services available to users, sending the Access Token to the browser of the user. The Access Token will be sent back by the browser to the portal whenever the user tries to access a protected resource of the portal, and so access control can be performed using the data inside the token, in the same way as with any other access token in other authentication mechanisms.
<div>
</div>
                </li>
            </ul>
        </section>
    </section>
    <section id='Authenticating with Verifiable Credentials, Machine-To-Machine (M2M)'><h2>Authenticating with Verifiable Credentials, Machine-To-Machine (M2M)</h2>

        <section id='Overview2585'><h2>Overview</h2>

            <p>The M2M flow for authentication shares many things with the flows for H2M authentication. We focus here on the differences.
            </p>
            <p>In this description we assume that the user is an application or service running in a server operated by a legal person, and the application wants to access a protected resource in an automated way. This is also applicable when the application or service is running in a constrained device like a sensor. Without loss of generality, we will use the term <code>application</code> interchangeably with <code>user</code> when the context is clear.
            </p>
            <p>We assume, like in the H2M case, that the legal entity operating the application issues a LEARCredential to the application, and that the application uses a so-called <code>enterprise wallet</code> to store and manage Verifiable Credentials and their associated private keys.
            </p>
            <figure class='figureshadow'><img src='images/login_in_DOME/authn_architecture_numbered.drawio.png' alt='Architecture overview'>
            <figcaption>Architecture overview</figcaption></figure>

            <p>The high level flow is the following:
            </p>
            <ul class='plain'>
                <li id='1_2599'><b>1</b> The application sends a request to access a protected resource managed by the Relying Party.
                </li>
                <li id='2_2601'><b>2</b> Every request to a protected resource is intercepted by the PEP (Policy Enforcement Point). The PEP is normally implemented as a reverse proxy or API gateway, so all calls to protected resources entering the organisation are intercepted and forwarded only if they are accepted. If the request does not come with authentication information, there are several high level scenarios which are possible:
                    <div>
                    <ul>
                        <li>If the user is a machine using an API, the request is rejected with an error. The caller is responsible for authenticating before retrying, which can be done using the metadata about the Relying Party available at the standard OpenID endpoints.
                        </li>
                        <li>If the user is a natural person using a browser for navigating the portal of the Relying Party, the typical approach is to redirect the browser to the authentication component using an HTTP Status of 302. The redirection includes enough information so the authentication component can send back the user to the original request if the user completes authentication successfully.
                        </li>
                    </ul>
                    </div>
                    <div>
                    <p>Alternatively, the request can include authentication information which has been obtained before via an authentication process. If this is the case, the PEP goes directly into the authentication phase, described later in section <a href="#accesscontrol" class="xref">Access control with Verifiable Credentials</a>.
                    </p>
                    </div>
                </li>
                <li id='3_2610'><b>3</b> The user is redirected to the authentication component. As mentioned before, alternatively the authorization component can be accessed directly by the user before trying to access the protected resource. This would be the expected behaviour of a user who knows that authentication is required. The mechanism described here supports all possible scenarios both for natural persons and machines.
                    <div>
                    <p>An example flow with a natural person would be: The user navigates first to a general Login page in the portal of the Relying Party and authenticates. After authentication the portal presents a collection of services that the user can access. The user selects one of the services/operations and the Relying Party executes the operation if the user is authorised to do so.
                    </p>
                    </div>
                </li>
                <li id='4_2614'><b>4</b> The Verifiable Credentials verifier component of the Relying Party retrieves the credentials that are required for authentication. If the user has been redirected when trying to access a protected resource, the redirection provides information about the operation and protected resource that was trying to access, so there may be more credentials required than just a VerifiableID.
                    <div>
                    <p>If the user accessed the Login page directly, the VC Verifier component does not have information about the resource that the user intends to access, so it can request just a VerifiableID.
                    </p>
                    </div>
                </li>
                <li id='5_2618'><b>5</b> The VC Verifier component of the Relying Party and the Wallet of the user engage in a Verifiable Presentation Exchange flow, where the result is that the VC Verifier receives a VerifiableID and possibly additional Verifiable Credentials as determined in step 4.
                </li>
                <li id='6_2620'><b>6</b> The authorization mechanism uses the Trust Framework to query different Trusted Lists that are needed to evaluate the policy rules applicable to the request and compute a decision.
                    <div>
                    <p>The Trust Framework is composed of one or more Trusted Lists where each list is specialised in some specific domain of trust.
                    </p>
                    </div>
                    <div>
                    <p>For example, the Trust Framework contains Trusted Lists with the schema definitions used for the well-known types of Verifiable Credentials in the ecosystem. In this way, if the Verifiable Registry used for the Trust Framework is based on a Blockchain network (or several federated networks), the schemas can be published in a trusted and resilient manner reducing the risk of malicious tampering and keeping a record of the history of modifications.
                    </p>
                    </div>
                    <div>
                    <p>But the most interesting Trusted Lists in the Trust Framework are the Trusted Issuers Lists, which provide the mechanism to efficiently and securely verify that the issuer of a given credential is a Trusted Issuer of that type of credentials.
                    </p>
                    </div>
                    <div>
                    <p>It has to be noticed that even though most Trusted Issuer Lists are global (used by all participants in the ecosystem) and have essentially public information, there may be some specialised lists that are private to one or more organisations and specialised in some specific requirement.
                    </p>
                    </div>
                    <div>
                    <p>In this way, there may be some lists that are specific to the products that one organisation provides to other participants in the ecosystem. For example, there may be a Trusted Issuer List private to one organisation which is updated with the identity of a participant when that participant acquires access to some product provided by that organisation.
                    </p>
                    </div>
                    <div>
                    <p>For example, this "product-specific" Trusted Issuer List is queried when performing authorization if the related policy rules specify that the issuer of the Verifiable Credential received in the request should have acquired the product that the request is trying to access.
                    </p>
                    </div>
                    <div>
                    <p>However, as mentioned before, the set of "internal" and "external" Trusted Lists to query is not hardcoded but it depends on the specific policy rules that should be applied to the request when computing the decision to grant access or not.
                    </p>
                    </div>
                    <div>
                    <p>In this way, the system provides a great deal of flexibility on how access control is performed.
                    </p>
                    </div>
                    <div>
                    <p>For simplicity, the diagram below shows the query of the Trusted Issuer Lists as a single interaction to a single box, but the actual interactions can be very complex if required. In addition, the diagram does not specify whether the list is "private" or "global".
                    </p>
                    </div>
                </li>
            </ul>
            <p>The following sections elaborate in more detail in each of the interactions.
            </p>
        </section>
        <section id='Exchanging a LEARCredential for an Access Token'><h2>Exchanging a LEARCredential for an Access Token</h2>

            <p>In order to authenticate, the Wallet sends a <code>POST</code> request to a given endpoint specialised in M2M authentication. The contents of this POST request is very similar to the contents of the Authorization Response in the case of H2M flows. There are several reasons for having separate authentication endpoints for machines and humans, the most important being of legal responsibility nature: natural persons are completely different entities from the point of view of the legal system in the EU (for example, with specific laws like GDPR or Consumer Rights Directive). Having separate authentication endpoints helps reduce the risk of affecting natural persons when modifying the authentication of machines.
            </p>
            <p>The
Once the Authorization Request has been validated, the Wallet creates an Authorization Response to be posted in the <code>redirect_uri</code> specified by the RP in the Authorization Request. For completeness, we describe in the following figure the complete process from reception of Authorization Request until sending the Authorization Response.
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_089aed180d78fe7872d1120fafc45855.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='13_2670'><b>13</b> The wallet creates an Authorization Response to be posted in the `redirect_uri` specified by GoodAir in the Authorization Request that was sent to the wallet. The contents of the Authorization Response are described below.
<div>
                    <p>The response is constructed as defined in section 6.1 of [[OpenID.VP]]. In particular, because the Authorization Request included only <code>vp_token</code> as the <code>response_type</code>, the VP Token is provided directly in the Authorization Response and a separate <code>id_token</code> is not needed.
                    </p>
                    <p>The contents of the Authorization Response in our specific use case are:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">presentation_submission</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">[see definition below]</span>
<span style="color:#008080">&amp;vp_token</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">[see definition below]</span>
</pre></td></tr></table>

                    <p>The content of the <code>presentation_submission</code> parameter in the above Authorization Response is:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;definition_id&#34;</span>: <span style="color:#d14">&#34;OnboardingPresentationDefinition&#34;</span>,
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;OnboardingPresentationSubmission&#34;</span>,
    <span style="color:#000080">&#34;descriptor_map&#34;</span>: [
    {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;id_credential&#34;</span>,
        <span style="color:#000080">&#34;path&#34;</span>: <span style="color:#d14">&#34;$&#34;</span>,
        <span style="color:#000080">&#34;format&#34;</span>: <span style="color:#d14">&#34;ldp_vp&#34;</span>,
        <span style="color:#000080">&#34;path_nested&#34;</span>: {
            <span style="color:#000080">&#34;format&#34;</span>: <span style="color:#d14">&#34;ldp_vc&#34;</span>,
            <span style="color:#000080">&#34;path&#34;</span>: <span style="color:#d14">&#34;$.verifiableCredential[0]&#34;</span>
        }
    }
    ]
}
</pre></td></tr></table>

                    <p>Which complies with [[DIF.PresentationExchange]] and refers to the Verifiable Presentation in the <code>vp_token</code> parameter provided in the same response. In our example, the Verifiable Presentation includes the LEARCredential that was described in the previous sections.
                    </p>
</div>
                </li>
                <li id='14_2702'><b>14</b> The wallet sends the Authorization Response to the endpoint received in the `redirect_uri` parameter of the Authorization Request, sending an HTTP `POST` request using the encoding `application/x-www-form-urlencoded`.
<div>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#900;font-weight:bold">POST</span> <span style="color:#555">/api/siop/authorization_response</span> <span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span>
Host<span style="color:#000;font-weight:bold">:</span> verifier.dome-onboarding.org
Content-Type<span style="color:#000;font-weight:bold">:</span> application/x-www-form-urlencoded

presentation_submission=[see definition below]
&amp;vp_token=[see definition below]
</pre></td></tr></table>

</div>
                </li>
            </ul>
        </section>
        <section id='Authenticating the user with the LEARCredential2713'><h2>Authenticating the user with the LEARCredential</h2>

            <p>We should remember that inside the LEARCredential the <code>credentialSubject</code> object has an <code>id</code> field with value <code>did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK</code> which is the DID of the user. It was generated during the creation of the LEARCredential, and the Relying Party should trust that the credential was generated in the proper way binding cryptographically the DID with the LEARCredential, as described in a previous section. It is the same trust that should be put in the generation of any other signed document, like a contract or invoice.
            </p>
            <p>The process of verifying the Authorization Response and authenticating the user with the LEARCredential is the following:
            </p>
            <figure class='figureshadow'><img src='builtassets/plantuml_5e65e6b64889e67cad7ed8a938eee406.png' alt='Starting the authentication phase'>
            <figcaption>Starting the authentication phase</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

            <ul class='plain'>
                <li id='15_and_16_2733'><b>15 and 16</b> The Verifier receives the Authorization Request and has to perform verifications, the standard ones being defined in [[DIF.PresentationExchange]]. In order to verify that the Verifiable Credential has been issued by a trusted entity, the Relying Party has to verify:
<div>
                    <ol>
                        <li>That the DID of the entity which is the issuer of the VC is a trusted entity.
                        </li>
                        <li>That the VC was signed by that participant.
                        </li>
                    </ol>
                    <p>Both verifications can be done by performing DID resolution, checking that the resulting DID Document contains the public key corresponding to the one specified in the Verifiable Credential, and by verifying the digital signature of the credential against that public key.
                    </p>
                    <p>In our case the LEARCredential was issued using the <code>did:elsi</code> method, so resolution is very simple and is specified in [[DID-ELSI]].
                    </p>
</div>
                </li>
                <li id='17_2744'><b>17</b> After verifying the credential, the Relying Party can also verify that the Verifiable Presentation including the Verifiable Credential is sent by the user and not by a malicious agent. To do so, it uses the public key associated to the `did:key` identifier `id` field inside the `credentialSubject` structure. That public key is cryptographically bound to the customer DID during the onboarding process that GoodAir performed with its employee.
<div>
</div>
                </li>
                <li id='18_2747'><b>18</b> The Verifier creates an Access Token for the user so it can be used later for access services provided by the Relying Party (in the case of onboarding, those services would be the ones related to the onboarding process implemented by the Onboarding portal). The Access Token is generated in JWT format and signed by the VC Verifier. The access token is intended for use as bearer token over HTTP [[RFC2616]] using Transport Layer Security (TLS) [[RFC5246]] to access protected resources, and it should use the JWT Profile profile described in [[RFC9068]].
<div>
                    <p>For our use case, the payload of the JWT access token looks like:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;iss&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,
    <span style="color:#000080">&#34;sub&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
    <span style="color:#000080">&#34;aud&#34;</span>:   <span style="color:#d14">&#34;https://dome-marketplace.eu/onboarding&#34;</span>,
    <span style="color:#000080">&#34;exp&#34;</span>: <span style="color:#099">1639528912</span>,
    <span style="color:#000080">&#34;iat&#34;</span>: <span style="color:#099">1618354090</span>,
    <span style="color:#000080">&#34;jti&#34;</span> : <span style="color:#d14">&#34;dbe39bf3a3ba4238a513f51d6e1691c4&#34;</span>,
    <span style="color:#000080">&#34;client_id&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATFR-99999999&#34;</span>,
    <span style="color:#000080">&#34;scope&#34;</span>: <span style="color:#d14">&#34;vp_token&#34;</span>,
    <span style="color:#000080">&#34;verifiableCredential&#34;</span>: [<span style="color:#d14">&#34;the VC that was received inside the Verifiable Presentation&#34;</span>]
}
</pre></td></tr></table>

                    <p>Where, according to [[RFC9068]]:
                    </p>
                    <ul>
                        <li><code>iss</code> and <code>client_id</code> have the same value because the access token has been generated by the Verifier component of the DOME onboarding service, acting as the DOME legal person.
                        </li>
                        <li><code>sub</code> identifies the user (employee of GoodAir acting as LEAR of the company) using the DID inside the Verifiable Credential received
                        </li>
                        <li><code>aud</code> identifies the RS (Resource Server) component in Packet Delivery. In this case we assume that it is internal and does not have a DID assigned, so we use the URI of the component.
                        </li>
                        <li><code>kid</code> in the header identifies the key that is used to sign the JWT and which must be configured up-front and known by the RS (Resource Server.
                        </li>
                        <li><code>scope</code> has the same value as the equivalent <code>scope</code> parameter in the initial Authorization Request.
                        </li>
                        <li><code>verifiableCredential</code> contains the Verifiable Credential that was received, specifically the value of the first element of the field <code>verifiableCredential</code> of the Verifiable Presentation.
                        </li>
                    </ul>
</div>
                </li>
                <li id='19_2780'><b>19</b> The Verifier sends a successful response to the POST request from the wallet. The wallet receives the response to the POST indicating the success or failure of the process. The Verifier continues processing because the web portal of Packet Delivery has to be refreshed with the services that this specific user can access, based on the information received in the Verifiable Credential and the access control policies implemented by the DOME portal.
<div>
</div>
                </li>
                <li id='20_2783'><b>20</b> The Verifier notifies the DOME portal to refresh the login page so it can present the services to the user. The notification includes the following:
<div>
                    <ul>
                        <li>The <code>state</code> nonce that was generated by the portal when it generated the QR code. The portal uses the <code>state</code> nonce to know what login session is being notified.
                        </li>
                        <li>The access token generated before.
                        </li>
                    </ul>
                    <p>The notification is a simple POST request with both parameters in the body:
                    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#900;font-weight:bold">POST</span> <span style="color:#555">/api/notify</span> <span style="color:#000;font-weight:bold">HTTP</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">1.1</span>
Host<span style="color:#000;font-weight:bold">:</span> dome-marketplace.eu
Content-Type<span style="color:#000;font-weight:bold">:</span> application/x-www-form-urlencoded

access_token=[the access token]
&amp;state=af0ifjsldkj
</pre></td></tr></table>

                    <p>The portal component replies immediately and continues processing.
                    </p>
</div>
                </li>
                <li id='21_2803'><b>21</b> The portal of the Relying Party refreshes the screen and displays the services available to users, sending the Access Token to the browser of the user. The Access Token will be sent back by the browser to the portal whenever the user tries to access a protected resource of the portal, and so access control can be performed using the data inside the token, in the same way as with any other access token in other authentication mechanisms.
<div>
</div>
                </li>
            </ul>
        </section>
    </section>
</section>
<section id='accesscontrol'><h2>Access control with Verifiable Credentials</h2>

    <section id='Overview2809'><h2>Overview</h2>

        <p>This section assumes that authentication has already been performed and that the Relying Party receives a request to a protected resource, with a proper access token inside the request. If the request does not come with an access token, the request is rejected immediately (or the user is redirected to the Authentication service of the Relying Party, depending on the use case).
        </p>
        <p>The Access Control mechanism described here is the same independently of whether the request comes from a user or a machine, so the M2M use case is supported without any modification. In the following description we will use the term <b>user</b> interchangeably for both the user as a natural person or the user as a machine.
        </p>
        <p>However, the assumption is that all machines have an identity (they are assigned an identifier), and that they are acting <code>on behalf of</code> a legally valid identity in the sense of eIDAS2. In other words, we require that the identities of users and machines can be cryptographically bound to the real-world identity of either a natural person or a legal person in a way that provides legal certainty to the Relying Party regarding the chain of responsibility.
        </p>
        <p>If the user is a natural person using the portal of the Relying Party, the request to the protected resource will come from the browser that the user employs to navigate the portal, and the access token will be included automatically by the browser in every request that is sent to the Relying Party, for example when the user clicks a button or fills a form.
        </p>
        <p>If the user is a server or device, it is assumed that it has obtained an access token previously as the result of an authentication process described above. The server or device is responsible for including the access token in every request that is sent to the Relying Party to access a protected resource.
        </p>
        <p>If the portal of the Relying Party is an onboarding process (eg., the portal of the DOME Onboarding service), the protected resource could be the onboarding service itself, or a service to upload additional information for a partially completed onboarding process.
        </p>
        <p>If the portal is a Marketplace and the organisation using the portal wants to offer products in it, these services could be to register the organisation as a <i>Seller</i>, or to create a Product specification and offering.
        </p>
        <p>If the portal is the Marketplace and the organisation wants to contract products in it, these services could be to register the organisation as a <i>Customer</i>, or to launch a procurement order of a product.
        </p>
        <p>The same mechanism can be used by any participant in the ecosystem, if they want to use an advanced IAM mechanism which is aligned with the EU strategy on digital identity based on Verifiable Credential and eIDAS2.
        </p>
        <p>For the explanation we will use the following figure which is based on [[[NIST-AUTH]]] which describes a reference architecture with necessary functional components to achieve enforcement the authorization policies. The authorization process depends on four layers of functionality: <b>Enforcement</b>, <b>Decision</b>, <b>Access Control Data</b>, and <b>Administration</b>.
        </p>
        <figure id='authn-reference'>
            <p><img src="images/login_in_DOME/authn_architecture_authorization.drawio.png" alt="" />
            </p>
            <figcaption>High level Authentication logical architecture
            </figcaption>
        </figure>
    </section>
    <section id='Determine the Authorization Policies which apply to the request'><h2>Determine the Authorization Policies which apply to the request</h2>

        <p>Every request to a protected resource is intercepted by the PEP (Policy Enforcement Point), and to know if the request should be authorised or not, the PEP asks to the PDP (Policy Decision Point) for a decision. The PDP needs to know what are the policy rules that should be applied to the request, and it uses the PRP (Policy Retrieval Point) to retrieve those policies.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_48aaffcb8cecf468dbf62950e963e714.png' alt='Determine the Authorization Policies'>
        <figcaption>Determine the Authorization Policies</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

        <ul class='plain'>
            <li id='1_2855'><b>1</b> The user (natural person or machine) sends a request to access a protected resource, and the PEP (Policy Enforcement Point) component intercepts the call. The PEP is normally implemented as a reverse proxy or API gateway, so all calls to protected resources entering the organisation are intercepted and forwarded if they are accepted.
<div>
</div>
            </li>
            <li id='2_2858'><b>2</b> If the request is not authenticated it is rejected with an error. Depending on the use case, the error returned can contain additional information that enables the user agent to be redirected to perform authentication.
<div>
                <p>After inspecting the request, the PEP requests a decision from the PDP passing a series of attributes. In general, the request from the PEP to the PDP consists of <b>subject</b> attributes (typically for the user who issued the request), <b>resource</b> attributes (the resource for which access is sought), <b>action</b> attributes (the operations to be performed on the resource), and <b>environment</b> attributes.
                </p>
                <p>Some of the above attributes are obtained by the PEP from the original request received from the user. For example, the HTTP verb (GET, POST, PUT, PATCH, DELETE) and the URL and possibly the body of the request provide action attributes. Specifically, in the case of an NGSI-LD request those attributes are formally specified in the NGSI-LD standard.
                </p>
                <p>The subject attributes most relevant for access control are located in the access token received with the request. In particular, the access token includes the Verifiable Credentials that were employed for authentication, and the claims in those credentials can be used to evaluate access control policies. This includes (but is not limited to) the roles object that may be included in the VerifiableID credential used for authentication.
                </p>
                <p>An example access token would be:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;token_type&#34;</span>: <span style="color:#d14">&#34;Bearer&#34;</span>,
    <span style="color:#000080">&#34;expires_in&#34;</span>: <span style="color:#099">3600</span>,
    <span style="color:#000080">&#34;access_token&#34;</span>: <span style="color:#d14">&#34;ewogICJhbGciOiAiR...ERBIgogIH0KfQ&#34;</span>
}
</pre></td></tr></table>

                <p>Decoding the <code>access_token</code> field we could see a Verifiable Presentation including the LEARCredential that the user presented when authenticating:
                </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;@context&#34;</span>: [
        <span style="color:#d14">&#34;https://www.w3.org/2018/credentials/v1&#34;</span>,
        <span style="color:#d14">&#34;https://dome-marketplace.eu//2022/credentials/learcredential/v1&#34;</span>
    ],
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;urn:did:elsi:25159389-8dd17b796ac0&#34;</span>,
    <span style="color:#000080">&#34;type&#34;</span>: [<span style="color:#d14">&#34;VerifiableCredential&#34;</span>, <span style="color:#d14">&#34;LEARCredential&#34;</span>],
    <span style="color:#000080">&#34;issuer&#34;</span>: {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:elsi:VATES-12345678&#34;</span>
    },
    <span style="color:#000080">&#34;issuanceDate&#34;</span>: <span style="color:#d14">&#34;2022-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;validFrom&#34;</span>: <span style="color:#d14">&#34;2022-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;expirationDate&#34;</span>: <span style="color:#d14">&#34;2023-03-22T14:00:00Z&#34;</span>,
    <span style="color:#000080">&#34;credentialSubject&#34;</span>: {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;Mr.&#34;</span>,
        <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#d14">&#34;John&#34;</span>,
        <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#d14">&#34;Doe&#34;</span>,
        <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#d14">&#34;M&#34;</span>,
        <span style="color:#000080">&#34;postal_address&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
        <span style="color:#000080">&#34;email&#34;</span>: <span style="color:#d14">&#34;johndoe@goodair.com&#34;</span>,
        <span style="color:#000080">&#34;telephone&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
        <span style="color:#000080">&#34;fax&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
        <span style="color:#000080">&#34;mobile_phone&#34;</span>: <span style="color:#d14">&#34;+34787426623&#34;</span>,
        <span style="color:#000080">&#34;legalRepresentative&#34;</span>: {
            <span style="color:#000080">&#34;cn&#34;</span>: <span style="color:#d14">&#34;56565656V Jesus Ruiz&#34;</span>,
            <span style="color:#000080">&#34;serialNumber&#34;</span>: <span style="color:#d14">&#34;56565656V&#34;</span>,
            <span style="color:#000080">&#34;organizationIdentifier&#34;</span>: <span style="color:#d14">&#34;VATES-12345678&#34;</span>,
            <span style="color:#000080">&#34;o&#34;</span>: <span style="color:#d14">&#34;GoodAir&#34;</span>,
            <span style="color:#000080">&#34;c&#34;</span>: <span style="color:#d14">&#34;ES&#34;</span>
        },
        <span style="color:#000080">&#34;rolesAndDuties&#34;</span>: [
            {
                <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;LEARCredential&#34;</span>,
                <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;https://dome-marketplace.eu//lear/v1/6484994n4r9e990494&#34;</span>
            }
        ]
    }
}
</pre></td></tr></table>

                <p>Environmental attributes, which depend on the availability of system sensors that can detect and report values, are somewhat different from subject and resource attributes, which are administratively created. Environmental attributes are not properties of the subject or resources, but are measurable characteristics that pertain to the operational or situational context in which access requests occur. These environmental characteristics are subject and resource independent, and may include the current time, day of the week, or threat level.
                </p>
                <p>The PDP computes decisions to permit or deny subject requests to perform actions on resources. In computing a decision, the PDP queries policies stored in a PRP (Policy Retrieval Point).
                </p>
                <p>If the attributes of the request are not sufficient for rule and policy evaluation, the PDP may need to search the PIP for additional attributes. The PIP is shown as one logical store, but in fact may comprise multiple physical stores of different types.
                </p>
                <p>In addition to the PIP, the PDP uses one or more Trusted Issuers Lists (to check if the issuer of the credential is included in them as a trusted issuer of that type of credential), and also the Authorization Registry (AR), which can check for finer granularity authorisation records which may be very dynamic in nature (e.g. if some resource usage by employees and machines owned by the issuer have exceeded some quota this month).
                </p>
                <p>The actual Trusted Issuers Lists that the PDP needs to check is determined by the policy rules retrieved from the PRP. Those policy rules also determine the additional queries performed to the PIP data stores.
                </p>
                <p>The set of information and data stored in the PIP and PRP comprise the access control data and collectively define the current authorization state, which the PDP will use to compute its decision.
                </p>
</div>
            </li>
            <li id='3_2933'><b>3</b> The PDP asks the PRP for the policy rules applicable to this request. The policy rules may be specified using different policy languages, like ODRL, XACML or Rego. It is very difficult to make the interface between the PDP and the PRP completely transparent and independent from the concrete policy language used in an implementation. However, The PDP can be modularised in order to minimise the dependency and reduce the cost of migration to other policy language in the future.
<div>
</div>
            </li>
            <li id='4_2936'><b>4</b> The PDP receives the policy rules to apply for the current request.
<div>
</div>
            </li>
        </ul>
    </section>
    <section id='Determine which Trusted Issuer Lists should be queried'><h2>Determine which Trusted Issuer Lists should be queried</h2>

        <p>After retrieving the policies from the PRP, the PDP determines what are the attributes needed by the policy rules to perform its evaluation. Some of those attributes can be determined from the request received (e.g., claims inside the Verifiable Credential(s) in the access token). But in general, the policy rules require additional attributes that have to be retrieved from other sources.
        </p>
        <p>The two logical sources of those attributes are the PIP and the Trusted Issuers Lists in the Trust Anchor Framework.
        </p>
        <p>The concept of the PIP is the same as in the standard XACML logical architecture, essentially enabling the PDP to retrieve environmental attributes required for policy evaluation.
        </p>
        <p>In our approach using Verifiable Credentials for authentication and authorization, we use a Trust Framework to determine if the credentials received in the request are issued by authorised issuers of those credentials.
        </p>
        <p>The PDP does not have hardcoded the actual Trusted Lists to query, but they are determined dynamically from the policies retrieved from the PRP. In simple use cases there may be one or two lists to query which are the same for all requests. But the mechanism described here can cater for very complex scenarios where the lists may be different depending on the requests and also from the dynamic environmental information retrieved from the PIP.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_e9b5fd10a95e7efdd99361a716fd9818.png' alt='Determine Trusted Issuer Lists to query'>
        <figcaption>Determine Trusted Issuer Lists to query</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

        <ul class='plain'>
            <li id='4_2965'><b>4</b> The PDP receives the policy rules to apply for the current request.
<div>
</div>
            </li>
            <li id='5_2968'><b>5</b> The PDP performs an initial evaluation of the policy rules and if the attributes of the request are not sufficient for rule and policy evaluation, it determines the PIP stores to query, and also the set of Trusted Issuers Lists to query. The concrete Trusted Lists to query are dynamic and depend on the specific policies associated to the request.
<div>
</div>
            </li>
            <li id='6_2972'><b>6</b> Based on the policies and the attributes of the request, the PDP queries the PIP for additional attributes needed for the policy evaluation.
<div>
                <p>Now that the PDP has the policy rules to apply and the attributes from the request and the ones retrieved from the PIP, the PDP can determine the actual Trusted Lists that have to be queried in order to be able to evaluate the policies.
                </p>
</div>
            </li>
        </ul>
    </section>
    <section id='Query the Trusted Issuer Lists'><h2>Query the Trusted Issuer Lists</h2>

        <p>The authorization mechanism uses the Trust Framework to query different Trusted Lists that are needed to evaluate the policy rules applicable to the request and compute a decision.
        </p>
        <p>The Trust Framework is composed of one or more Trusted Lists where each list is specialised in some specific domain of trust.
        </p>
        <p>For example, the Trust Framework contains Trusted Lists with the schema definitions used for the well-known types of Verifiable Credentials in the ecosystem. In this way, if the Verifiable Registry used for the Trust Framework is based on a Blockchain network (or several federated networks), the schemas can be published in a trusted and resilient manner reducing the risk of malicious tampering and keeping a record of the history of modifications.
        </p>
        <p>But the most interesting Trusted Lists in the Trust Framework are the Trusted Issuers Lists, which provide the mechanism to efficiently and securely verify that the issuer of a given credential is a Trusted Issuer of that type of credentials.
        </p>
        <p>It has to be noticed that even though most Trusted Issuer Lists are global (used by all participants in the ecosystem) and have essentially public information, there may be some specialised lists that are private to one or more organisations and specialised in some specific requirement.
        </p>
        <p>In this way, there may be some lists that are specific to the products that one organisation provides to other participants in the ecosystem. For example, there may be a Trusted Issuer List private to one organisation which is updated with the identity of a participant when that participant acquires access to some product provided by that organisation.
        </p>
        <p>For example, this "product-specific" Trusted Issuer List is queried when performing authorization if the related policy rules specify that the issuer of the Verifiable Credential received in the request should have acquired the product that the request is trying to access.
        </p>
        <p>However, as mentioned before, the set of "internal" and "external" Trusted Lists to query is not hardcoded but it depends on the specific policy rules that should be applied to the request when computing the decision to grant access or not.
        </p>
        <p>In this way, the system provides a great deal of flexibility on how access control is performed.
        </p>
        <p>For simplicity, the diagram below shows the query of the Trusted Issuer Lists as a single interaction to a single box, but the actual interactions can be very complex if required. In addition, the diagram does not specify whether the list is "private" or "global".
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_4e81c481b979246d42f8eac88fc5bb50.png' alt='Query the Trusted Issuer Lists'>
        <figcaption>Query the Trusted Issuer Lists</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

        <ul class='plain'>
            <li id='6_3016'><b>6</b> Based on the policies and the attributes of the request, the PDP queries the PIP for additional attributes needed for the policy evaluation.
<div>
</div>
            </li>
            <li id='7_3020'><b>7</b> Based on the policies and the attributes of the request, the PDP queries one or more Trusted Issuer Lists to check that the credentials received comply with the requirements specified in the policies.
<div>
</div>
            </li>
        </ul>
    </section>
    <section id='Compute the decision and allow (or not) access'><h2>Compute the decision and allow (or not) access</h2>

        <p>Once the PDP has all the attributes required for policy evaluation, it computes a decision and returns that decision to the PEP which will enforce it.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_be3b0ee126e5440e3c75eb214242be0d.png' alt='Compute the decision'>
        <figcaption>Compute the decision</figcaption></figure>

<!-- ****** EXPLANATIONS **** -->

        <ul class='plain'>
            <li id='8_3043'><b>8</b> The PDP performs a final evaluation of the policy rules, taking into consideration the attributes received from the PEP, the attributes received from the PIP, and the Trusted Issuers Lists queried. After the evaluation the PDP computes a decision, either to accept or to reject the request.
<div>
</div>
            </li>
            <li id='9_3046'><b>9</b> The PDP returns the decision to the PEP, which will enforce it.
<div>
</div>
            </li>
            <li id='10_3049'><b>10</b> If the decision from the PDP is to reject the request, the PEP returns an error to the user. Otherwise, it forwards the original request to the Resource for execution.
<div>
</div>
            </li>
            <li id='11_3052'><b>11</b> The resource executes the request and returns the result.
<div>
</div>
            </li>
            <li id='12_3055'><b>12</b> The PEP returns the result to the user.
<div>
</div>
            </li>
        </ul>
    </section>
    <section id='Summary of the authorization process'><h2>Summary of the authorization process</h2>

        <p>The following diagram combines all the steps in a single one to provide an overall view of the authorization process.
        </p>
        <figure class='figureshadow'><img src='builtassets/plantuml_c8e7f45dfb37b5dfb38c586a43f43ac2.png' alt='Summary of the Authorization process'>
        <figcaption>Summary of the Authorization process</figcaption></figure>

    </section>
</section>
<section id='participants'><h2>Example scenario: Participants in the ecosystem</h2>

    <p>Here we introduce the actors of the reference use case we are going to use. The main actors are marked in yellow in the following diagram.
    </p>
    <p>RealTruth is a Trust Service Provider operating under the eIDAS Trust Framework, which issues a certificate for seals to the company GoodAir. GoodAir is a business that provides some services using an Air Quality application operated by GoodAir.
    </p>
    <p>RealTruth also provides a certificate for signatures to the COO of the GoodAir company, so the COO can use the certificate to sign documents on behalf of GoodAir (like contracts, invoices, financial reports, ...) in a way that is compliant with eIDAS.
    </p>
    <p>The COO of GoodAir will issue a verifiable credential of type LEARCredential to an employee of GoodAir, signing the credential with his certificate for signatures.
    </p>
    <figure class='figureshadow'><img src='builtassets/d2_7edaef13dd6bde3907a92f7bc18e6e64.svg' alt=''>
    <figcaption></figcaption></figure>

    <section id='GoodAir is a service provider'><h2>GoodAir is a service provider</h2>

        <p>The new participant is a business providing an Air Quality Monitoring application as a service. The business is called GoodAir and it operates the application, which receives data from a set of sensors that may or may not be the property of GoodAir. The sensors must have received a certification to be able to operate and send data to the GoodAir application.
        </p>
        <p>The company is registered in the tax agency and business registry of Spain with VAT number <b>VATES-12345678</b>.
        </p>
    </section>
    <section id='COO (Chief Operating Officer) of GoodAir'><h2>COO (Chief Operating Officer) of GoodAir</h2>

        <p>The GoodAir company is small and one of the legal representatives is the COO (Chief Operating Officer). The COO is registered as a legal representative in the business registry of Spain.
        </p>
        <p>The COO has a certificate for electronic signatures issued by one of the Qualified Trust Service Provider in Spain enabling the COO to perform electronic qualified signatures as legal representative of GoodAir. The COO is used to sign contracts and other legally binding documents in the form of PDFs.
        </p>
        <p>The X.509 certificate of the COO has the following contents in the <code>Subject</code> field (the example below is derived from a real certificate but with the identifiers modified to be an example):
        </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">cn</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">56565656V Jesus Ruiz</span>
<span style="color:#008080">serialNumber</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">56565656V</span>
<span style="color:#008080">givenName</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">Jesus</span>
<span style="color:#008080">sn</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">Ruiz</span>
<span style="color:#008080">2.5.4.97</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">VATES-12345678</span>
<span style="color:#008080">o</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">GoodAir</span>
<span style="color:#008080">c</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">ES</span>
</pre></td></tr></table>

        <p>The above set of fields bind the legal identity of the COO with the identity of the business, as attested by the QTSP after checking in the business registry of Spain.
        </p>
        <ul>
            <li><code>serialNumber</code> is the unique number recognized by the Spanish Government for spanish citizens (called NIF).
            </li>
            <li><code>2.5.4.97</code> is the <a href="https://oidref.com/2.5.4.97">official OID for <code>organizationIdentifier</code></a>. The contents of this field in the example certificate is the unique identifier for the legal person GoodAir.
            </li>
        </ul>
        <p>Before issuing a certificate like the above, the TSP has to perform some validations to ensure that in the official source of truth (the business registry of Spain in this case) there is already registered information that states that the COO has indeed powers to act on behalf of GoodAir as a legal representative.
        </p>
    </section>
    <section id='RealTruth: a Trust Service Provider'><h2>RealTruth: a Trust Service Provider</h2>

        <p>RealTruth is an EU TSP, which appears in the TL (Trusted List) maintained by the <a href="https://tl.bundesnetzagentur.de/TL-DE.XML">German Government</a>.
        </p>
        <p>RealTruth is a TSP based in Germany but operates in most of the countries of the EU and so being able to provide Trust Services across many countries, including Spain.
        </p>
        <p>As all TSPs in the TLs of the Member States, its entry in the TL includes one or more "Services" entries which describe the Trust Services provided by the TSP.
        </p>
        <p>A TSP can have one Service issuing certificates for signatures, another service issuing certificates for seals, another service for timestamping, etc.
        </p>
        <p>The regulator approves or suspends each service from a TSP individually, and the services are the root anchor for a given trust environment.
        </p>
        <p>In our case, the entry for RealTruth in the TL includes a <code>&ltTSPService&gt</code> entry, and inside it the <code>&ltServiceDigitalIdentity&gt</code> entry includes a DER-encoded certificate specifying the digital identity of the root anchor for that trust domain. The certificate for the Service has in the Subject field:
        </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
<span style="color:#008080">2.5.4.97</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">VATDE-170173453</span>
<span style="color:#008080">CN</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">DRV QC 11 MA CA 2017ca</span>
<span style="color:#008080">OU</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">QC 11 Mitarbeiter CA</span>
<span style="color:#008080">O</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">Deutsche Rentenversicherung Westfalen</span>
<span style="color:#008080">C</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">DE</span>
</pre></td></tr></table>

        <p>Which in the <code>organizationIdentifier</code> field (OID 2.5.4.97) specifies the unique organisation identifier assigned by the German regulatory authority to the TSP: VATDE-170173453.
        </p>
        <p>RealTruth provides <code>Legal Person Representative Certificates</code> which are qualified in accordance with Regulation (EU) No. 910/2014 of the European Parliament and of the Council of 23 July 2014 on electronic identification and trust services for electronic transactions in the internal market.
        </p>
        <p>The certification policies of RealTruth include the following sentences:
        </p>
        <blockquote>
            <p>The Registration Authority must verify the following information in order to authenticate the identity of the organisation:
            </p>
            <ul>
                <li>The data concerning the business name or corporate name of the organisation.
                </li>
                <li>The data relating to the constitution and legal status of the subscriber.
                </li>
                <li><b>The data concerning the extent and validity of the powers of representation of the applicant.</b>
                </li>
                <li>The data concerning the tax identification code of the organisation or equivalent code used in the country to whose legislation the subscriber is subject.
                </li>
            </ul>
        </blockquote>
        <p>The TSP (RealTruth in this case) performs the verifications against <code>Authentic Sources</code>.
        </p>
        <blockquote>
            <p>Authentic Sources are the public or private repositories or systems recognised or required by law containing attributes about a natural or legal persons.
            </p>
            <p>The Authentic Sources in scope of Annex VI of the [eIDAS2] legislative proposal are sources for attributes on address, age, gender, civil status, family composition, nationality, education and training qualifications titles and licences, professional qualifications titles and licences, public permits and licences, financial and company data.
            </p>
            <p>Authentic Sources in scope of Annex VI are required to provide interfaces to Qualified Electronic Attestation of Attributes  (QEAA) Providers to verify the authenticity of the above attributes, either directly or via designated intermediaries recognised at national level.
            </p>
            <p>Authentic Sources may also issue (Q)EAA-s themselves if they meet the requirements of the eIDAS Regulation. It is up to the Member States to define terms and conditions for the provisioning of these services, but according to the minimum technical specifications, standards, and procedures applicable to the verification procedures for qualified electronic attestations of attributes.
            </p>
        </blockquote>
        <p>In accordance to the policies, RealTruth made those validations when issuing the certificate to the COO, in such a way that the Relying Parties verifying the certificate can have a high level of trust in the assertion that the natural person identified in the certificate (with Spanish ID of 56565656V) is a legal representative of he GoodAir company (organizationIdentifier VATES-12345678).
        </p>
    </section>
    <section id='John Doe: an administrative employee of GoodAir'><h2>John Doe: an administrative employee of GoodAir</h2>

        <p>This is an employee of the central administration department of GoodAir, who is going to be formally nominated to manage a specific set of processes on behalf of GoodAir in DOME. In particular, this employee is going to be nominated as a LEAR (Legal Entity Authorised Representative).
        </p>
        <p>As its name implies, the LEAR has to be nominated by a <b>legal representative</b> of the GoodAir organisation with the necessary legal authority to commit the organisation for this type of decision. In our case, the COO of GoodAir will nominate John Doe as the LEAR of GoodAir, delegating to him the capabilities to perform some processes in the DOME portal and some other tasks in other organisations. That means that John Doe will not be empowered to perform actions not explicitly specified in the credential.
        </p>
        <p>To perform the nomination, the COO of GoodAir will issue a special credential to John Doe and will sign the credential with his certificate for signatures as legal representative of GoodAir. The details are described in <a href="#issuing-lear-credential-signature" class="xref">Issuing the LEARCredential using an eIDAS certificate for signatures</a>.
        </p>
    </section>
    <section id='DOME Marketplace: a decentralised marketplace for cloud & edge services'><h2>DOME Marketplace: a decentralised marketplace for cloud & edge services</h2>

        <a href='https://dome-marketplace.eu/'>DOME Marketplace</a> is a decentralised federation of marketplace instances where customers can procure certified cloud and edge services from other entities that act as service providers.
        </a>
        <p>One of the instances of the federated marketplaces is operated by the DOME Operator, an entity implementing the governance model of the ecosystem. This marketplace instance has a web portal that allows external entities to perform some processes in an automated fashion by using Verifiable Credentials that have been issued by trusted entities. The complete Trust Framework used by DOME is composed from a series of Trust Frameworks, some managed internally using a governance model of DOME and some others managed externally by trusted entities. At the root of the Trust Framework of DOME is the eIDAS Trust Framework and the pan-european recognized list of Trust Service Providers issuing the eIDAS compliant digital identities, in the form of certificates for signatures/seals.
        </p>
        <p>In order to participate in DOME, every legal person requires a certificate for seals, or a certificate for signatures issued to a legal representative (or both). The DOME entity is registered in France with VAT number <b>VATFR-99999999</b>.
        </p>
    </section>
</section>
<section id='Additional details: RPaM Ontology'><h2>Additional details: RPaM Ontology</h2>

    <section id='Mandate3304'><h2>Mandate</h2>

        <p>According to the RPaM Glossary, a "<i>mandate is a record that describes the terms under which a mandator grants a representation power to a mandatee</i>".
        </p>
        <p>The following diagram defines the class Mandate and its relations with the other classes of the data model, as it appears in the original RPaM Ontology project. We describe below the concrete usage in DOME.
        </p>
        <figure class='figureshadow'><img src='images/rpam/RPaM-Mandate.png' alt='Mandate ontology. Source: [[RPaM-Ontology]]'>
        <figcaption>Mandate ontology. Source: [[RPaM-Ontology]]</figcaption></figure>

        <ol>
            <li>The <code>Mandate</code> is a type of <code>Evidence</code>.
            </li>
            <li>A <code>Mandate</code> has only one <code>Mandator</code>.
            </li>
            <li>The <code>Mandator</code> is a specialisation of an (RPaM) <code>Agent</code>. This <code>Agent</code> is an extension of <code>foaf:Agent</code>, and in RPaM, it can be either a natural person, a legal person or a system (i.e. all three descendant of <code>Agent</code> are disjoint amongst themselves; see also the diagram <code>Agent</code> below).
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>For the LEAR Credential we focus on the case where the <code>Mandator</code> is an employee of a company, either a legal representative of the company or an employee who is a Mandatee in another Mandate where the Mandator is a legal representative of the company, according to the official records associated to the incorporation of the organisation (e.g., the business registry of the country of incorporation).
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>The <code>Mandator</code> draws the Power from one (or more) sources of power, e.g. 1) a concrete Legislation; 2) a piece of evidence (as another Mandate, in which case the mandator was a mandatee in that other mandate) and/or 3) a Natural Person with a specific profession that invest him/her with the authority to order to a mandator with a specific role the creation of a mandate, e.g. a judge authorising a civil servant (a <code>Mandator</code> that is a Natural Person with the appropriate role) to create a mandate for a relative to represent an incapacitated person).
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>For the LEAR Credential, the <code>Mandator</code> is an employee of the company and the source of power is either:
                    </p>
                    <ol>
                        <li>the business registry of the country of incorporation (or whatever organism maintains the official records for companies in the given country), when the employee is a legal representative of the company.
                        </li>
                        <li>another Mandate, in which case the mandator was a mandatee in that other mandate
                        </li>
                    </ol>
                </aside></td></tr></table>
                </div>
            </li>
            <li>In the case where the mandator is "the owner" of the power (i.e. the mandator and the represented person are the same) there is no need of specifying which is the source of the power. From this convention derives the following business rule: "when a mandate does not specify the source of the power, the represented person is the mandator".
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>As described above, we do not handle this case. The <code>Mandator</code> is an employee of a company and the represented person is the company itself. This is true no matter the chain of delegations (from the legal representative to an employee and from that employee to another employee).
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>It is for the mandator to grant powers to one or more mandatees (see the definition of Power in the <a href="https://everis-rpam.github.io/Glossary.html">RPaM Ontology Glossary</a>). Thus the power becomes the core entity that links mandator and mandatees in one mandate.
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>For the LEAR Credential, the <code>Mandator</code> (the legal representative of the company or another employee) grants a subset of powers from the <code>Mandator</code> to the mandatee (an employee of the company). The legal representative has so-called <code>General</code> powers, where the representative can act on behalf of the organisation in any action and for any third-party organisation.
                    </p>
                    <p>The LEAR Credential allows the <code>Mandator</code> to grant a subset of those powers to an employee, to act on behalf of the organisation only for some actions and for one specific organisation or domain (e.g., to onboard in DOME or to publish services in the DOME Marketplace).
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>The class <code>Power</code> is a wrapper for the different types of powers that are defined in an "EU Power Taxonomy". A proposal for this taxonomy has been developed also in the context of the RPaM ontology project. The taxonomy is in fact a compound of three "concept-schemes" around three classes of concepts: action, event and the object of a combined action plus event. See the section "Controlled vocabularies" for more details;
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>Here we deviate from the results of the RPaM project: the RPaM project focuses on the powers applicable to interactions with all the Public Administrations in the EU (which is an incredibly complex task).
                    </p>
                    <p>Our objective is more modest and concrete for two reasons. First, our Power Taxonomy is targeted at the interactions with the DOME Federated Marketplace. This means that the actions are well defined, homogeneous and standardised, essentially the subset of the TMForum APIs used in the implementation of the DOME Marketplace. Additionally, we do not tackle natural persons as citizens, but the <code>Mandator</code> is a legal representative and the Mandatee is an employee of the company. This makes the objective easily achievable, where we are basically replacing the current mechanisms for Mandates (e.g., paper or PDF) with a more efficient, machine-processable representation in the form of a Verifiable Credential.
                    </p>
                    <p>Our Power Taxonomy could be generalised to other actions involving private sector companies, but it is out of scope of this version of the document.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>The Powers can be constrained. Thus the use of a <code>Power</code> can be limited through specific properties for both the <code>Mandator</code> and the Mandatee. These properties are “mandatorConstraint” and “mandateeConstraint”.
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>In this version of the document we do not use these properties. The use of the mechanisms described below are enough for the moment for granting constrained powers to an employee, facilitating a reduced set of interactions with third parties (e.g., the DOME ecosystem).
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li><code>Power Use Constraints</code> (PUC) are represented through "Criterion Properties", which is a class defined in the <a href="https://joinup.ec.europa.eu/collection/semantic-interoperability-community-semic/solution/e-government-core-vocabularies/core-criterion-and-core-evidence-vocabulary">Core Criterion and Evidence Vocabulary (CCEV)</a> namespace. As a "core" vocabulary this is a very generic vocabulary that allows to define any types of constraints. For instance: period of validity of the Power, financial thresholds, whether the Power is of single-use or multiple-use, etc. These constraints are defined in a code list and are accessible via the property type of the Criterion Property class.
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>In the current implementation of the LEAR Credential we use a reduced subset of the CCEV properties, which are more than enough for our needs. This may be extended in the future if the need arises.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>In RPaM we reuse the UBL approach for the definition of periods of time. In UBL a Period is a class with a start date and either and end date or a quantity of days, months, years, etc. that indicate the duration of the period. In RPaM we use this ubl:Period class for two different purposes: 1) to specify the life-cycle of a mandate (property lifeSpan), in which case there is the need of specifying always two dates: the start date corresponds to the date when the mandate was created (i.e. registered), and the end date correspond to the date when the mandate was struck-off the registry (i.e. terminated for whatever reason).
            </li>
            <li>The <code>Mandatee</code> is the person granted with the power to represent (and act as) another person (i.e. to act on behalf of the represented Person).
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>For the LEAR Credential, the Mandatee is the employee who is nominated by the legal representative or by another employee with another LEAR Credential to perform concrete actions on behalf of the company.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>Beware that in certain situations for the "acting on behalf of" more than one mandatee simultaneously may be necessary. This is modelled in RPaM through the property "coRepresentative" (a.k.a. "joint representation"): the cardinality 0..n allows to specify as many co-representatives as necessary and therefore can also be profiled to a very specific number of mandatees when/where necessary (i.e. depending of the business case).
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'><p class='xnotep'>NOTE: DOME</p>
                    <p>We do not require (yet) this functionality.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
        </ol>
    </section>
    <section id='Agent'><h2>Agent</h2>

        <p>The RPaM <code>Agent</code> reuses other known ontologies such as Friend-of-a-Friend (foaf), the W3C <code>org:Organization</code>, the OASIS UBL specification and the ISO 15000-5 Core Component Type Specification (CCTS). In some cases small extesions were added. That is particulary the case of the CCTS Identifier where the attribute "Assurance Level" was added as a need of alignment to the eIDAS Regulation.
        </p>
        <p>The following diagram represents the entities and relations for the definition of <code>Agent</code> in the context of RPaM:
        </p>
        <figure id='agent-ontology' class='figureshadow'><img src='images/rpam/RPaM-Agent.png' alt='Agent ontology. Source: [[RPaM-Ontology]]'>
        <figcaption>Agent ontology. Source: [[RPaM-Ontology]]</figcaption></figure>

        <ol>
            <li>The definition of Agent, in RPaM, reads: "A natural person, a legal person or a system.". This is coherent with the semantics of the Friend-of-a-friend "Agent" class, from which the RPaM <code>Agent</code> inherits.
            </li>
            <li>The <code>Mandator</code> and the Mandatee are specialisations of Agent, and therefore they may be instantiated as a Natural Person, as a Legal Person or as a System;
            </li>
            <li>In some countries, in order to properly identify a Natural Person, there is the need to indicate a minimum information about the mother and the father (normally their given and family names). The RPaM ontology solves this by relating the Natural Person class with itself. This way, if some more attributes of the related natural persons were needed in those or other countries they would be available without having to extend the current model.
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'>
                    <p>We do not cover natural persons. Or more precisely, the natural persons involved in a LEAR Credential are the legal representative of the company and the employee who will act on behalf of the company. The requirements for these in the context of business relationships are completely different than the ones for Natural Persons referred above.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>Systems may be representatives of natural and legal persons. As per today, the legal framework and Public Administrations do not rely on "systems" if the actions to undertake carry responsibility and liability. Nonetheless this is changing rapidly, and one example is the use of automated solutions (systems) that use seals. These types of practices are being included in the EU and MS legislations (e.g. eIDAS) as, in the end, systems are "representatives" of their owners, and as such they need to be identified as surrogates of a Person (normally a Legal Person). The model proposed in RPaM foresees the situation where Systems could act on behalf of a Person, and therefore they could replace the Person they represent as both the <code>Mandator</code> and the Mandatee.
                <div>
                <table style='width:100%;margin:1em 0;'><tr><td class='xnotet'><aside class='xnotea'>
                    <p>While the LEAR Credential supports Systems as representatives, this is not the focus of this version of the document. An upgraded version will describe the LEAR Credential for Systems.
                    </p>
                </aside></td></tr></table>
                </div>
            </li>
            <li>Two frequent situations are 1) when multiple organisations use one shared system, and 2) the opposite, when one organisation uses multiple systems. In both cases, but specially in the second one, it is important to identify well to what organisation the system belongs and who is using it. One common way of identifying uniquely the system and checking its rights to interoperate is to register its IP address or a persistent URL, i.e. the system end-point. The combinations of end-point, additional system identifiers, ownership (property "belongsTo"), and the identification(s) of the owner allow to identify who is actually using it and what for. See the diagram Mandate Request and Mandate Response for other examples regarding Service Providers and Mandate Management Systems.
            </li>
            <li>The classes like ubl:Contact, ubl:PostalAddress, org:Site, etc., can be used when there is the need of getting in touch with any of the agents, e.g. in the case notifications from the Service Provider to the <code>Mandator</code> and Mandatee could be relevant.
            </li>
        </ol>
    </section>
</section>
<section id='request_scope'><h2>Request Scope</h2>

    <p>According to section 5.3 of [[OpenID.VP]], wallets MAY support requesting presentation of credentials using OAuth 2.0 <code>scope</code> values. Such a scope value MUST be an alias for a well-defined presentation definition as it will be referred to in the <code>presentation_submission</code> response parameter.
    </p>
    <p>In this specification we define concrete scope values and the mapping between a certain scope value and the respective presentation definition, in particular the mapping between scope values and specific types of Verifiable Credentials used for access control in the use case described in this document. In a production implementation of a Data Space ecosystem, the Trust Framework has to define the mappings used in the ecosysyem and the mechanisms and governance model used to update those mappings.
    </p>
    <p>In this example we only need the mapping for the LEARCredential, where the scope <code>dome.credentials.presentation.LEARCredential</code> represents the following presentation definition:
    </p>

<table style="width:100%;"><tr><td class="codecolor">
<pre class='nohighlight precolor'>
{
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;dome.credentials.presentation.LEARCredential&#34;</span>,
    <span style="color:#000080">&#34;input_descriptors&#34;</span>: [
        {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;LEARCredentialDefinitionv1.01&#34;</span>,
        <span style="color:#000080">&#34;format&#34;</span>: {
            <span style="color:#000080">&#34;ldp_vc&#34;</span>: {
                <span style="color:#000080">&#34;proof_type&#34;</span>: [
                    <span style="color:#d14">&#34;RsaSignature2018&#34;</span>
                ]
            }
        },
        <span style="color:#000080">&#34;constraints&#34;</span>: {
            <span style="color:#000080">&#34;fields&#34;</span>: [
                {
                    <span style="color:#000080">&#34;path&#34;</span>: [
                        <span style="color:#d14">&#34;$.type&#34;</span>
                    ],
                    <span style="color:#000080">&#34;filter&#34;</span>: {
                        <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;string&#34;</span>,
                        <span style="color:#000080">&#34;pattern&#34;</span>: <span style="color:#d14">&#34;LEARCredential&#34;</span>
                    }
                }
            ]
        }
        }
    ]
}
</pre></td></tr></table>

</section>
<section id='glossary'><h2>Glossary</h2>

    <p>As far as possible and in order to enhance consistency with the regulation, we use in this document the following definitions, which is essentially a subset of the definitions in Article 3 of the document [[eIDAS2.Regulation]] and in the original [[[eIDAS.Regulation]]].
    </p>
    <p>This is the reason why in some definitions below the description refers to an article or section that does not exist in this document. We have decided to keep the definitions like in the original, as we think it does not limit the understanding of the concept.
    </p>
    <dl>
        <dt id='electronic identification'>electronic identification
        </dt>
        <dd>means the process of using person identification data in electronic form uniquely representing either a natural or legal person, or a natural person representing a legal person;
        </dd>
        <dt id='electronic identification means'>electronic identification means
        </dt>
        <dd>means a material and/or immaterial unit, including European Digital Identity Wallets or ID cards following Regulation 2019/1157, containing person identification data and which is used for authentication for an online or offline service:
        </dd>
        <dt id='person identification data'>person identification data
        </dt>
        <dd>means a set of data, issued in accordance with national law, enabling the identity of a natural or legal person, or a natural person representing a legal person to be established;
        </dd>
        <dt id='electronic identification scheme'>electronic identification scheme
        </dt>
        <dd>means a system for electronic identification under which electronic identification means, are issued to natural or legal persons or natural persons representing legal or natural persons;
        </dd>
        <dt id='user'>user
        </dt>
        <dd>means a natural or legal person, or a natural person representing a legal person using trust services, notified electronic identification means or European Digital Identity Wallets;
        </dd>
        <dt id='authentication'>authentication
        </dt>
        <dd>means an electronic process that enables the verification of the origin and integrity of data in electronic form;
        </dd>
        <dt id='identification'>identification
        </dt>
        <dd>means an electronic process that establish an unequivocal relationship between a set of data and a natural or legal person;
        </dd>
        <dt id='validation'>validation
        </dt>
        <dd>means the process of verifying that an electronic signature, an electronic seal, a European Digital Identity Wallet, an electronic identification mean, a relying party authorisation, person identification data, an electronic attestation of attributes or any electronic certificates for trust services is valid and has not been revoked;
        </dd>
        <dt id='zero knowledge proof'>zero knowledge proof
        </dt>
        <dd>means cryptographic methods by which a relying party can validate that a given statement based on the electronic attestation of attributes held in a user's European Digital Identity Wallet is true, without conveying any data related to those electronic attestation of attributes to the relying party;
        </dd>
        <dt id='relying party'>relying party
        </dt>
        <dd>means a natural or legal person that relies upon an electronic identification means, including European Digital Identity Wallets, or a trust service, directly or through an intermediary, in order to provide services;
        </dd>
        <dt id='public sector body'>public sector body
        </dt>
        <dd>means a state, regional or local authority, a body governed by public law or an association formed by one or several such authorities or one or several such bodies governed by public law, or  private entity mandated by at least one of those authorities, bodies or associations to provide public services, when acting under such a mandate;
        </dd>
        <dt id='body governed by public law'>body governed by public law
        </dt>
        <dd>means a body defined in point (4) of Article 2(1) of Directive 2014/24/EU of the European Parliament and of the Council (1);
        </dd>
        <dt id='signatory'>signatory
        </dt>
        <dd>means a natural person who creates an electronic signature;
        </dd>
        <dt id='electronic signature'>electronic signature
        </dt>
        <dd>means data in electronic form which is attached to or logically associated with other data in electronic form and which is used by the signatory to sign;
        </dd>
        <dt id='advanced electronic signature'>advanced electronic signature
        </dt>
        <dd>means an electronic signature which meets the requirements set out in Article 26;
        </dd>
        <dt id='qualified electronic signature'>qualified electronic signature
        </dt>
        <dd>means an advanced electronic signature that is created by a qualified electronic signature creation device, and which is based on a qualified certificate for electronic signatures;
        </dd>
        <dt id='electronic signature creation data'>electronic signature creation data
        </dt>
        <dd>means unique data which is used by the signatory to create an electronic signature;
        </dd>
        <dt id='certificate for electronic signature'>certificate for electronic signature
        </dt>
        <dd>means an electronic attestation which links electronic signature validation data to a natural person and confirms at least the name or the pseudonym of that person;
        </dd>
        <dt id='qualified certificate for electronic signature'>qualified certificate for electronic signature
        </dt>
        <dd>means a certificate for electronic signatures, that is issued by a qualified trust service provider and meets the requirements laid down in Annex I;
        </dd>
        <dt id='trust service'>trust service
        </dt>
        <dd>means an electronic service normally provided against payment which consists of:
            <ul>
                <li>(a) the creation, verification, and validation of electronic signatures, electronic seals or electronic time stamps, electronic registered delivery services, electronic attestation of attributes and certificates related to those services;
                </li>
                <li>(b) the creation, verification and validation of certificates for website authentication;
                </li>
                <li>(c) the preservation of electronic signatures, seals or certificates related to those services;
                </li>
                <li>(d) the electronic archiving of electronic documents;
                </li>
                <li>(e) the management of remote electronic signature and seal creation devices;
                </li>
            </ul>
        </dd>
        <dt id='qualified trust service'>qualified trust service
        </dt>
        <dd>means a trust service that meets the applicable requirements laid down in this Regulation;
        </dd>
        <dt id='conformity assessment body'>conformity assessment body
        </dt>
        <dd>means a body defined in point 13 of Article 2 of Regulation (EC) No 765/2008, which is accredited in accordance with that Regulation as competent to carry out conformity assessment of a qualified trust service provider and the qualified trust services it provides;
        </dd>
        <dt id='trust service provider'>trust service provider
        </dt>
        <dd>means a natural or a legal person who provides one or more trust services either as a qualified or as a non-qualified trust service provider;
        </dd>
        <dt id='qualified trust service provider'>qualified trust service provider
        </dt>
        <dd>means a trust service provider who provides one or more qualified trust services and is granted the qualified status by the supervisory body;
        </dd>
        <dt id='electronic seal'>electronic seal
        </dt>
        <dd>means data in electronic form, which is attached to or logically associated with other data in electronic form to ensure the latter’s origin and integrity;
        </dd>
        <dt id='advanced electronic seal'>advanced electronic seal
        </dt>
        <dd>means an electronic seal, which meets the requirements set out in Article 36;
        </dd>
        <dt id='qualified electronic seal'>qualified electronic seal
        </dt>
        <dd>means an advanced electronic seal, which is created by a qualified electronic seal creation device, and that is based on a qualified certificate for electronic seal;
        </dd>
        <dt id='electronic seal creation data'>electronic seal creation data
        </dt>
        <dd>means unique data, which is used by the creator of the electronic seal to create an electronic seal;
        </dd>
        <dt id='certificate for electronic seal'>certificate for electronic seal
        </dt>
        <dd>means an electronic attestation or set of attestations that links electronic seal validation data to a legal person and confirms the name of that person;
        </dd>
        <dt id='qualified certificate for electronic seal'>qualified certificate for electronic seal
        </dt>
        <dd>means a certificate for an electronic seal, that is issued by a qualified trust service provider and meets the requirements laid down in Annex III;
        </dd>
        <dt id='electronic seal creation device'>electronic seal creation device
        </dt>
        <dd>means configured software or hardware used to create an electronic seal;
        </dd>
        <dt id='qualified electronic seal creation device'>qualified electronic seal creation device
        </dt>
        <dd>means an electronic seal creation device that meets mutatis mutandis the requirements laid down in Annex II of [[eIDAS.Regulation]];
        </dd>
        <dt id='electronic time stamp'>electronic time stamp
        </dt>
        <dd>means data in electronic form which binds other data in electronic form to a particular time establishing evidence that the latter data existed at that time;
        </dd>
        <dt id='qualified electronic time stamp'>qualified electronic time stamp
        </dt>
        <dd>means an electronic time stamp which meets the requirements laid down in Article 42 of [[eIDAS.Regulation]];
        </dd>
        <dt id='electronic document'>electronic document
        </dt>
        <dd>means any content stored in electronic form, in particular text or sound, visual or audiovisual recording;
        </dd>
        <dt id='electronic registered delivery service'>electronic registered delivery service
        </dt>
        <dd>means a service that makes it possible to transmit data between third parties by electronic means and provides evidence relating to the handling of the transmitted data, including proof of sending and receiving the data, and that protects transmitted data against the risk of loss, theft, damage or any unauthorised alterations;
        </dd>
        <dt id='qualified electronic registered delivery service'>qualified electronic registered delivery service
        </dt>
        <dd>means an electronic registered delivery service which meets the requirements laid down in Article 44;
        </dd>
        <dt id='European Digital Identity Wallet'>European Digital Identity Wallet
        </dt>
        <dd>means an electronic identification means which securely stores, manages and validates identity data and electronic attestations of attributes, to provide them to relying parties and other users of European Digital Identity Wallets on request, and which enables the creation of qualified electronic signatures and seals;
        </dd>
        <dt id='attribute'>attribute
        </dt>
        <dd>is a feature, characteristic or quality of a natural or legal person or of an entity;
        </dd>
        <dt id='electronic attestation of attributes'>electronic attestation of attributes
        </dt>
        <dd>means an attestation in electronic form that allows the presentation and authentication of attributes;
        </dd>
        <dt id='qualified electronic attestation of attributes'>qualified electronic attestation of attributes
        </dt>
        <dd>means an electronic attestation of attributes, which is issued by a qualified trust service provider and meets the requirements laid down in Annex V;
        </dd>
        <dt id='authentic source'>authentic source
        </dt>
        <dd>is a repository or system, held under the responsibility of a public sector body or private entity, that contains attributes about a natural or legal person and is considered to be the primary source of that information or recognised as authentic in Union or national law;
        </dd>
        <dt id='electronic archiving'>electronic archiving
        </dt>
        <dd>means a service ensuring preservation of electronic data or documents in order to guarantee their integrity, the accuracy of their origin and legal features throughout the conservation period;
        </dd>
        <dt id='qualified electronic archiving service'>qualified electronic archiving service
        </dt>
        <dd>means a service that meets the requirements laid down in Article 45g;
        </dd>
        <dt id='EU Digital Identity Wallet Trust Mark'>EU Digital Identity Wallet Trust Mark
        </dt>
        <dd>means an indication in a simple, recognisable and clear manner that a Digital Identity Wallet has been issued in accordance with this Regulation;
        </dd>
        <dt id='strong user authentication'>strong user authentication
        </dt>
        <dd>means an authentication based on the use of at least two authentication factors categorised as user knowledge , possession and inherence that are independent, in such a way that the breach of one does not compromise the reliability of the others, and is designed in such a way to protect the confidentiality of the authentication data;
        </dd>
        <dt id='user account'>user account
        </dt>
        <dd>means a mechanism that allows a user to access public or private services on the terms and conditions established by the service provider;
        </dd>
        <dt id='personal data'>personal data
        </dt>
        <dd>means any information as defined in point 1 of Article 4 of Regulation (EU) 2016/679;
        </dd>
        <dt id='identity matching'>identity matching
        </dt>
        <dd>means a process where person identification data or person identification means are matched with or linked to an existing account belonging to the same person;
        </dd>
        <dt id='offline service'>offline service
        </dt>
        <dd>means the capability of a user to electronically identify and authenticate with a third party with close proximity technologies irrespective of whether the device is connected to the internet or not in order to access a wide range of public and private services;
        </dd>
    </dl>
</section>
<section id='references'>
</section>


</body>
</html>
